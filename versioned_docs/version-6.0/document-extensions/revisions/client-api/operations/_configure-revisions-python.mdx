import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* Use `ConfigureRevisionsOperation` to apply the following [revisions configuration](../../../../studio/database/settings/document-revisions.mdx#revisions-configuration) to the database:  
  * **Default configuration** - applies to all document collections.  
  * **Collection-specific configurations** - override the default settings for these collections.  
  * To apply a configuration for conflict document revisions see [configure conflict revisions](../../../../document-extensions/revisions/client-api/operations/conflict-revisions-configuration.mdx).  

* The configuration passed to this operation will **REPLACE** the current revisions configuration in the database.  
  To **MODIFY** existing configuration, fetch the current configuration from the database record first.  

* After applying the configuration,  
  revisions are created and purged for a document whenever the document is created, modified, or deleted.  

* To create a revision when there is no configuration defined (or enabled) see: [force revision creation](../../../../document-extensions/revisions/overview.mdx#force-revision-creation)

* By default, the operation will be applied to the [default database](../../../../client-api/setting-up-default-database.mdx).  
  To operate on a different database see [switch operations to different database](../../../../client-api/operations/how-to/switch-operations-to-a-different-database.mdx).  

* In this page:  
  * [Replace configuration](../../../../document-extensions/revisions/client-api/operations/configure-revisions.mdx#replace-configuration)  
  * [Modify configuration](../../../../document-extensions/revisions/client-api/operations/configure-revisions.mdx#modify-configuration)  
  * [Syntax](../../../../document-extensions/revisions/client-api/operations/configure-revisions.mdx#syntax)  

</Admonition>
## Replace configuration

In this example, we create a new `RevisionsConfiguration` for the database.  
If revisions configuration already exists in the database - it will be **replaced**.
<TabItem value="replace_configuration" label="replace_configuration">
<CodeBlock language="python">
{`# ==============================================================================
# Define default settings that will apply to ALL collections
# Note: this is optional
default_rev_config = RevisionsCollectionConfiguration(
    minimum_revisions_to_keep=100,
    minimum_revisions_age_to_keep=timedelta(days=7),
    maximum_revisions_to_delete_upon_document_creation=15,
    purge_on_delete=False,
    disabled=False,
    # With this configuration:
    # ------------------------
    # * A revision will be created anytime a document is modified or deleted.
    # * Revisions of a deleted document can be accessed in the Revisions Bin view.
    # * Only the latest 100 revisions will be kept. Older ones will be discarded.
    # * Older revisions will be removed if they exceed 7 days on next revision creation.
    # * A maximum of 15 revisions will be deleted each time a document is updated,
    #   until the defined '# of revisions to keep' limit is reached.
)

employees_rev_config = RevisionsCollectionConfiguration(
    minimum_revisions_to_keep=50,
    minimum_revisions_age_to_keep=timedelta(hours=12),
    purge_on_delete=True,
    disabled=False,
    # With this configuration:
    # ------------------------
    # * A revision will be created anytime an Employee document is modified.
    # * When a document is deleted all its revisions will be removed.
    # * At least 50 of the latest revisions will be kept.
    # * Older revisions will be removed if they exceed 12 hours on next revision creation.
)

# ==============================================================================
# Define a specific configuration for the EMPLOYEES collection
# This will override the default settings
products_rev_config = RevisionsCollectionConfiguration(
    disabled=True
    # No revisions will be created for the Products collection,
    # even though default configuration is enabled
)

# ==============================================================================
# Combine all configurations in the RevisionsConfiguration object
revisions_config = RevisionsConfiguration(
    default_config=default_rev_config,
    collections=\{"Employees": employees_rev_config, "Products": products_rev_config\},
)

# ==============================================================================
# Define the configure revisions operation, pass the configuration
configure_revisions_op = ConfigureRevisionsOperation(revisions_config)

# Execute the operation by passing it to Maintenance.Send
# Any existing configuration will be replaced with the new configuration passed
store.maintenance.send(configure_revisions_op)
`}
</CodeBlock>
</TabItem>



## Modify configuration

In this example, we fetch the existing revisions configuration from the database record and **modify** it.   
<TabItem value="modify_configuration" label="modify_configuration">
<CodeBlock language="python">
{`# ==============================================================================
# Define the get database record operation:
get_database_record_op = GetDatabaseRecordOperation(store.database)
# Get the current revisions configuration from the database record:
revisions_config = store.maintenance.server.send(get_database_record_op).revisions

# ==============================================================================
# If no revisions configuration exists, then create a new configuration
if revisions_config is None:
    revisions_config = RevisionsConfiguration(
        default_config=default_rev_config,
        collections=\{"Employees": employees_rev_config, "Products": products_rev_config\},
    )

# ==============================================================================
# If a revisions configuration already exists, then modify it
else:
    revisions_config.default_config = default_rev_config
    revisions_config.collections["Employees"] = employees_rev_config
    revisions_config.collections["Products"] = products_rev_config

# ==============================================================================
# Define the configure revisions operation, pass the configuration
configure_revisions_op = ConfigureRevisionsOperation(revisions_config)

# Execute the operation by passing it to maintenance.send
# The existing configuration will be updated
store.maintenance.send(configure_revisions_op)

# Execute the operation by passing it to maintenance.send
# The existing configuration will be updated
store.maintenance.send(configure_revisions_op)
`}
</CodeBlock>
</TabItem>



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="python">
{`class ConfigureRevisionsOperation(MaintenanceOperation[ConfigureRevisionsOperationResult]):
    def __init__(self, configuration: RevisionsConfiguration): ...
`}
</CodeBlock>
</TabItem>

| Parameter | Type | Description |
| - | - | - |
| **configuration** | `RevisionsConfiguration` | The revisions configuration to apply |

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="python">
{`class RevisionsConfiguration:
    def __init__(
        self,
        default_config: RevisionsCollectionConfiguration = None,
        collections: Dict[str, RevisionsCollectionConfiguration] = None,
    ): ...
`}
</CodeBlock>
</TabItem>

| Property | Type | Description |
| - | - | - |
| **default_config** | `RevisionsCollectionConfiguration` | Optional default settings that apply to any collection Not specified in `collections`. |
| **collections** | `Dict[str, RevisionsCollectionConfiguration]` | A Dictionary of collection-specific configurations<br/>The `keys` are the collection names<br/>The `values` are the corresponding configurations.<br/>Overrides the default settings for the collections defined. |

<TabItem value="syntax_3" label="syntax_3">
<CodeBlock language="python">
{`class RevisionsCollectionConfiguration:
    def __init__(
        self,
        minimum_revisions_to_keep: int = None,
        minimum_revisions_age_to_keep: timedelta = None,
        disabled: bool = False,
        purge_on_delete: bool = False,
        maximum_revisions_to_delete_upon_document_creation: int = None,
    ): ...
`}
</CodeBlock>
</TabItem>

<a id="revisions-collection-configuration-object"/>

| Property | Type | Description |
| - | - | - |
| **minimum_revisions_to_keep** | `int` | &lt;ul&gt;&lt;li&gt;This number of revisions will be kept per document.&lt;/li&gt;&lt;li&gt;Older revisions exceeding this number will be purged upon the next document modification.&lt;li&gt; **Default** : `None` = no limit &lt;/li&gt;&lt;/ul&gt; |
| **minimum_revisions_age_to_keep** | `timedelta` | &lt;ul&gt;&lt;li&gt;Limit the number of revisions kept per document by their age.&lt;/li&gt;&lt;li&gt;Revisions that are older than this time will be purged upon the next document modification.&lt;/li&gt;&lt;li&gt; **Default** : `None` = no age limit&lt;/li&gt;&lt;ul&gt; |
| **disabled** | `bool` | &lt;ul&gt;&lt;li&gt;`fFalse` ( **Default** ) - Revisions will be created and purged according to the configuration.&lt;/li&gt;&lt;li&gt;`True` - No revisions will be created or purged.&lt;/li&gt;&lt;/ul&gt; |
| **purge_on_delete** | `bool` | &lt;ul&gt;&lt;li&gt;`False` ( **Default** ) - Revisions of a deleted document are moved to the [Revisions Bin](../../../../studio/database/document-extensions/revisions.mdx#revisions-bin).&lt;/li&gt;&lt;li&gt;`True` - When a document is deleted all its revisions are also deleted.&lt;/li&gt;&lt;/ul&gt; |
| **maximum_revisions_to_delete_upon_document_creation** | `int` | &lt;ul&gt;&lt;li&gt;The maximum number of revisions to delete upon each document modification.&lt;/li&gt;&lt;li&gt; **Default** : `None` = no limit,<br/> all revisions that pend purging will be deleted.&lt;/li&gt;&lt;/ul&gt; |




