---
title: "Perform a Lazy Query"
hide_table_of_contents: true
sidebar_label: Perform a Lazy Query
sidebar_position: 15
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "java", "python", "php", "nodejs"];


# Perform a Lazy Query
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">

<Admonition type="note" title="">

* Query execution can be deferred: the query can be defined as **Lazy**, and executed 
  at a later time, when its results are actually needed.  

* This article contains examples for lazy queries. Prior to reading it, please refer 
  to [perform requests lazily](../../../client-api/session/how-to/perform-operations-lazily.mdx) 
  for general knowledge about RavenDB's lazy behavior and other request types that can be 
  executed lazily within a session.

* In this page:
  * [Lazy query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-query)  
  * [Lazy count query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-count-query)  
  * [Lazy suggestions query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-suggestions-query)  
  * [Lazy facets query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-facets-query)  
  * [Syntax](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#syntax)

</Admonition>
## Lazy query

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_query" label="Lazy_query">
<CodeBlock language="csharp">
{`// Define a lazy query
Lazy<IEnumerable<Employee>> lazyEmployees = session
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
     // Add a call to 'Lazily'
    .Lazily();

IEnumerable<Employee> employees = lazyEmployees.Value; // Query is executed here
`}
</CodeBlock>
</TabItem>
<TabItem value="Lazy_query_async" label="Lazy_query_async">
<CodeBlock language="csharp">
{`// Define a lazy query
Lazy<Task<IEnumerable<Employee>>> lazyEmployees = asyncSession
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
     // Add a call to 'LazilyAsync'
    .LazilyAsync();

IEnumerable<Employee> employees = await lazyEmployees.Value; // Query is executed here
`}
</CodeBlock>
</TabItem>
<TabItem value="Lazy_documentQuery" label="Lazy_documentQuery">
<CodeBlock language="csharp">
{`// Define a lazy DocumentQuery
Lazy<IEnumerable<Employee>> lazyEmployees = session.Advanced
    .DocumentQuery<Employee>()
    .WhereEquals(x => x.FirstName, "Robert")
     // Add a call to 'Lazily'
    .Lazily();

IEnumerable<Employee> employees = lazyEmployees.Value; // DocumentQuery is executed here
`}
</CodeBlock>
</TabItem>
</Tabs>

* Learn more about queries in this [query overview](../../../client-api/session/querying/how-to-query.mdx).



## Lazy count query

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_query" label="Lazy_query">
<CodeBlock language="csharp">
{`// Define a lazy count query
Lazy<int> lazyCount = session
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
     // Add a call to 'CountLazily'
    .CountLazily();

int count = lazyCount.Value; // Query is executed here
`}
</CodeBlock>
</TabItem>
<TabItem value="Lazy_query_async" label="Lazy_query_async">
<CodeBlock language="csharp">
{`// Define a lazy count query
Lazy<Task<int>> lazyCount = asyncSession
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
     // Add a call to 'CountLazilyAsync'
    .CountLazilyAsync();

int count = await lazyCount.Value; // Query is executed here
`}
</CodeBlock>
</TabItem>
<TabItem value="Lazy_documentQuery" label="Lazy_documentQuery">
<CodeBlock language="csharp">
{`// Define a lazy DocumentQuery
Lazy<int> lazyCount = session.Advanced
    .DocumentQuery<Employee>()
    .WhereEquals(x => x.FirstName, "Robert")
     // Add a call to 'CountLazily'
    .CountLazily();

int count = lazyCount.Value; // DocumentQuery is executed here
`}
</CodeBlock>
</TabItem>
</Tabs>



## Lazy suggestions query

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_query" label="Lazy_query">
<CodeBlock language="csharp">
{`// Define a lazy suggestion query
Lazy<Dictionary<string, SuggestionResult>> lazySuggestions = session
    .Query<Product>()
    .SuggestUsing(builder => builder.ByField(x => x.Name, "chaig"))
     // Add a call to 'ExecuteLazy'
    .ExecuteLazy();

Dictionary<string, SuggestionResult> suggest = lazySuggestions.Value; // Query is executed here
List<string> suggestions = suggest["Name"].Suggestions;
`}
</CodeBlock>
</TabItem>
<TabItem value="Lazy_query_async" label="Lazy_query_async">
<CodeBlock language="csharp">
{`// Define a lazy suggestion query
Lazy<Task<Dictionary<string, SuggestionResult>>> lazySuggestions = asyncSession
    .Query<Employee>()
    .SuggestUsing(builder => builder.ByField("Name", "chaig"))
     // Add a call to 'ExecuteLazyAsync'
    .ExecuteLazyAsync();

Dictionary<string, SuggestionResult> suggest = await lazySuggestions.Value; // Query is executed here
List<string> suggestions = suggest["Name"].Suggestions;
`}
</CodeBlock>
</TabItem>
<TabItem value="Lazy_documentQuery" label="Lazy_documentQuery">
<CodeBlock language="csharp">
{`// Define a lazy DocumentQuery
Lazy<Dictionary<string, SuggestionResult>> lazySuggestions = session.Advanced
    .DocumentQuery<Employee>()
    .SuggestUsing(builder => builder.ByField("Name", "chaig"))
     // Add a call to 'ExecuteLazy'
    .ExecuteLazy();

Dictionary<string, SuggestionResult> suggest = lazySuggestions.Value; // DocumentQuery is executed here
List<string> suggestions = suggest["FullName"].Suggestions;
`}
</CodeBlock>
</TabItem>
</Tabs>

* Learn more about suggestions in [query for suggestions](../../../client-api/session/querying/how-to-work-with-suggestions.mdx).



## Lazy facets query

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_query" label="Lazy_query">
<CodeBlock language="csharp">
{`// Define a lazy facets query
Lazy<Dictionary<string, FacetResult>> lazyFacets = session
    .Query<Product, Products_ByCategoryAndPrice>()
    .AggregateBy(facetsDefinition)
     // Add a call to 'ExecuteLazy'
    .ExecuteLazy();

Dictionary<string, FacetResult> facets = lazyFacets.Value; // Query is executed here

FacetResult categoryResults = facets["Product Category"];
FacetResult priceResults = facets["Price per Unit"];
`}
</CodeBlock>
</TabItem>
<TabItem value="Lazy_query_async" label="Lazy_query_async">
<CodeBlock language="csharp">
{`// Define a lazy DocumentQuery
Lazy<Task<Dictionary<string,FacetResult>>> lazyFacets = asyncSession
    .Query<Product, Products_ByCategoryAndPrice>()
    .AggregateBy(facetsDefinition)
     // Add a call to 'ExecuteLazyAsync'
    .ExecuteLazyAsync();

Dictionary<string, FacetResult> facets = await lazyFacets.Value; // Query is executed here

FacetResult categoryResults = facets["Product Category"];
FacetResult priceResults = facets["Price per Unit"];
`}
</CodeBlock>
</TabItem>
<TabItem value="Lazy_documentQuery" label="Lazy_documentQuery">
<CodeBlock language="csharp">
{`// Define a lazy DocumentQuery
Lazy<Dictionary<string, FacetResult>> lazyFacets = session.Advanced
    .DocumentQuery<Product, Products_ByCategoryAndPrice>()
    .AggregateBy(facetsDefinition)
     // Add a call to 'ExecuteLazy'
    .ExecuteLazy();

Dictionary<string, FacetResult> facets = lazyFacets.Value; //  DocumentQuery is executed here

FacetResult categoryResults = facets["Product Category"];
FacetResult priceResults = facets["Price per Unit"];
`}
</CodeBlock>
</TabItem>
<TabItem value="Facets_definition" label="Facets_definition">
<CodeBlock language="csharp">
{`// The facets definition used in the facets query:
List<FacetBase> facetsDefinition = new List<FacetBase>
{
    new Facet
    {
        FieldName = "CategoryName",
        DisplayFieldName = "Product Category"
    },
    new RangeFacet<Product>
    {
        Ranges =
        {
            product => product.PricePerUnit < 25,
            product => product.PricePerUnit >= 25 && product.PricePerUnit < 50,
            product => product.PricePerUnit >= 50 && product.PricePerUnit < 100,
            product => product.PricePerUnit >= 100
        },
        DisplayFieldName = "Price per Unit"
    }
};
`}
</CodeBlock>
</TabItem>
<TabItem value="Index_definition" label="Index_definition">
<CodeBlock language="csharp">
{`// The index definition used in the facets query:
public class Products_ByCategoryAndPrice :
    AbstractIndexCreationTask<Product, Products_ByCategoryAndPrice.IndexEntry>
{
    // The IndexEntry class defines the index-fields
    public class IndexEntry
    {
        public string CategoryName { get; set; }
        public decimal PricePerUnit { get; set; }
    }
        
    public Products_ByCategoryAndPrice()
    {
        // The 'Map' function defines the content of the index-fields
        Map = products => from product in products
            select new IndexEntry
            {
                CategoryName = LoadDocument<Category>(product.Category).Name,
                PricePerUnit = product.PricePerUnit
            };
    }
}
`}
</CodeBlock>
</TabItem>
</Tabs>

* Learn more about facets in [perform faceted search](../../../client-api/session/querying/how-to-perform-a-faceted-search.mdx).



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="csharp">
{`// Lazy query overloads:
Lazy<IEnumerable<T>> Lazily<T>();
Lazy<IEnumerable<T>> Lazily<T>(Action<IEnumerable<T>> onEval);

Lazy<Task<IEnumerable<T>>> LazilyAsync<T>();
Lazy<Task<IEnumerable<T>>> LazilyAsync<T>(Action<IEnumerable<T>> onEval);
`}
</CodeBlock>
</TabItem>
<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="csharp">
{`// Lazy count query overloads:
Lazy<int> CountLazily<T>();
Lazy<long> LongCountLazily<T>();

Lazy<Task<int>> CountLazilyAsync<T>(CancellationToken token = default(CancellationToken));
Lazy<Task<long>> LongCountLazilyAsync<T>(CancellationToken token = default(CancellationToken));
`}
</CodeBlock>
</TabItem>
<TabItem value="syntax_3" label="syntax_3">
<CodeBlock language="csharp">
{`// Lazy suggestions query overloads:
Lazy<Dictionary<string, SuggestionResult>>
    ExecuteLazy(Action<Dictionary<string, SuggestionResult>> onEval = null);

Lazy<Task<Dictionary<string, SuggestionResult>>>
    ExecuteLazyAsync(Action<Dictionary<string, SuggestionResult>> onEval = null,
        CancellationToken token = default);
`}
</CodeBlock>
</TabItem>
<TabItem value="syntax_4" label="syntax_4">
<CodeBlock language="csharp">
{`// Lazy facets query overloads:
Lazy<Dictionary<string, FacetResult>>
    ExecuteLazy(Action<Dictionary<string, FacetResult>> onEval = null);

Lazy<Task<Dictionary<string, FacetResult>>>
    ExecuteLazyAsync(Action<Dictionary<string, FacetResult>> onEval = null,
        CancellationToken token = default);
`}
</CodeBlock>
</TabItem>

| Parameters | Type                                                                                                                              | Description                                                                          |
|------------|-----------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
| **onEval** | `Action<IEnumerable<TResult>>` <br/> `Action<Dictionary<string, SuggestionResult>>` <br/> `Action<Dictionary<string, FacetResult>>` | An action that will be performed on the query results<br/>when the query is executed. |

| Return Value                                                                                                                           |                                                                |
|----------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
| `Lazy<IEnumerable<TResult>>`<br/>`Lazy<int>`<br/>`Lazy<Dictionary<string, SuggestionResult>>`<br/>`Lazy<Dictionary<string, FacetResult>>` | A lazy instance that will evaluate the query only when needed. |




</LanguageContent>
<LanguageContent language="java">


In some situations, query execution must be delayed. To cover such a scenario, `lazily` and many other query extensions have been introduced.

## Lazily

<TabItem value="lazy_1" label="lazy_1">
<CodeBlock language="java">
{`Lazy<List<T>> lazily();

Lazy<List<T>> lazily(Consumer<List<T>> onEval);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **onEval** | Consumer&lt;List&lt;TResult&gt;&gt; | An action that will be performed on the query results. |

| Return Value | |
| ------------- | ----- |
| Lazy&lt;List&lt;TResult&gt;&gt; | Lazy query initializer returning query results. |

### Example

<TabItem value="lazy_2" label="lazy_2">
<CodeBlock language="java">
{`Lazy<List<Employee>> employeesLazy = session
    .query(Employee.class)
    .whereEquals("FirstName", "Robert")
    .lazily();

List<Employee> employees = employeesLazy.getValue(); // query will be executed here
`}
</CodeBlock>
</TabItem>



## Counts

<TabItem value="lazy_4" label="lazy_4">
<CodeBlock language="java">
{`Lazy<Integer> countLazily();
`}
</CodeBlock>
</TabItem>

| Return Value | |
| ------------- | ----- |
| Lazy&lt;Integer&gt; | Lazy query initializer returning a count of matched documents. |

### Example

<TabItem value="lazy_5" label="lazy_5">
<CodeBlock language="java">
{`Lazy<Integer> countLazy = session
    .query(Employee.class)
    .whereEquals("FirstName", "Robert")
    .countLazily();

Integer count = countLazy.getValue(); // query will be executed here
`}
</CodeBlock>
</TabItem>



## Suggestions

<TabItem value="lazy_6" label="lazy_6">
<CodeBlock language="java">
{`Lazy<Map<String, SuggestionResult>> executeLazy();

Lazy<Map<String, SuggestionResult>> executeLazy(Consumer<Map<String, SuggestionResult>> onEval);
`}
</CodeBlock>
</TabItem>

| Return Value | |
| ------------- | ----- |
| Lazy&lt;Map&lt;String, SuggestionResult&gt;&gt; | Lazy query initializer containing a map with suggestions for matching executed query |

### Example

<TabItem value="lazy_7" label="lazy_7">
<CodeBlock language="java">
{`Lazy<Map<String, SuggestionResult>> suggestLazy = session
    .query(Employee.class, Query.index("Employees_ByFullName"))
    .suggestUsing(builder -> builder.byField("FullName", "johne"))
    .executeLazy();

Map<String, SuggestionResult> suggest = suggestLazy.getValue(); // query will be executed here
List<String> suggestions = suggest.get("FullName").getSuggestions();
`}
</CodeBlock>
</TabItem>



## Facets

<TabItem value="lazy_8" label="lazy_8">
<CodeBlock language="java">
{`Lazy<Map<String, FacetResult>> executeLazy();

Lazy<Map<String, FacetResult>> executeLazy(Consumer<Map<String, FacetResult>> onEval);
`}
</CodeBlock>
</TabItem>

| Return Value | |
| ------------- | ----- |
| Lazy&lt;Map&lt;String, FacetResult&gt;&gt; | Lazy query initializer containing a map with facet results matching executed query |

### Example

<TabItem value="lazy_9" label="lazy_9">
<CodeBlock language="java">
{`Lazy<Map<String, FacetResult>> facetsLazy = session
    .query(Camera.class, Query.index("Camera/Costs"))
    .aggregateUsing("facets/CameraFacets")
    .executeLazy();

Map<String, FacetResult> facets = facetsLazy.getValue(); // query will be executed here
FacetResult results = facets.get("manufacturer");
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="python">

<Admonition type="note" title="">

* Query execution can be deferred: the query can be defined as **Lazy**, and executed 
  at a later time, when its results are actually needed.  

* This article contains examples for lazy queries. Prior to reading it, please refer 
  to [perform requests lazily](../../../client-api/session/how-to/perform-operations-lazily.mdx) 
  for general knowledge about RavenDB's lazy behavior and other request types that can be 
  executed lazily within a session.

* In this page:
  * [Lazy query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-query)  
  * [Lazy count query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-count-query)  
  * [Lazy suggestions query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-suggestions-query)  
  * [Lazy facets query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-facets-query)  
  * [Syntax](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#syntax)

</Admonition>
## Lazy query

To run a [regular query](../../../client-api/session/querying/how-to-query.mdx) 
(not a [suggestions](../../../client-api/session/querying/how-to-work-with-suggestions.mdx) 
query or a [faceted search](../../../client-api/session/querying/how-to-perform-a-faceted-search.mdx)) 
lazily, use `.lazily()` as follows.  

<TabItem value="lazy_1" label="lazy_1">
<CodeBlock language="python">
{`# Define a lazy query
lazy_employees = (
    session.query(object_type=Employee).where_equals("first_name", "Robert")
    # Add a call to 'Lazily'
    .lazily()
)

employees = lazy_employees.value  # Query is executed here
`}
</CodeBlock>
</TabItem>



## Lazy count query

To count query results lazily, use `count_lazily()` as follows.  

<TabItem value="lazy_4" label="lazy_4">
<CodeBlock language="python">
{`lazy_count = session.query(object_type=Employee).where_equals("first_name", "Robert").count_lazily()

count = lazy_count.value  # Query is executed here
`}
</CodeBlock>
</TabItem>



## Lazy suggestions query

To run a suggestions search lazily, use [suggest_using](../../../client-api/session/querying/how-to-work-with-suggestions.mdx) 
along with `.execute_lazy()` as shown below.

<TabItem value="lazy_7" label="lazy_7">
<CodeBlock language="python">
{`lazy_suggestions = (
    session.query(object_type=Product).suggest_using(lambda builder: builder.by_field("name", "chaig"))
    # Add a call to 'execute_lazy'
    .execute_lazy()
)

suggest = lazy_suggestions.value  # Query is executed here
suggestions = suggest["name"].suggestions
`}
</CodeBlock>
</TabItem>



## Lazy facets query

To run a faceted query lazily:  

* Search a predefined static index (see _Index_definition_ below)
* Aggregate the results using a facets definition (see _Facets_definition_ below)
* Apply `.execute_lazy()` (see _Query_ below)

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="python">
{`# Define a lazy facets query
lazy_facets = (
    session.query_index_type(
        Products_ByCategoryAndPrice, Products_ByCategoryAndPrice.IndexEntry
    ).aggregate_by_facets(facets_definition)
    # Add a call to 'execute_lazy'
    .execute_lazy()
)

facets = lazy_facets.value  # Query is executed here

category_results = facets["Product Category"]
price_results = facets["Price per Unit"]
`}
</CodeBlock>
</TabItem>
<TabItem value="Facets_definition" label="Facets_definition">
<CodeBlock language="python">
{`# The facets definition used in the facets query
facet = Facet(field_name="CategoryName")
facet.display_field_name = "Product Category"

range_facet = RangeFacet()
range_facet.ranges = [
    "price_per_unit < 200",
    "price_per_unit between 200 and 400",
    "price_per_unit between 400 and 600",
    "price_per_unit between 600 and 800",
    "price_per_unit >= 800",
]
range_facet.display_field_name = "Price per Unit"

facets_definition = [facet, range_facet]

with store.open_session() as session:
    # region lazy_10
    # Define a lazy facets query
    lazy_facets = (
        session.query_index_type(
            Products_ByCategoryAndPrice, Products_ByCategoryAndPrice.IndexEntry
        ).aggregate_by_facets(facets_definition)
        # Add a call to 'execute_lazy'
        .execute_lazy()
    )

    facets = lazy_facets.value  # Query is executed here

    category_results = facets["Product Category"]
    price_results = facets["Price per Unit"]
`}
</CodeBlock>
</TabItem>
<TabItem value="Index_definition" label="Index_definition">
<CodeBlock language="python">
{`# The index definition used in the facets query
class Products_ByCategoryAndPrice(AbstractIndexCreationTask):
    def __init__(self):
        super().__init__()
        self.map = (
            "from p in docs.Products select new {"
            'CategoryName = LoadDocument(p.Category, "Categories").Name, PricePerUnit = p.PricePerUnit'
            "}"
        )

    class IndexEntry:
        def __init__(self, category_name: str, price_per_unit: int):
            self.category_name = category_name
            self.price_per_unit = price_per_unit
`}
</CodeBlock>
</TabItem>
</Tabs>

<Admonition type="note" title="">
Learn more about facets in [perform faceted search](../../../client-api/session/querying/how-to-perform-a-faceted-search.mdx).
</Admonition>



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="python">
{`# Lazy query
def lazily(self, on_eval: Callable[[List[_T]], None] = None) -> Lazy[List[_T]]: ...
`}
</CodeBlock>
</TabItem>
<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="python">
{`# Lazy count query
def count_lazily(self) -> Lazy[int]: ...
`}
</CodeBlock>
</TabItem>
<TabItem value="syntax_3" label="syntax_3">
<CodeBlock language="python">
{`# Lazy suggestions query
def execute_lazy(
    self, on_eval: Optional[Callable[[Dict[str, SuggestionResult]], None]] = None
) -> "Lazy[Dict[str, SuggestionResult]]": ...
`}
</CodeBlock>
</TabItem>
<TabItem value="syntax_4" label="syntax_4">
<CodeBlock language="python">
{`# Lazy facet query
def execute_lazy(
    self, on_eval: Optional[Callable[[Dict[str, FacetResult]], None]] = None
) -> Lazy[Dict[str, FacetResult]]: ...
`}
</CodeBlock>
</TabItem>

| Parameters | Type                                                                                                                              | Description                                                                          |
|------------|-----------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------|
| **on_eval** | `Callable[[List[_T]], None]`<br/>`Callable[[Dict[str, SuggestionResult]], None]` (optional)<br/>`Callable[[Dict[str, FacetResult]], None]` (optional)| An action that will be performed on the query results when the query is executed. |

| Return Value                                                                                                                           |                                                                |
|----------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
| `Lazy[List[_T]]`<br/>`Lazy[Dict[str, SuggestionResult]]`<br/>`Lazy[Dict[str, FacetResult]]` | A lazy instance that will evaluate the query only when needed. |
| `Lazy[int]` | The results of a lazy count query |



</LanguageContent>
<LanguageContent language="php">

<Admonition type="note" title="">

* Query execution can be deferred: the query can be defined as **Lazy**, and executed 
  at a later time, when its results are actually needed.  

* This article contains examples for lazy queries. Prior to reading it, please refer 
  to [perform requests lazily](../../../client-api/session/how-to/perform-operations-lazily.mdx) 
  for general knowledge about RavenDB's lazy behavior and other request types that can be 
  executed lazily within a session.

* Learn more about queries in this [query overview](../../../client-api/session/querying/how-to-query.mdx).

* In this page:
  * [Lazy query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-query)  
  * [Lazy count query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-count-query)  
  * [Lazy suggestions query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-suggestions-query)  
  * [Lazy Aggregation](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-aggregation)  
  * [Syntax](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#syntax)

</Admonition>
## Lazy query

<TabItem value="lazy_2" label="lazy_2">
<CodeBlock language="php">
{`/** @var Lazy<array<Employee>> $employeesLazy */
$employeesLazy = $session
    ->query(Employee::class)
    ->whereEquals("FirstName", "Robert")
    ->lazily();

/** @var array<Employee> $employees */
$employees = $employeesLazy->getValue(); // query will be executed here
`}
</CodeBlock>
</TabItem>



## Lazy count query

<TabItem value="lazy_5" label="lazy_5">
<CodeBlock language="php">
{`/** @var Lazy<int> $countLazy */
$countLazy = $session
    ->query(Employee::class)
    ->whereEquals("FirstName", "Robert")
    ->countLazily();

/** @var int $count */
$count = $countLazy->getValue(); // query will be executed here
`}
</CodeBlock>
</TabItem>



## Lazy suggestions query

<TabItem value="lazy_7" label="lazy_7">
<CodeBlock language="php">
{`/** @var Lazy<array<string, SuggestionResult>> $suggestLazy */
$suggestLazy = $session
    ->query(Employee::class, Query::index("Employees_ByFullName"))
    ->suggestUsing(function($builder) \{ $builder->byField("FullName", "johne"); \})
    ->executeLazy();

/** @var array<string, SuggestionResult> $suggest */
$suggest = $suggestLazy->getValue(); // query will be executed here

/** @var array<string> $suggestions */
$suggestions = $suggest["FullName"]->getSuggestions();
`}
</CodeBlock>
</TabItem>

* Learn more about suggestions in [query for suggestions](../../../client-api/session/querying/how-to-work-with-suggestions.mdx).



## Lazy aggregation

<TabItem value="lazy_9" label="lazy_9">
<CodeBlock language="php">
{`/** @var Lazy<array<string, FacetResult>> $facetsLazy */
$facetsLazy = $session
    ->query(Camera::class, Query::index("Camera/Costs"))
    ->aggregateUsing("facets/CameraFacets")
    ->executeLazy();

/** @var array<string, FacetResult> $facets */
$facets = $facetsLazy->getValue(); // query will be executed here

/** @var FacetResult $results */
$results = $facets["manufacturer"];
`}
</CodeBlock>
</TabItem>



## Syntax

<TabItem value="lazy_1" label="lazy_1">
<CodeBlock language="php">
{`/**
 * Usage
 *   - lazily();
 *   - lazily(Closure $onEval)
 */
function lazily(?Closure $onEval = null): Lazy;
`}
</CodeBlock>
</TabItem>
<TabItem value="lazy_4" label="lazy_4">
<CodeBlock language="php">
{`function countLazily(): Lazy;
`}
</CodeBlock>
</TabItem>
<TabItem value="lazy_6" label="lazy_6">
<CodeBlock language="php">
{`/**
 * Usage
 *   - executeLazy();
 *   - executeLazy(Closure $onEval)
 */
public function executeLazy(?Closure $onEval = null): Lazy;
`}
</CodeBlock>
</TabItem>

| Parameters | Type       | Description                                                           |
|------------|------------------------------------------------------------------------------------|
| **$onEval** | `?Closure` | An action to perform on the query results when the query is executed |

| Return Value                                                                                                                           |                                                                |
|------------------------------------------------------------------------|
| `Lazy` | A lazy instance that will evaluate the query only when needed |




</LanguageContent>
<LanguageContent language="nodejs">

<Admonition type="note" title="">

* Query execution can be deferred: the query can be defined as **Lazy**, and executed 
  at a later time, when its results are actually needed.  

* This article contains examples for lazy queries. Prior to reading it, please refer 
  to [perform requests lazily](../../../client-api/session/how-to/perform-operations-lazily.mdx) 
  for general knowledge about RavenDB's lazy behavior and other request types that can be 
  executed lazily within a session.

* In this page:
    * [Lazy query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-query)
    * [Lazy count query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-count-query)
    * [Lazy suggestions query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-suggestions-query)
    * [Lazy facets query](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#lazy-facets-query)
    * [Syntax](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx#syntax)

</Admonition>
## Lazy query

<TabItem value="lazy_1" label="lazy_1">
<CodeBlock language="js">
{`// Define a lazy query
const lazyEmployees = session
    .query(\{ collection: "Employees" \})
    .whereEquals("FirstName", "Robert")
     // Add a call to 'lazily'
    .lazily();

const employees = await lazyEmployees.getValue(); // Query is executed here
`}
</CodeBlock>
</TabItem>

* Learn more about queries in this [query overview](../../../client-api/session/querying/how-to-query.mdx).



## Lazy count query

<TabItem value="lazy_2" label="lazy_2">
<CodeBlock language="js">
{`// Define a lazy count query
const lazyCount = session
    .query(\{ collection: "Employees" \})
    .whereEquals("FirstName", "Robert")
     // Add a call to 'countLazily'
    .countLazily();

const count = await lazyCount.getValue(); // Query is executed here
`}
</CodeBlock>
</TabItem>



## Lazy suggestions query

<TabItem value="lazy_3" label="lazy_3">
<CodeBlock language="js">
{`// Define a lazy suggestion query
const lazySuggestions = session
    .query(\{ collection: "Products" \})
    .suggestUsing(builder => builder.byField("Name", "chaig"))
     // Add a call to 'executeLazy'
    .executeLazy();

const suggestResult = await lazySuggestions.getValue(); // Query is executed here
const suggestions = suggestResult["Name"].suggestions;
`}
</CodeBlock>
</TabItem>

* Learn more about suggestions in [query for suggestions](../../../client-api/session/querying/how-to-work-with-suggestions.mdx).



## Lazy facets query

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_query" label="Lazy_query">
<CodeBlock language="js">
{`// The facets definition used in the facets query:
// ===============================================
const categoryNameFacet = new Facet();

categoryNameFacet.fieldName = "categoryName";
categoryNameFacet.displayFieldName = "Product Category";

const rangeFacet = new RangeFacet();
rangeFacet.ranges = [
    "pricePerUnit < " + 25,
    "pricePerUnit >= " + 25 + " and pricePerUnit < " + 50,
    "pricePerUnit >= " + 50 + " and pricePerUnit < " + 100,
    "pricePerUnit >= " + 100
];
rangeFacet.displayFieldName = 'Price per Unit';

const facetsDefinition = [categoryNameFacet, rangeFacet];

// The lazy factes query:
// ======================
const lazyFacets = session
    .query({ indexName: "Products/ByCategoryAndPrice" })
    .aggregateBy(...facetsDefinition)
     // Add a call to 'executeLazy'
    .executeLazy();

const facets = await lazyFacets.getValue(); // Query is executed here

const categoryResults = facets["Product Category"];
const priceResults = facets["Price per Unit"];
`}
</CodeBlock>
</TabItem>
<TabItem value="Index_definition" label="Index_definition">
<CodeBlock language="js">
{`// The index definition used in the facets query:
class Products_ByCategoryAndPrice extends AbstractJavaScriptIndexCreationTask {
    constructor() {
        super();

        const { load } = this.mapUtils();

        this.map("Products", product => {
            return {
                categoryName: load(product.Category, "Categories").Name,
                pricePerUnit: product.PricePerUnit
            }
        });
    }
}
`}
</CodeBlock>
</TabItem>
</Tabs>

* Learn more about facets in [perform faceted search](../../../client-api/session/querying/how-to-perform-a-faceted-search.mdx).



## Syntax

<TabItem value="syntax" label="syntax">
<CodeBlock language="js">
{`lazily();
lazily(onEval);

countLazily();

executeLazy();
`}
</CodeBlock>
</TabItem>

| Parameters | Type                 | Description                                                                          |
|------------|----------------------|--------------------------------------------------------------------------------------|
| **onEval** | `(object[]) => void` | An action that will be performed on the query results<br/>when the query is executed. |

| Return Value |                                                                  |
|--------------|------------------------------------------------------------------|
| **object**   | A `Lazy` instance that will evaluate the query only when needed. |




</LanguageContent>

<!---
### Session
- [Query overview](../../../client-api/session/querying/how-to-query)
- [Perform requests lazily](../../../client-api/session/how-to/perform-operations-lazily)
- [Querying: Basics](../../../indexes/querying/query-index)
- [query for suggestions](../../../client-api/session/querying/how-to-work-with-suggestions)


-->