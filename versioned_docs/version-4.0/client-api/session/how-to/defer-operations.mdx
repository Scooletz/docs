---
title: "Session: How to Defer Operations"
hide_table_of_contents: true
sidebar_label: ...defer commands
sidebar_position: 3
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "java", "nodejs"];


# Session: How to Defer Operations
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">


Operations can be deferred till `SaveChanges` is called by using `Defer` method in `Advanced` session operations. There are six types of commands that can be deferred:

- [PutCommandData](../../../glossary/put-command-data.mdx)
- [DeleteCommandData](../../../glossary/delete-command-data.mdx)
- DeletePrefixedCommandData
- [PatchCommandData](../../../glossary/patch-command-data.mdx)
- PutAttachmentCommandData
- DeleteAttachmentCommandData

## Syntax

<TabItem value="defer_1" label="defer_1">
<CodeBlock language="csharp">
{`// Defer is available in the session's Advanced methods 
session.Advanced.Defer(
    
    // Define commands to be executed:
    // i.e. Put a new document
    new PutCommandData("products/999-A", null, new DynamicJsonValue
        \{
            ["Name"] = "My Product",
            ["Supplier"] = "suppliers/1-A",
            ["@metadata"] = new DynamicJsonValue
            \{
                ["@collection"] = "Products"
            \}
        \}),
    
    // Patch document
    new PatchCommandData("products/999-A", null, new PatchRequest
            \{
                Script = "this.Supplier = 'suppliers/2-A';"
            \},
            null),
    
    // Force a revision to be created
    new ForceRevisionCommandData("products/999-A"),
    
    // Delete a document
    new DeleteCommandData("products/1-A", null)
);

// All deferred commands will be sent to the server upon calling SaveChanges
session.SaveChanges();
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| `ICommandData` | Command to be executed. |
| `ICommandData[]` | Array of commands implementing `ICommandData` interface. |

## Example

<TabItem value="defer_2" label="defer_2">
<CodeBlock language="csharp">
{`session
    .Advanced
    .Defer(
        new PutCommandData("products/999-A", null, new DynamicJsonValue
        \{
            ["Name"] = "My Product",
            ["Supplier"] = "suppliers/999-A",
            ["@metadata"] = new DynamicJsonValue
            \{
                ["@collection"] = "Users"
            \}
        \}),
        new PutCommandData("suppliers/999-A", null, new DynamicJsonValue
        \{
            ["Name"] = "My Product",
            ["Supplier"] = "suppliers/999-A",
            ["@metadata"] = new DynamicJsonValue
            \{
                ["@collection"] = "Suppliers"
            \}
        \}),
        new DeleteCommandData("products/1-A", null)
    );
`}
</CodeBlock>
</TabItem>


</LanguageContent>
<LanguageContent language="java">


Operations can be deferred till `saveChanges` is called by using `defer` method in `advanced` session operations. There are three types of commands that can be deferred:

- PutCommandData
- DeleteCommandData
- DeletePrefixedCommandData
- PatchCommandData
- PutAttachmentCommandData
- DeleteAttachmentCommandData

## Syntax

<TabItem value="defer_1" label="defer_1">
<CodeBlock language="java">
{`void defer(ICommandData command, ICommandData... commands);

void defer(ICommandData[] commands);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| `ICommandData` | Command to be executed. |
| `ICommandData[]` | Array of commands implementing `ICommandData` interface. |

## Example

<TabItem value="defer_2" label="defer_2">
<CodeBlock language="java">
{`Map<String, Object> value1 = new HashMap<>();
value1.put("Name", "My Product");
value1.put("Supplier", "suppliers/999-A");
value1.put("@metadata", Collections.singletonMap("@collection", "Users"));

PutCommandDataWithJson putCommand1 =
    new PutCommandDataWithJson("products/999-A",
        null,
        store.getConventions().getEntityMapper().valueToTree(value1));

HashMap<String, Object> value2 = new HashMap<>();
value2.put("Name", "My Product");
value2.put("Supplier", "suppliers/999-A");
value2.put("@metadata", Collections.singletonMap("@collection", "Suppliers"));

PutCommandDataWithJson putCommand2 =
    new PutCommandDataWithJson("suppliers/999-A",
        null,
        store.getConventions().getEntityMapper().valueToTree(value2));

DeleteCommandData command3 = new DeleteCommandData("products/1-A", null);

session.advanced().defer(putCommand1, putCommand2, command3);
`}
</CodeBlock>
</TabItem>


</LanguageContent>
<LanguageContent language="nodejs">


Operations can be deferred till `saveChanges()` is called by using `defer()` method in `advanced` session operations. There are three types of commands that can be deferred:

- PutCommandData
- DeleteCommandData
- DeletePrefixedCommandData
- PatchCommandData
- PutAttachmentCommandData
- DeleteAttachmentCommandData

## Syntax

<TabItem value="defer_1" label="defer_1">
<CodeBlock language="js">
{`const session = documentStore.openSession();

// Define a patchRequest object for the PatchCommandData used in the 'defer' below
const patchRequest = new PatchRequest();
patchRequest.script = "this.Supplier = 'suppliers/2-A';";

// 'defer' is available in the session's advanced methods 
session.advanced.defer(

    // Define commands to be executed:
    // i.e. Put a new document
    new PutCommandDataBase("products/999-A", null, null, \{
        "Name": "My Product",
        "Supplier": "suppliers/1-A"
        "@metadata": \{ "@collection": "Products" \}
    \}),
    
    // Patch document
    new PatchCommandData("products/999-A", null, patchRequest, null),

    // Force a revision to be created
    new ForceRevisionCommandData("products/999-A"),

    // Delete a document
    new DeleteCommandData("products/1-A", null)
);

// All deferred commands will be sent to the server upon calling SaveChanges
await session.saveChanges();

\}
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| commands | `ICommandData[]` | Command objects implementing `ICommandData` interface. |

## Example

<TabItem value="defer_2" label="defer_2">
<CodeBlock language="js">
{`const value1 = \{
    "name": "My Product",
    "supplier": "suppliers/999-A",
    "@metadata": \{
        "@collection": "Users"
    \}
\};

const putCommand1 =
    new PutCommandDataWithJson("products/999-A",
        null,
        value1);

const value2 = \{
    "name": "My Product",
    "supplier": "suppliers/999-A",
    "@metadata": \{
        "@collection": "Suppliers"
    \}
\};

const putCommand2 =
    new PutCommandDataWithJson("suppliers/999-A",
        null,
        value2);

const command3 = new DeleteCommandData("products/1-A", null);

session.advanced.defer(putCommand1, putCommand2, command3);
`}
</CodeBlock>
</TabItem>


</LanguageContent>

<!---
### Session
- [What is a Session and How Does it Work](../../../client-api/session/what-is-a-session-and-how-does-it-work)
- [Storing Entities](../../../client-api/session/storing-entities)
- [Saving Changes](../../../client-api/session/saving-changes)


-->