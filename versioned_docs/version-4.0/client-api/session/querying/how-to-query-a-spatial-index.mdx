---
title: "Session: Querying: How to Query a Spatial Index"
hide_table_of_contents: true
sidebar_label: How to Query a Spatial Index
sidebar_position: 7
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "java", "nodejs"];


# Session: Querying: How to Query a Spatial Index
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">


Spatial indexes can be queried using the `Spatial` method which contains a full spectrum of spatial methods. The following article will cover these methods:

- [Spatial](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#spatial)
- [OrderByDistance](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#orderbydistance)
- [OrderByDistanceDescending](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#orderbydistancedescending)

## Spatial

<TabItem value="spatial_1" label="spatial_1">
<CodeBlock language="csharp">
{`IRavenQueryable<T> Spatial<T>(
    Expression<Func<T, object>> path,
    Func<SpatialCriteriaFactory, SpatialCriteria> clause);

IRavenQueryable<T> Spatial<T>(
    string fieldName,
    Func<SpatialCriteriaFactory, SpatialCriteria> clause);

IRavenQueryable<T> Spatial<T>(
    Func<DynamicSpatialFieldFactory<T>, DynamicSpatialField> field,
    Func<SpatialCriteriaFactory, SpatialCriteria> clause);

IRavenQueryable<T> Spatial<T>(
    DynamicSpatialField field,
    Func<SpatialCriteriaFactory, SpatialCriteria> clause);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **path** | Expression&lt;Func&lt;T, object&gt;&gt; | Path to spatial field in an index |
| **fieldName** | string | Path to spatial field in an index |
| **field** | Func&lt;DynamicSpatialFieldFactory&lt;T&gt;, DynamicSpatialField&gt; or DynamicSpatialField | Factory or field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **clause** | Func&lt;SpatialCriteriaFactory, SpatialCriteria&gt; | Spatial criteria that will be executed on a given spatial field from the `path` parameter. |

### DynamicSpatialFieldFactory

<TabItem value="spatial_2" label="spatial_2">
<CodeBlock language="csharp">
{`PointField Point(
    Expression<Func<T, object>> latitudePath,
    Expression<Func<T, object>> longitudePath);

WktField Wkt(Expression<Func<T, object>> wktPath);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **latitudePath** or **longitudePath** or **wktPath** | Expression&lt;Func&lt;T, object&gt;&gt; | Path to the field in a document containing either longitude, latitude or WKT |

### SpatialCriteriaFactory

<TabItem value="spatial_3" label="spatial_3">
<CodeBlock language="csharp">
{`SpatialCriteria RelatesToShape(
    string shapeWkt,
    SpatialRelation relation,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria RelatesToShape(
    string shapeWkt,
    SpatialRelation relation,
    SpatialUnits units,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria Intersects(
    string shapeWkt,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria Intersects(
    string shapeWkt,
    SpatialUnits units,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria Contains(
    string shapeWkt,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria Contains(
    string shapeWkt,
    SpatialUnits units,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria Disjoint(
    string shapeWkt,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria Disjoint(
    string shapeWkt,
    SpatialUnits units,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria Within(
    string shapeWkt,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria Within(
    string shapeWkt,
    SpatialUnits units,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);

SpatialCriteria WithinRadius(
    double radius,
    double latitude,
    double longitude,
    SpatialUnits? radiusUnits = null,
    double distErrorPercent = Constants.Documents.Indexing.Spatial.DefaultDistanceErrorPct);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **shapeWkt** | string | WKT-based shape to be used in operation |
| **relation** | SpatialRelation | Shape relation. Can be `Within`, `Contains`, `Disjoint`, `Intersects` |
| **distErrorPercent** | double | Maximum distance error tolerance in percents. Default: 0.025 |
| **radius** or **latitude** or **longitude** | double | Used to define a radius circle |
| **radiusUnits** | SpatialUnits | Determines if circle should be calculated in `Kilometers` or `Miles` units |

### Example I

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
List<House> results = session
    .Query<House>()
    .Spatial(
        factory => factory.Point(x => x.Latitude, x => x.Longitude),
        criteria => criteria.WithinRadius(10, 32.1234, 23.4321))
    .ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
List<House> results = await asyncSession
    .Query<House>()
    .Spatial(
        factory => factory.Point(x => x.Latitude, x => x.Longitude),
        criteria => criteria.WithinRadius(10, 32.1234, 23.4321))
    .ToListAsync();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(Latitude, Longitude), spatial.circle(10, 32.1234. 23.4321))
`}
</CodeBlock>
</TabItem>
</Tabs>

### Example II

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// this equals to WithinRadius(10, 32.1234, 23.4321)
List<House> results = session
    .Query<House>()
    .Spatial(
        factory => factory.Point(x => x.Latitude, x => x.Longitude),
        criteria => criteria.RelatesToShape("Circle(32.1234 23.4321 d=10.0000)", SpatialRelation.Within))
    .ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// this equals to WithinRadius(10, 32.1234, 23.4321)
List<House> results = await asyncSession
    .Query<House>()
    .Spatial(
        factory => factory.Point(x => x.Latitude, x => x.Longitude),
        criteria => criteria.RelatesToShape("Circle(32.1234 23.4321 d=10.0000)", SpatialRelation.Within))
    .ToListAsync();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(Latitude, Longitude), spatial.wkt('Circle(32.1234 23.4321 d=10.0000)'))
`}
</CodeBlock>
</TabItem>
</Tabs>



## OrderByDistance

To sort by distance from given point use the `OrderByDistance` method. The closest results will come first.

<TabItem value="spatial_6" label="spatial_6">
<CodeBlock language="csharp">
{`// From point
IOrderedQueryable<T> OrderByDistance<T>(
    Func<DynamicSpatialFieldFactory<T>, DynamicSpatialField> field,
    double latitude,
    double longitude);

IOrderedQueryable<T> OrderByDistance<T>(
    DynamicSpatialField field,
    double latitude,
    double longitude);

IOrderedQueryable<T> OrderByDistance<T>(
    Expression<Func<T, object>> path,
    double latitude,
    double longitude);

IOrderedQueryable<T> OrderByDistance<T>(
    string fieldName,
    double latitude,
    double longitude);

// From center of WKT shape
IOrderedQueryable<T> OrderByDistance<T>(
    Func<DynamicSpatialFieldFactory<T>, DynamicSpatialField> field,
    string shapeWkt);

IOrderedQueryable<T> OrderByDistance<T>(
    DynamicSpatialField field,
    string shapeWkt);

IOrderedQueryable<T> OrderByDistance<T>(
    Expression<Func<T, object>> path,
    string shapeWkt);

IOrderedQueryable<T> OrderByDistance<T>(
    string fieldName,
    string shapeWkt);

// Rounding
IOrderedQueryable<T> OrderByDistance<T>(
    Expression<Func<T, object>> path,
    double latitude,
    double longitude,
    double roundFactor);

IOrderedQueryable<T> OrderByDistance<T>(
    string fieldName,
    double latitude,
    double longitude,
    double roundFactor);

IOrderedQueryable<T> OrderByDistance<T>(
    Expression<Func<T, object>> path,
    string shapeWkt,
    double roundFactor);

IOrderedQueryable<T> OrderByDistance<T>(
    string fieldName,
    string shapeWkt,
    double roundFactor);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **path** | Expression&lt;Func&lt;T, object&gt;&gt; | Path to spatial field in index |
| **fieldName** | string | Path to spatial field in index |
| **field** | Func&lt;DynamicSpatialFieldFactory&lt;T&gt;, DynamicSpatialField&gt; or DynamicSpatialField | Factory or field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **shapeWkt** | string | WKT-based shape to be used as a point from which distance will be measured. If the shape is not a single point, then the center of the shape will be used as a reference. |
| **latitude** or **longitude** | double | Used to define a point from which distance will be measured |

### Example

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// sort results by distance from 32.1234 latitude and 23.4321 longitude point
List<House> results = session
    .Query<House>()
    .Spatial(
        factory => factory.Point(x => x.Latitude, x => x.Longitude),
        criteria => criteria.WithinRadius(10, 32.1234, 23.4321))
    .OrderByDistance(
        factory => factory.Point(x => x.Latitude, x => x.Longitude), 32.1234, 23.4321)
    .ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// sort results by distance from 32.1234 latitude and 23.4321 longitude point
List<House> results = await asyncSession
    .Query<House>()
    .Spatial(
        factory => factory.Point(x => x.Latitude, x => x.Longitude),
        criteria => criteria.WithinRadius(10, 32.1234, 23.4321))
    .OrderByDistance(
        factory => factory.Point(x => x.Latitude, x => x.Longitude), 32.1234, 23.4321)
    .ToListAsync();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(Latitude, Longitude), spatial.circle(10, 32.1234. 23.4321))
order by spatial.distance(spatial.point(Latitude, Longitude), spatial.point(32.1234, 23.4321))
`}
</CodeBlock>
</TabItem>
</Tabs>



## OrderByDistanceDescending

To sort by distance from given point use the `OrderByDistanceDescending` method. The farthest results will come first.

<TabItem value="spatial_8" label="spatial_8">
<CodeBlock language="csharp">
{`// From point
IOrderedQueryable<T> OrderByDistanceDescending<T>(
    Func<DynamicSpatialFieldFactory<T>, DynamicSpatialField> field,
    double latitude,
    double longitude);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    DynamicSpatialField field,
    double latitude,
    double longitude);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    Expression<Func<T, object>> path,
    double latitude,
    double longitude);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    string fieldName,
    double latitude,
    double longitude);

// From center of WKT shape
IOrderedQueryable<T> OrderByDistanceDescending<T>(
    Func<DynamicSpatialFieldFactory<T>, DynamicSpatialField> field,
    string shapeWkt);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    DynamicSpatialField field,
    string shapeWkt);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    Expression<Func<T, object>> path,
    string shapeWkt);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    string fieldName,
    string shapeWkt);

// Rounding
IOrderedQueryable<T> OrderByDistanceDescending<T>(
    Expression<Func<T, object>> path,
    double latitude,
    double longitude,
    double roundFactor);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    string fieldName,
    double latitude,
    double longitude,
    double roundFactor);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    Expression<Func<T, object>> path,
    string shapeWkt,
    double roundFactor);

IOrderedQueryable<T> OrderByDistanceDescending<T>(
    string fieldName,
    string shapeWkt,
    double roundFactor);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **path** | Expression&lt;Func&lt;T, object&gt;&gt; | Path to spatial field in an index |
| **fieldName** | string | Path to spatial field in an index |
| **field** | Func&lt;DynamicSpatialFieldFactory&lt;T&gt;, DynamicSpatialField&gt; or DynamicSpatialField | Factory or field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **shapeWkt** | string | WKT-based shape to be used as a point from which distance will be measured. If the shape is not a single point, then the center of the shape will be used as a reference. |
| **latitude** or **longitude** | double | Used to define a point from which distance will be measured |

### Example

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// sort results by distance from 32.1234 latitude and 23.4321 longitude point
List<House> results = session
    .Query<House>()
    .Spatial(
        factory => factory.Point(x => x.Latitude, x => x.Longitude),
        criteria => criteria.WithinRadius(10, 32.1234, 23.4321))
    .OrderByDistanceDescending(
        factory => factory.Point(x => x.Latitude, x => x.Longitude), 32.1234, 23.4321)
    .ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// sort results by distance from 32.1234 latitude and 23.4321 longitude point
List<House> results = await asyncSession
    .Query<House>()
    .Spatial(
        factory => factory.Point(x => x.Latitude, x => x.Longitude),
        criteria => criteria.WithinRadius(10, 32.1234, 23.4321))
    .OrderByDistanceDescending(
        factory => factory.Point(x => x.Latitude, x => x.Longitude), 32.1234, 23.4321)
    .ToListAsync();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(Latitude, Longitude), spatial.circle(10, 32.1234. 23.4321))
order by spatial.distance(spatial.point(Latitude, Longitude), spatial.point(32.1234, 23.4321)) desc
`}
</CodeBlock>
</TabItem>
</Tabs>



## Remarks

<Admonition type="note" title="Note">
By default, distances are measured in **kilometers**.
</Admonition>


</LanguageContent>
<LanguageContent language="java">


Spatial indexes can be queried using the `spatial` method which contains a full spectrum of spatial methods. The following article will cover these methods:

- [Spatial](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#spatial)
- [OrderByDistance](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#orderbydistance)
- [OrderByDistanceDescending](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#orderbydistancedescending)

## Spatial

<TabItem value="spatial_1" label="spatial_1">
<CodeBlock language="java">
{`IDocumentQuery<T> spatial(String fieldName, Function<SpatialCriteriaFactory, SpatialCriteria> clause);

IDocumentQuery<T> spatial(DynamicSpatialField field, Function<SpatialCriteriaFactory, SpatialCriteria> clause);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **fieldName** | String | Path to spatial field in an index |
| **field** | DynamicSpatialField  | Field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **clause** | Function&lt;SpatialCriteriaFactory, SpatialCriteria&gt; | Spatial criteria |

### DynamicSpatialField  

<TabItem value="spatial_2" label="spatial_2">
<CodeBlock language="java">
{`public PointField(String latitude, String longitude)

public WktField(String wkt)
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **latitude** or **longitude** or **wkt** | String | Path to the field in a document containing either longitude, latitude or WKT |

### SpatialCriteriaFactory

<TabItem value="spatial_3" label="spatial_3">
<CodeBlock language="java">
{`SpatialCriteria relatesToShape(String shapeWkt, SpatialRelation relation);

SpatialCriteria relatesToShape(String shapeWkt, SpatialRelation relation, double distErrorPercent);

SpatialCriteria intersects(String shapeWkt);

SpatialCriteria intersects(String shapeWkt, double distErrorPercent) ;

SpatialCriteria contains(String shapeWkt);

SpatialCriteria contains(String shapeWkt, double distErrorPercent);

SpatialCriteria disjoint(String shapeWkt);

SpatialCriteria disjoint(String shapeWkt, double distErrorPercent);

SpatialCriteria within(String shapeWkt);

SpatialCriteria within(String shapeWkt, double distErrorPercent);

SpatialCriteria withinRadius(double radius, double latitude, double longitude);

SpatialCriteria withinRadius(double radius, double latitude, double longitude, SpatialUnits radiusUnits);

SpatialCriteria withinRadius(double radius, double latitude, double longitude, SpatialUnits radiusUnits, double distErrorPercent);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **shapeWkt** | String | WKT-based shape to be used in operation |
| **relation** | SpatialRelation | Shape relation. Can be `WITHIN`, `CONTAINS`, `DISJOINT`, `INTERSECTS` |
| **distErrorPercent** | double | Maximum distance error tolerance in percents. Default: 0.025 |
| **radius** or **latitude** or **longitude** | double | Used to define a radius circle |
| **radiusUnits** | SpatialUnits | Determines if circle should be calculated in `KILOMETERS` or `MILES` units |

### Example I

<Tabs groupId='languageSyntax'>
<TabItem value="Java" label="Java">
<CodeBlock language="java">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
List<House> results = session
    .query(House.class)
    .spatial(
        new PointField("latitude", "longitude"),
        f -> f.withinRadius(10, 32.1234, 23.4321))
    .toList();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(Latitude, Longitude), spatial.circle(10, 32.1234. 23.4321))
`}
</CodeBlock>
</TabItem>
</Tabs>

### Example II

<Tabs groupId='languageSyntax'>
<TabItem value="Java" label="Java">
<CodeBlock language="java">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// this equals to WithinRadius(10, 32.1234, 23.4321)
List<House> results = session
    .query(House.class)
    .spatial(
        new PointField("latitude", "longitude"),
        f -> f.relatesToShape("Circle(32.1234 23.4321 d=10.0000)", SpatialRelation.WITHIN)
    )
    .toList();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(Latitude, Longitude), spatial.wkt('Circle(32.1234 23.4321 d=10.0000)'))
`}
</CodeBlock>
</TabItem>
</Tabs>



## OrderByDistance

To sort by distance from given point use the `orderByDistance` method. The closest results will come first.

<TabItem value="spatial_6" label="spatial_6">
<CodeBlock language="java">
{`IDocumentQuery<T> orderByDistance(DynamicSpatialField field, double latitude, double longitude);

IDocumentQuery<T> orderByDistance(DynamicSpatialField field, String shapeWkt);

IDocumentQuery<T> orderByDistance(String fieldName, double latitude, double longitude);

IDocumentQuery<T> orderByDistance(String fieldName, String shapeWkt);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **fieldName** | String | Path to spatial field in index |
| **field** | DynamicSpatialField | Field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **shapeWkt** | String | WKT-based shape to be used as a point from which distance will be measured. If the shape is not a single point, then the center of the shape will be used as a reference. |
| **latitude** or **longitude** | double | Used to define a point from which distance will be measured |

### Example

<Tabs groupId='languageSyntax'>
<TabItem value="Java" label="Java">
<CodeBlock language="java">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// sort results by distance from 32.1234 latitude and 23.4321 longitude point
List<House> results = session
    .query(House.class)
    .spatial(
        new PointField("latitude", "longitude"),
        f -> f.withinRadius(10, 32.1234, 23.4321)
    )
    .orderByDistance(
        new PointField("latitude", "longtude"),
        32.12324, 23.4321)
    .toList();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(Latitude, Longitude), spatial.circle(10, 32.1234. 23.4321))
order by spatial.distance(spatial.point(Latitude, Longitude), spatial.point(32.1234, 23.4321))
`}
</CodeBlock>
</TabItem>
</Tabs>



## OrderByDistanceDescending

To sort by distance from given point use the `OrderByDistanceDescending` method. The farthest results will come first.

<TabItem value="spatial_8" label="spatial_8">
<CodeBlock language="java">
{`IDocumentQuery<T> orderByDistanceDescending(DynamicSpatialField field, double latitude, double longitude);

IDocumentQuery<T> orderByDistanceDescending(DynamicSpatialField field, String shapeWkt);

IDocumentQuery<T> orderByDistanceDescending(String fieldName, double latitude, double longitude);

IDocumentQuery<T> orderByDistanceDescending(String fieldName, String shapeWkt);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **fieldName** | String | Path to spatial field in index |
| **field** | DynamicSpatialField | Field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **shapeWkt** | String | WKT-based shape to be used as a point from which distance will be measured. If the shape is not a single point, then the center of the shape will be used as a reference. |
| **latitude** or **longitude** | double | Used to define a point from which distance will be measured |

### Example

<Tabs groupId='languageSyntax'>
<TabItem value="Java" label="Java">
<CodeBlock language="java">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// sort results by distance from 32.1234 latitude and 23.4321 longitude point
List<House> results = session
    .query(House.class)
    .spatial(
        new PointField("latitude", "longitude"),
        f -> f.withinRadius(10, 32.1234, 23.4321)
    )
    .orderByDistanceDescending(
        new PointField("latitude", "longtude"),
        32.12324, 23.4321)
    .toList();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(Latitude, Longitude), spatial.circle(10, 32.1234. 23.4321))
order by spatial.distance(spatial.point(Latitude, Longitude), spatial.point(32.1234, 23.4321)) desc
`}
</CodeBlock>
</TabItem>
</Tabs>



## Remarks

<Admonition type="note" title="Note">
By default, distances are measured in **kilometers**.
</Admonition>


</LanguageContent>
<LanguageContent language="nodejs">


Spatial indexes can be queried using the `spatial()` method which contains a full spectrum of spatial methods. The following article will cover these methods:

- [spatial()](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#spatial)
- [orderByDistance()](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#orderbydistance)
- [orderByDistanceDescending()](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx#orderbydistancedescending)

## Spatial

<TabItem value="spatial_1" label="spatial_1">
<CodeBlock language="js">
{`query.spatial(fieldName, clause);
query.spatial(field, clause);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **fieldName** | string | Path to spatial field in an index |
| **field** | `DynamicSpatialField`  | Field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **clause** | `(spatialCriteriaFactory) => spatialCriteria` | Spatial criteria builder |

### DynamicSpatialField  

<TabItem value="spatial_2" label="spatial_2">
<CodeBlock language="js">
{`import \{ PointField, WktField \} from "ravendb";

new PointField(latitude, longitude);

new WktField(wkt);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **latitude** or **longitude** or **wkt** | string | Path to the field in a document containing either longitude, latitude or WKT |

### SpatialCriteriaFactory

<TabItem value="spatial_3" label="spatial_3">
<CodeBlock language="js">
{`spatialCriteriaFactory.relatesToShape(shapeWkt, relation);
spatialCriteriaFactory.relatesToShape(shapeWkt, relation, distErrorPercent);

spatialCriteriaFactory.intersect(shapeWkt);
spatialCriteriaFactory.intersect(shapeWkt, distErrorPercent) ;

spatialCriteriaFactory.contains(shapeWkt);
spatialCriteriaFactory.contains(shapeWkt, distErrorPercent);

spatialCriteriaFactory.disjoint(shapeWkt);
spatialCriteriaFactory.disjoint(shapeWkt, distErrorPercent);

spatialCriteriaFactory.within(shapeWkt);

spatialCriteriaFactory.within(shapeWkt, distErrorPercent);

spatialCriteriaFactory.withinRadius(radius, latitude, longitude);
spatialCriteriaFactory.withinRadius(radius, latitude, longitude, radiusUnits);
spatialCriteriaFactory.withinRadius(radius, latitude, longitude, radiusUnits, distErrorPercent);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **shapeWkt** | string | WKT-based shape to be used in operation |
| **relation** | `SpatialRelation` | Shape relation. Can be `Within`, `Contains`, `Disjoint`, `Intersects` |
| **distErrorPercent** | number | Maximum distance error tolerance in percents. Default: *0.025* |
| **radius** or **latitude** or **longitude** | number | Used to define a radius circle |
| **radiusUnits** | `SpatialUnits` | Determines if circle should be calculated in `Kilometers` or `Miles` units |

### Example I

<Tabs groupId='languageSyntax'>
<TabItem value="Node.js" label="Node.js">
<CodeBlock language="js">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
const results = await session
    .query({ collection: "Houses" })
    .spatial(
        new PointField("latitude", "longitude"),
        f => f.withinRadius(10, 32.1234, 23.4321))
    .all();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(latitude, longitude), spatial.circle(10, 32.1234. 23.4321))
`}
</CodeBlock>
</TabItem>
</Tabs>

### Example II

<Tabs groupId='languageSyntax'>
<TabItem value="Node.js" label="Node.js">
<CodeBlock language="js">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// this equals to WithinRadius(10, 32.1234, 23.4321)
const results = await session
    .query({ collection: "Houses" })
    .spatial(
        new PointField("latitude", "longitude"),
        f => f.relatesToShape("Circle(32.1234 23.4321 d=10.0000)", "Within")
    )
    .all();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(latitude, longitude), spatial.wkt('Circle(32.1234 23.4321 d=10.0000)'))
`}
</CodeBlock>
</TabItem>
</Tabs>



## OrderByDistance

To sort by distance from given point use the `orderByDistance()` method. The closest results will come first.

<TabItem value="spatial_6" label="spatial_6">
<CodeBlock language="js">
{`query.orderByDistance(field, latitude, longitude);

query.orderByDistance(field, shapeWkt);

query.orderByDistance(fieldName, latitude, longitude);

query.orderByDistance(fieldName, shapeWkt);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **fieldName** | string | Path to spatial field in index |
| **field** | `DynamicSpatialField` | Field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **shapeWkt** | string | WKT-based shape to be used as a point from which distance will be measured. If the shape is not a single point, then the center of the shape will be used as a reference. |
| **latitude** or **longitude** | number | Used to define a point from which distance will be measured |

### Example

<Tabs groupId='languageSyntax'>
<TabItem value="Node.js" label="Node.js">
<CodeBlock language="js">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// sort results by distance from 32.1234 latitude and 23.4321 longitude point
const results = await session
    .query({ collection: "Houses" })
    .spatial(
        new PointField("latitude", "longitude"),
        f => f.withinRadius(10, 32.1234, 23.4321)
    )
    .orderByDistance(
        new PointField("latitude", "longitude"),
        32.12324, 23.4321)
    .all();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(latitude, longitude), spatial.circle(10, 32.1234. 23.4321))
order by spatial.distance(spatial.point(latitude, longitude), spatial.point(32.1234, 23.4321))
`}
</CodeBlock>
</TabItem>
</Tabs>



## OrderByDistanceDescending

To sort by distance from given point use the `orderByDistanceDescending()` method. The farthest results will come first.

<TabItem value="spatial_8" label="spatial_8">
<CodeBlock language="js">
{`query.orderByDistanceDescending(field, latitude, longitude);

query.orderByDistanceDescending(field, shapeWkt);

query.orderByDistanceDescending(fieldName, latitude, longitude);

query.orderByDistanceDescending(fieldName, shapeWkt);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **fieldName** | string | Path to spatial field in index |
| **field** | `DynamicSpatialField` | Field that points to a dynamic field (used with auto-indexes). Either `PointField` or `WktField` |
| **shapeWkt** | string | WKT-based shape to be used as a point from which distance will be measured. If the shape is not a single point, then the center of the shape will be used as a reference. |
| **latitude** or **longitude** | number | Used to define a point from which distance will be measured |

### Example

<Tabs groupId='languageSyntax'>
<TabItem value="Node.js" label="Node.js">
<CodeBlock language="js">
{`// return all matching entities
// within 10 kilometers radius
// from 32.1234 latitude and 23.4321 longitude coordinates
// sort results by distance from 32.1234 latitude and 23.4321 longitude point
const results = await session
    .query({ collection: "Houses" })
    .spatial(
        new PointField("latitude", "longitude"),
        f => f.withinRadius(10, 32.1234, 23.4321)
    )
    .orderByDistanceDescending(
        new PointField("latitude", "longitude"),
        32.12324, 23.4321)
    .all();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from Houses
where spatial.within(spatial.point(latitude, longitude), spatial.circle(10, 32.1234. 23.4321))
order by spatial.distance(spatial.point(latitude, longitude), spatial.point(32.1234, 23.4321)) desc
`}
</CodeBlock>
</TabItem>
</Tabs>



## Remarks

<Admonition type="note" title="Note">
By default, distances are measured in **kilometers**.
</Admonition>


</LanguageContent>

<!---
### Session
- [How to Query](../../../client-api/session/querying/how-to-query)

### Querying
- [Spatial](../../../indexes/querying/spatial)

### Indexes
- [Indexing Spatial Data](../../../indexes/indexing-spatial-data)


-->