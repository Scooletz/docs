import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

This session explains the following methods to query a database:

* `session.Query`
* `session.Advanced.DocumentQuery`
* `session.Advanced.RawQuery`

## Session.Query

The most straightforward way to issue a query is by using the `Query` method which allows you to define queries using LINQ. In order to take advantage of querying capabilities specific for RavenDB, the querying API provides extension methods that will be described later.

### Syntax

<TabItem value="query_1_0" label="query_1_0">
<CodeBlock language="csharp">
{`IRavenQueryable<T> Query<T>(string indexName = null, string collectionName = null,
                            bool isMapReduce = false);

IRavenQueryable<T> Query<T, TIndexCreator>()
    where TIndexCreator : AbstractIndexCreationTask, new();
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **indexName** | string | Name of an index to perform a query on (mutually exclusive with collectionName) |
| **collectionName** | string | Name of a collection  (mutually exclusive with indexName) |
| **isMapReduce** | bool | Indicates if queried index is a map/reduce index (modifies how we treat identifier properties) |

| Return Value | | 
| ------------- | ----- |
| IRavenQueryable | Instance implementing `IRavenQueryable` interface containing additional query methods and extensions |


### Example I - Basic Dynamic Query

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
List<Employee> employees = session
    .Query<Employee>()
    .ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
List<Employee> employees = await asyncSession
    .Query<Employee>()
    .ToListAsync();
`}
</CodeBlock>
</TabItem>
</Tabs>

The above is an example of a dynamic query which doesn't require you to specify an index name. RavenDB will create an auto index automatically if necessary.

The provided `Employee` type as the generic type parameter does not only define the type of returned results, but it also indicates that the queried collection will be `Employees`. There is no need to specify it as the parameter.

### Example II - LINQ Syntax Support

Both LINQ syntaxes are supported:

- Method syntax:

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
List<Employee> employees = session
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
    .ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
List<Employee> employees = await asyncSession
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
    .ToListAsync();
`}
</CodeBlock>
</TabItem>
</Tabs>

- Query syntax:

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
IRavenQueryable<Employee> query = from employee in session.Query<Employee>()
                                  where employee.FirstName == "Robert"
                                  select employee;

List<Employee> employees = query.ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
IRavenQueryable<Employee> query = from employee in asyncSession.Query<Employee>()
                                  where employee.FirstName == "Robert"
                                  select employee;

List<Employee> employees = await query.ToListAsync();
`}
</CodeBlock>
</TabItem>
</Tabs>

### Example III - Using Specific Index

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
// using 'Employees/ByName' index
IRavenQueryable<Employee> query = from employee in session.Query<Employee>("Employees/ByName")
                                  where employee.FirstName == "Robert"
                                  select employee;

List<Employee> employees = query.ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
// using 'Employees/ByName' index
IRavenQueryable<Employee> query = from employee in asyncSession.Query<Employee>("Employees/ByName")
                                  where employee.FirstName == "Robert"
                                  select employee;

List<Employee> employees = await query.ToListAsync();
`}
</CodeBlock>
</TabItem>
</Tabs>

or 

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
// using 'Employees/ByName' index
List<Employee> query = (from employee in session.Query<Employee, Employees_ByName>()
                        where employee.FirstName == "Robert"
                        select employee).ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
// using 'Employees/ByName' index
List<Employee> query = await (from employee in asyncSession.Query<Employee, Employees_ByName>()
                              where employee.FirstName == "Robert"
                              select employee).ToListAsync();
`}
</CodeBlock>
</TabItem>
</Tabs>

## Session.Advanced.DocumentQuery

The advanced querying methods accessible by `session.Advanced.DocumentQuery` is the low-level API used to query RavenDB. The entire LINQ API is the wrapper of `DocumentQuery` API and
each query created using LINQ is built on top of it. Since it offers the full spectrum of querying capabilities, you might find it handy when doing very complex queries that are difficult
to shape using Linq.

### Example IV

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// load all employees hired between
// 1/1/2002 and 12/31/2002
List<Employee> employees = session
    .Advanced.DocumentQuery<Employee>()
    .WhereBetween(x => x.HiredAt, new DateTime(2002, 1, 1), new DateTime(2002, 12, 31))
    .ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// load all employees hired between
// 1/1/2002 and 12/31/2002
List<Employee> employees = await asyncSession
    .Advanced.AsyncDocumentQuery<Employee>()
    .WhereBetween(x => x.HiredAt, new DateTime(2002, 1, 1), new DateTime(2002, 12, 31))
    .ToListAsync();
`}
</CodeBlock>
</TabItem>
</Tabs>

## Session.Advanced.RawQuery

Queries in RavenDB use a SQL-like language called RavenDB Query Language ([RQL](../../../indexes/querying/what-is-rql.mdx)). All of the above queries generate RQL sent to the server. The session also gives you the way to express the query directly in RQL using `RawQuery` method.

### Example IV

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
List<Employee> employees = session
    .Advanced.RawQuery<Employee>("from Employees where FirstName = 'Robert'")
    .ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Async" label="Async">
<CodeBlock language="csharp">
{`// load all entities from 'Employees' collection
// where FirstName equals 'Robert'
List<Employee> employees = await asyncSession
    .Advanced.AsyncRawQuery<Employee>("from Employees where FirstName = 'Robert'")
    .ToListAsync();
`}
</CodeBlock>
</TabItem>
</Tabs>

## Custom Methods and Extensions for LINQ

Available custom methods and extensions:

- [AggregateBy](../../../client-api/session/querying/how-to-perform-a-faceted-search.mdx)
- AnyAsync
- [As](../../../client-api/session/querying/how-to-project-query-results.mdx)
- CountAsync
- [CountLazily](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx)
- [Customize](../../../client-api/session/querying/how-to-customize-query.mdx)
- FirstAsync
- FirstOrDefaultAsync
- [GroupByArrayValues](../../../client-api/session/querying/how-to-perform-group-by-query.mdx#by-array-values)
- [GroupByArrayContent](../../../client-api/session/querying/how-to-perform-group-by-query.mdx#by-array-content)
- [Include](../../../client-api/how-to/handle-document-relationships.mdx)
- [Intersect](../../../client-api/session/querying/how-to-use-intersect.mdx)
- [Lazily](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx)
- [LazilyAsync](../../../client-api/session/querying/how-to-perform-queries-lazily.mdx)
- [MoreLikeThis](../../../client-api/session/querying/how-to-use-morelikethis.mdx) 
- OrderByDistance
- OrderByDistanceDescending
- OrderByScore
- OrderByScoreDescending
- [ProjectInto](../../../client-api/session/querying/how-to-project-query-results.mdx)
- [Search](../../../client-api/session/querying/how-to-use-search.mdx)
- SingleAsync
- SingleOrDefaultAsync
- [Spatial](../../../client-api/session/querying/how-to-query-a-spatial-index.mdx)
- [Statistics](../../../client-api/session/querying/how-to-get-query-statistics.mdx)
- [SuggestUsing](../../../client-api/session/querying/how-to-work-with-suggestions.mdx)
- ToListAsync


