import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* `bulkInsert` is RavenDB's high-performance data insertion operation.  

* The `bulkInsert.timeSeriesFor` interface provides similar functionality to the [session.timeSeriesFor](../../../../document-extensions/timeseries/client-api/session/append.mdx),  
  but without the overhead associated with the _Session_, resulting in significantly improved performance.

* In this page:  
  * [Usage](../../../../document-extensions/timeseries/client-api/bulk-insert/append-in-bulk.mdx#usage)  
  * [Examples](../../../../document-extensions/timeseries/client-api/bulk-insert/append-in-bulk.mdx#examples)
      * [Append single entry](../../../../document-extensions/timeseries/client-api/bulk-insert/append-in-bulk.mdx#append-single-entry)
      * [Append multiple entries](../../../../document-extensions/timeseries/client-api/bulk-insert/append-in-bulk.mdx#append-multiple-entries)
      * [Append multiple values per entry](../../../../document-extensions/timeseries/client-api/bulk-insert/append-in-bulk.mdx#append-multiple-values-per-entry)
      * [Append multiple time series](../../../../document-extensions/timeseries/client-api/bulk-insert/append-in-bulk.mdx#append-multiple-time-series) 
  * [Syntax](../../../../document-extensions/timeseries/client-api/bulk-insert/append-in-bulk.mdx#syntax)

</Admonition>

## Usage

**Flow**:

* Call `documentStore.bulkInsert` to create a `BulkInsertOperation` instance.
* Call `timeSeriesFor` on that instance and pass it:
    * The document ID  
      (An exception will be thrown if the specified document does Not exist).
    * The time series name  
      (Appending entries to a time series that doesn't yet exist yet will create the time series).
* To append an entry, call `append` and pass it:
    * The entry's Timestamp
    * The entry's Value or Values
    * The entry's Tag (optional)

**Note**:

* To append multiple entries, call `append` as many times as needed.
* Ensure there is at least a 1-millisecond interval between each timestamp.
* The client converts all timestamps to **UTC** before sending the batch to the server.
* Multiple time series can be appended in the same `BulkInsertOperation`. See this [example](../../../../document-extensions/timeseries/client-api/bulk-insert/append-in-bulk.mdx#append-multiple-time-series) below.



## Examples

#### Append single entry:

In this example, we append a single entry with a single value to time series "HeartRates". 
<TabItem value="append_1" label="append_1">
<CodeBlock language="js">
{`const baseTime = new Date();

// Create a BulkInsertOperation instance
const bulkInsert = documentStore.bulkInsert();

\{
    // Call 'TimeSeriesFor', pass it:
    // * The document ID
    // * The time series name
    const timeSeriesBulkInsert = bulkInsert.timeSeriesFor("users/john", "HeartRates");

    // Call 'Append' to add an entry, pass it:
    // * The entry's Timestamp 
    // * The entry's Value or Values 
    // * The entry's Tag (optional) 
    const nextMinute = new Date(baseTime.getTime() + 60_000 * 1);
    await timeSeriesBulkInsert.append(nextMinute, 61, "watches/fitbit");

    timeSeriesBulkInsert.dispose();
\}

// Call finish to send all data to the server
await bulkInsert.finish();
`}
</CodeBlock>
</TabItem>
#### Append multiple entries:

In this example, we append 100 entries with a single value to time series "HeartRates". 
<TabItem value="append_2" label="append_2">
<CodeBlock language="js">
{`const baseTime = new Date();

const bulkInsert = documentStore.bulkInsert();

\{
    const timeSeriesBulkInsert = bulkInsert.timeSeriesFor("users/john", "HeartRates");

    for (let i = 0; i < 100; i++) \{
        let randomValue = Math.floor(Math.random() * (29)) + 60;
        let nextMinute = new Date(baseTime.getTime() + 60_000 * (i + 1));
        
        await timeSeriesBulkInsert.append(nextMinute, randomValue, "watches/fitbit");
    \}

    timeSeriesBulkInsert.dispose();
\}

await bulkInsert.finish();
`}
</CodeBlock>
</TabItem>
#### Append multiple values per entry:

In this example, we append multiple values per entry in time series "HeartRates".
<TabItem value="append_3" label="append_3">
<CodeBlock language="js">
{`const baseTime = new Date();

const bulkInsert = documentStore.bulkInsert();

\{
    const timeSeriesBulkInsert = bulkInsert.timeSeriesFor("users/john", "HeartRates");

    const exerciseHeartRates = [89, 82, 85];
    await timeSeriesBulkInsert.append(new Date(baseTime.getTime() + 60_000),
        exerciseHeartRates, "watches/fitbit");

    const restingHeartRates = [59, 63, 61, 64, 65];
    await timeSeriesBulkInsert.append(new Date(baseTime.getTime() + 60_000 * 2),
        restingHeartRates, "watches/fitbit");

    timeSeriesBulkInsert.dispose();
\}

await bulkInsert.finish();
`}
</CodeBlock>
</TabItem>
#### Append multiple time series:

In this example, we append multiple time series in different documents in the same batch.
<TabItem value="append_4" label="append_4">
<CodeBlock language="js">
{`const baseTime = new Date();

const bulkInsert = documentStore.bulkInsert();

\{
    // Append first time series
    const timeSeriesBulkInsert = bulkInsert.timeSeriesFor("users/john", "HeartRates");
    await timeSeriesBulkInsert.append(new Date(baseTime.getTime() + 60_000), 61, "watches/fitbit");
    await timeSeriesBulkInsert.append(new Date(baseTime.getTime() + 60_000 * 2), 62, "watches/fitbit");
    timeSeriesBulkInsert.dispose();
\}
\{
    // Append another time series
    const timeSeriesBulkInsert = bulkInsert.timeSeriesFor("users/john", "ExerciseHeartRates");
    await timeSeriesBulkInsert.append(new Date(baseTime.getTime() + 60_000 * 3), 81, "watches/apple-watch");
    await timeSeriesBulkInsert.append(new Date(baseTime.getTime() + 60_000 * 4), 82, "watches/apple-watch");
    timeSeriesBulkInsert.dispose();
\}
\{
    // Append time series in another document
    const timeSeriesBulkInsert = bulkInsert.timeSeriesFor("users/jane", "HeartRates");
    await timeSeriesBulkInsert.append(new Date(baseTime.getTime() + 60_000), 59, "watches/fitbit");
    await timeSeriesBulkInsert.append(new Date(baseTime.getTime() + 60_000 * 2), 60, "watches/fitbit");
    timeSeriesBulkInsert.dispose();
\}

await bulkInsert.finish();
`}
</CodeBlock>
</TabItem>



## Syntax

**`bulkInsert.timeSeriesFor`**

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="js">
{`timeSeriesFor(id, name);
`}
</CodeBlock>
</TabItem>

| Parameter   | Type     | Description      |
|-------------|----------|------------------|
| **id**      | `string` | Document ID      |
| **name**    | `string` | Time Series Name |

**`timeSeriesFor.Append`** overloads:

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="js">
{`append(timestamp, value);
append(timestamp, value, tag);
append(timestamp, values);
append(timestamp, values, tag);
`}
</CodeBlock>
</TabItem>

| Parameter     | Type       | Description               |
|---------------|------------|---------------------------|
| **timestamp** | `Date`     | TS-entry's timestamp      |
| **value**     | `number`   | A single value            |
| **values**    | `number[]` | Multiple values           |
| **tag**       | `string`   | TS-entry's tag (optional) |




