import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* Attachments can be referenced and loaded using the `AttachmentsFor` and 
`LoadAttachment`/`LoadAttachments` methods.  

* Auto-indexes for attachments are not available at this time.  

* In this page:  
  * [Syntax](../../document-extensions/attachments/indexing.mdx#syntax)  
  * [Examples](../../document-extensions/attachments/indexing.mdx#examples)  

</Admonition>
## Syntax

### Using AttachmentsFor()

The `AttachmentsFor` method returns information about each attachment that extends 
a specified document, including their names, sizes, and content type.  

<Tabs groupId='languageSyntax'>
<TabItem value="Method" label="Method">
<CodeBlock language="csharp">
{`IEnumerable<AttachmentName> AttachmentsFor(object doc);
`}
</CodeBlock>
</TabItem>
<TabItem value="Result" label="Result">
<CodeBlock language="csharp">
{`public string Name;
public string Hash;
public string ContentType;
public long Size;
`}
</CodeBlock>
</TabItem>
</Tabs>

The `AttachmentsFor` method is available in `AbstractIndexCreationTask`.

### Using LoadAttachment()/LoadAttachments()

`LoadAttachment()` loads an attachment to the index by document and attachment name.  
`LoadAttachments()` loads all the attachments of a given document.  

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="csharp">
{`public IAttachmentObject LoadAttachment(object doc, string name);
public IEnumerable<IAttachmentObject> LoadAttachments(object doc);
`}
</CodeBlock>
</TabItem>

| Parameter | Type | Description |
| - | - | - |
| **doc** | A server-side document, an entity | The document whose attachments you want to load |
| **name** | `string` | The name of the attachment you want to load |

#### GetContentAs Methods

To access the attachment content itself, use `GetContentAsStream()`. To 
convert the content into a `string`, use `GetContentAsString()` with 
the desired character encoding.  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`public Stream GetContentAsStream();

public string GetContentAsString(Encoding encoding);

public string GetContentAsString(); // Default: UTF-8
`}
</CodeBlock>
</TabItem>

<Admonition type="info" title="Applications for Attachment Content: Machine Learning" id="applications-for-attachment-content-machine-learning" href="#applications-for-attachment-content-machine-learning">
Access to the attachment content opens the door to many different 
applications, including many that can be integrated directly into 
RavenDB.  

In this [blog post](https://ayende.com/blog/192001-B/using-machine-learning-with-ravendb), 
Oren Eini demonstrates how machine learning image recognition can be 
added to an index using the [additional sources](../../indexes/extending-indexes.mdx) 
feature. The resulting index allows filtering and querying based on 
image content.  
</Admonition>



## Examples

#### Indexes with `AttachmentsFor()`

<Tabs groupId='languageSyntax'>
<TabItem value="JavaScript-syntax" label="JavaScript-syntax">
<CodeBlock language="js">
{`class Employees_ByAttachmentNames extends AbstractCsharpIndexCreationTask {
    constructor() {
        super();
        this.map = \`docs.Employees.Select(e => new {
            e = e,
            attachments = this.AttachmentsFor(e)
        }).Select(this0 => new {
            AttachmentNames = Enumerable.ToArray(this0.attachments.Select(x => x.Name))
        })\`;
    }
}
`}
</CodeBlock>
</TabItem>
</Tabs>

#### Indexes with `LoadAttachment()`

<Tabs groupId='languageSyntax'>
<TabItem value="JavaScript-syntax" label="JavaScript-syntax">
<CodeBlock language="js">
{`class Companies_With_Attachments_JavaScript extends AbstractCsharpIndexCreationTask {
    constructor() {
        super();
        this.map = \`docs.Companies.Select(company => new {
            company = company,
            attachment = this.LoadAttachment(company, (System.String) company.ExternalId)
        }).Select(this0 => new {
            CompanyName = this0.company.Name,
            AttachmentName = this0.attachment.Name,
            AttachmentContentType = this0.attachment.ContentType,
            AttachmentHash = this0.attachment.Hash,
            AttachmentSize = this0.attachment.Size,
            AttachmentContent = this0.attachment.GetContentAsString(Encoding.UTF8)
        })\`;
    }
}
`}
</CodeBlock>
</TabItem>
</Tabs>

#### Indexes with `LoadAttachments()`

<Tabs groupId='languageSyntax'>
<TabItem value="JavaScript-syntax" label="JavaScript-syntax">
<CodeBlock language="js">
{`class Companies_With_All_Attachments_JS extends AbstractCsharpIndexCreationTask {
    constructor() {
        super();
        this.map = \`docs.Companies.Select(company => new {
            company = company,
            attachments = this.LoadAttachments(company)
        }).SelectMany(this0 => this0.attachments, (this0, attachment) => new {
            AttachmentName = attachment.Name,
            AttachmentContent = attachment.GetContentAsString(Encoding.UTF8)
        })\`;
    }
}
`}
</CodeBlock>
</TabItem>
</Tabs>

#### Querying the Index

<Tabs groupId='languageSyntax'>
<TabItem value="Sync" label="Sync">
<CodeBlock language="js">
{`//return all employees that have an attachment called "cv.pdf"
const employees = await session.query(Employees_ByAttachmentNames)
    .containsAny("attachmentNames", ["employees_cv.pdf"])
    .selectFields("cv.pdf")
    .all();
`}
</CodeBlock>
</TabItem>
</Tabs>





