---
title: "Bulk Insert Attachments"
hide_table_of_contents: true
sidebar_label: Bulk Insert
sidebar_position: 6
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "python", "nodejs"];


# Bulk Insert Attachments
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">

<Admonition type="note" title="">

* [BulkInsert](../../client-api/bulk-insert/how-to-work-with-bulk-insert-operation.mdx) is RavenDB's high-performance data insertion operation.  
  Use its `AttachmentsFor` interface to add attachments to documents with great speed.  

* In this page:  
    * [Usage flow](../../document-extensions/attachments/bulk-insert.mdx#usage-flow)  
    * [Usage example](../../document-extensions/attachments/bulk-insert.mdx#usage-example)
    * [Syntax](../../document-extensions/attachments/bulk-insert.mdx#syntax)

</Admonition>

## Usage flow

* Create a `BulkInsert` instance.  

* Pass the Document ID to the instance's `AttachmentsFor` method.

* To add an attachment, call `Store`.  
  Pass it the attachment's name, stream, and type (optional).  
  The `Store` function can be called repeatedly as necessary.

* Note:  
  If an attachment with the specified name already exists on the document,  
  the bulk insert operation will overwrite it.



## Usage example

In this example, we attach a file to all User documents that match a query.  
 
<Tabs groupId='languageSyntax'>
<TabItem value="BulkInsert_Attachments" label="BulkInsert_Attachments">
<CodeBlock language="csharp">
{`List<User> users;

// Choose user profiles for which to attach a file
using (var session = store.OpenSession())
{
    users = session.Query<User>()
        .Where(u => u.Age < 30)
        .ToList();
}

// Prepare content to attach
byte[] byteArray = Encoding.UTF8.GetBytes("some contents here");
var stream = new MemoryStream(byteArray);

// Create a BulkInsert instance
using (var bulkInsert = store.BulkInsert())
{
    for (var i = 0; i < users.Count; i++)
    {
        string userId = users[i].Id;
        
        // Call 'AttachmentsFor', pass the document ID for which to attach the file
        var attachmentsBulkInsert = bulkInsert.AttachmentsFor(userId);

        // Call 'Store' to add the file to the BulkInsert instance
        // The data stored in bulkInsert will be streamed to the server in batches 
        attachmentsBulkInsert.Store("AttachmentName", stream);
    }
}
`}
</CodeBlock>
</TabItem>
<TabItem value="User_Class" label="User_Class">
<CodeBlock language="csharp">
{`public class User
{
    public string Id { get; set; }
    public string Name { get; set; }
    public string LastName { get; set; }
    public string AddressId { get; set; }
    public int Count { get; set; }
    public int Age { get; set; }
}
`}
</CodeBlock>
</TabItem>
</Tabs>



## Syntax

<TabItem value="AttachmentsFor-definition" label="AttachmentsFor-definition">
<CodeBlock language="csharp">
{`public AttachmentsBulkInsert AttachmentsFor(string id)
`}
</CodeBlock>
</TabItem>

| Parameter  | Type     | Description                                              |
|------------|----------|----------------------------------------------------------|
| `id`       | `string` | The document ID to which the attachment should be added. |
 
<TabItem value="AttachmentsFor.Store-definition" label="AttachmentsFor.Store-definition">
<CodeBlock language="csharp">
{`public void Store(string name, Stream stream, string contentType = null)
`}
</CodeBlock>
</TabItem>

| Parameter     | Type     | Description                        |
|---------------|----------|------------------------------------|
| `name`        | `string` | Name of attachment                 |
| `stream`      | `Stream` | The attachment's stream            |
| `contentType` | `string` | Type of attachment (default: null) |




</LanguageContent>
<LanguageContent language="python">

<Admonition type="note" title="">

* [bulk_insert](../../client-api/bulk-insert/how-to-work-with-bulk-insert-operation.mdx) is RavenDB's 
  high-performance data insertion operation.  
  Use its `attachments_for` interface to add attachments to multiple documents with great speed.  
* Use `store` 

* In this page:  
    * [Usage flow](../../document-extensions/attachments/bulk-insert.mdx#usage-flow)  
    * [Usage example](../../document-extensions/attachments/bulk-insert.mdx#usage-example)

</Admonition>

## Usage flow

* Create a `bulk_insert` instance.  

* Pass the Document ID to the instance's `attachments_for` method.

* To add an attachment, call the `store` method.  
  Pass it the attachment's name, stream, and type (optional).  
  `store` can be called repeatedly, as many times as needed.  

* Note:  
  If an attachment with the specified name already exists on the document,  
  the bulk insert operation will overwrite it.



## Usage example

In this example, we attach a file to all User documents that match a query.  
<TabItem value="bulk_insert_attachment" label="bulk_insert_attachment">
<CodeBlock language="python">
{`# Choose user profiles for which to attach a file
with store.open_session() as session:
    user_ids = [
        session.advanced.get_document_id(user)
        for user in list(session.query(object_type=User).where_less_than("Age", 30))
    ]

# Prepare content to attach
bytes_to_attach = b"some contents here"

# Create a BulkInsert instance
with store.bulk_insert() as bulk_insert:
    for user_id in user_ids:
        # Call 'attachments_for', pass the document ID for which to attach the file
        attachments_bulk_insert = bulk_insert.attachments_for(user_id)

        # Call 'store' to add the file to the BulkInsert instance
        # The data stored in bulk_insert will be streamed to the server in batches
        attachments_bulk_insert.store("AttachmentName", bytes_to_attach)
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="nodejs">

<Admonition type="note" title="">

* [BulkInsert](../../client-api/bulk-insert/how-to-work-with-bulk-insert-operation.mdx) is RavenDB's high-performance data insertion operation.  
  Use its `attachmentsFor` interface to add attachments to documents with great speed.  

* In this page:  
    * [Usage flow](../../document-extensions/attachments/bulk-insert.mdx#usage-flow)  
    * [Usage example](../../document-extensions/attachments/bulk-insert.mdx#usage-example)
    * [Syntax](../../document-extensions/attachments/bulk-insert.mdx#syntax)

</Admonition>

## Usage flow

* Create a `bulkInsert` instance.  

* Pass the Document ID to the instance's `attachmentsFor` method.

* To add an attachment, call `store`.  
  Pass it the attachment's name, content, and type (optional).  
  The `store` function can be called repeatedly as necessary.

* Note:  
  If an attachment with the specified name already exists on the document,  
  the bulk insert operation will overwrite it.



## Usage example

In this example, we attach a file to all User documents that match a query.  
 
<Tabs groupId='languageSyntax'>
<TabItem value="BulkInsert_Attachments" label="BulkInsert_Attachments">
<CodeBlock language="js">
{`// Open a session
const session = documentStore.openSession();

// Choose user profiles for which to attach a file
const users = await session.query({ collection: "users" })
    .whereLessThan("age", 30)
    .all();

// Prepare content that will be attached
const text = "Some contents here";
const byteArray = Buffer.from(text);

// Create a bulkInsert instance
const bulkInsert = documentStore.bulkInsert();

try {
    for (let i = 0; i < users.length; i++) {

        // Call \`attachmentsFor\`, pass the document ID for which to attach the file
        const attachmentsBulkInsert = bulkInsert.attachmentsFor(users[i].id);
        
        // Call 'store' to attach the byte array to the bulkInsert instance
        // The data stored in bulkInsert will be streamed to the server in batches 
        await attachmentsBulkInsert.store("attachmentName", byteArray);
    }
} finally {
    // Call finish to send all remaining data to the server
    await bulkInsert.finish();
}
`}
</CodeBlock>
</TabItem>
<TabItem value="User_Class" label="User_Class">
<CodeBlock language="js">
{`class User {
    constructor(
        id = null,
        age = 0,
        name = ''
    ) {
        Object.assign(this, {
            id,
            age,
            name
        });
    }
}
`}
</CodeBlock>
</TabItem>
</Tabs>



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="js">
{`attachmentsFor(id);
`}
</CodeBlock>
</TabItem>

| Parameter  | Type     | Description                                              |
|------------|----------|----------------------------------------------------------|
| `id`       | `string` | The document ID to which the attachment should be added. |
 
<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="js">
{`store(name, bytes);
store(name, bytes, contentType);
`}
</CodeBlock>
</TabItem>

| Parameter     | Type     | Description                        |
|---------------|----------|------------------------------------|
| `name`        | `string` | Name of attachment                 |
| `bytes`       | `Buffer` | The attachment's content           |
| `contentType` | `string` | Type of attachment (default: null) |




</LanguageContent>

<!---
### Attachments
- [Storing](../../document-extensions/attachments/storing)
- [Loading](../../document-extensions/attachments/loading)
- [Deleting](../../document-extensions/attachments/deleting)


-->