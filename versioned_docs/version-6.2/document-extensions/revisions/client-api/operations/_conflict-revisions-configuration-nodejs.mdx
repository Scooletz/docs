import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* By default, RavenDB creates **revisions for conflict documents** for all collections  
  when conflicts occur and when they are resolved.  

* Use `ConfigureRevisionsForConflictsOperation` to disable the feature or modify the configuration. 

* If you define [default configuration](../../../../studio/database/settings/document-revisions.mdx#define-default-configuration),  
  then these settings will **override** the conflict revisions configuration.  

* If you define any [collection-specific configuration](../../../../studio/database/settings/document-revisions.mdx#define-collection-specific-configuration),  
  then these settings will also **override** the conflict revisions configuration for that collection.  
   * E.g., if the conflict revisions configuration defines that revisions created for conflicting documents will not be purged, 
     but a collection-specific configuration defines an age limit for revisions,  
     revisions for conflicting documents of this collection that exceed this age will be purged.  

* In this page:  
  * [Configure revisions for conflicts - Example](../../../../document-extensions/revisions/client-api/operations/conflict-revisions-configuration.mdx#configure-revisions-for-conflicts---example)
  * [Syntax](../../../../document-extensions/revisions/client-api/operations/conflict-revisions-configuration.mdx#syntax)
  * [Storage consideration](../../../../document-extensions/revisions/client-api/operations/conflict-revisions-configuration.mdx#storage-consideration)
</Admonition>
## Configure revisions for conflicts - Example

<TabItem value="conflict_revisions_configuration" label="conflict_revisions_configuration">
<CodeBlock language="js">
{`// Define the settings that will apply for conflict revisions (for all collections)
const conflictRevConfig  = new RevisionsCollectionConfiguration();
conflictRevConfig.minimumRevisionAgeToKeep = TimeUtil.millisToTimeSpan(3600 * 1000 * 24 * 45) // 45 days
conflictRevConfig.purgeOnDelete = true;

// With this configuration:
// ------------------------
// * A revision will be created for conflict documents
// * When the parent document is deleted all its revisions will be removed.
// * Revisions that exceed 45 days will be removed on next revision creation.

// Define the configure conflict revisions operation, pass the configuration
const configureConflictRevisionsOp =
    new ConfigureRevisionsForConflictsOperation(documentStore.database, conflictRevConfig);

// Execute the operation by passing it to maintenance.server.send
// The existing conflict revisions configuration will be replaced by the configuration passed
await documentStore.maintenance.server.send(configureConflictRevisionsOp);
`}
</CodeBlock>
</TabItem>



## Syntax 

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="js">
{`const configureRevisionsOp = new ConfigureRevisionsForConflictsOperation(database, configuration);
`}
</CodeBlock>
</TabItem>

| Parameter | Type | Description |
| - | - | - |
| **database** | `string` | The name of the database whose conflict revisions you want to manage |
| **configuration** | `RevisionsCollectionConfiguration` | The conflict revisions configuration to apply |

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="js">
{`class RevisionsCollectionConfiguration
\{
    minimumRevisionsToKeep;
    minimumRevisionAgeToKeep;
    maximumRevisionsToDeleteUponDocumentUpdate;
    purgeOnDelete;
    disabled;
\}
`}
</CodeBlock>
</TabItem>

* See properties explanation and default values [here](../../../../document-extensions/revisions/client-api/operations/configure-revisions.mdx#revisions-collection-configuration-object).



<Admonition type="info" title="">

#### Storage consideration 

Automatic creation of conflict revisions can help track document conflicts and understand their reasons.  
However, it can also lead to a significant increase in the database size if many conflicts occur unexpectedly.  

* Consider limiting the number of conflict revisions kept per document using:  
  `minimumRevisionsToKeep` and/or `minimumRevisionAgeToKeep`.  

* Revisions are purged upon [modification of their parent documents](../../../../document-extensions/revisions/overview.mdx#revisions-configuration-execution).  
  If you want to purge a large number of revisions at once, you can **cautiously** [enforce configuration](../../../../studio/database/settings/document-revisions.mdx#enforce-configuration).  

</Admonition>


