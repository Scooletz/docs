---
title: "Include Explanations in Index Query"
hide_table_of_contents: true
sidebar_label: Include Explanations
sidebar_position: 15
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "nodejs"];


# Include Explanations in Index Query
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">

<Admonition type="note" title="">

* This article provides examples of including explanations when querying a static-index.  

* **Prior to this article**, please refer to [Include Query Explanations](../../client-api/session/querying/debugging/include-explanations.mdx) for dynamic-query examples  
  and general knowledge about including explanations to retrieve the score of resulting documents.
  
    <Admonition type="info" title="">
    * Including explanations is available only when using **Lucene** as the underlying search engine for static-indexes.
    * You can configure which search engine will be used. Learn how in [Selecting the search engine](../../indexes/search-engine/corax.mdx#selecting-the-search-engine).
    </Admonition>
* In this page:
  * [Include explanations when querying Map index](../../indexes/querying/include-explanations.mdx#include-explanations-when-querying-map-index)  
  * [Include explanations when querying Map-Reduce index](../../indexes/querying/include-explanations.mdx#include-explanations-when-querying-map-reduce-index)  
  * [Syntax](../../indexes/querying/include-explanations.mdx#syntax)

</Admonition>
## Include explanations when querying Map index

<Tabs groupId='languageSyntax'>
<TabItem value="Map_index" label="Map_index">
<CodeBlock language="csharp">
{`public class Products_BySearchName : AbstractIndexCreationTask<Product>
{
    public class IndexEntry
    {
        public string Name { get; set; }
    }

    public Products_BySearchName()
    {
        Map = products => from product in products
            select new IndexEntry()
            {
                Name = product.Name
            };

        // Configure the index-field 'Name' for FTS
        Indexes.Add(x => x.Name, FieldIndexing.Search);
    }
}
`}
</CodeBlock>
</TabItem>
<TabItem value="Query" label="Query">
<CodeBlock language="csharp">
{`List<Product> products = session
     // Query the index
    .Query<Products_BySearchName.IndexEntry, Products_BySearchName>()
     // Convert the IRavenQueryable to IDocumentQuery
     // to be able to use 'IncludeExplanations'
    .ToDocumentQuery()
     // Call 'IncludeExplanations', provide an out param for the explanations results
    .IncludeExplanations(out Explanations explanations)
     // Convert back to IRavenQueryable
     // to continue building the query using LINQ
    .ToQueryable()
     // Define query criteria
     // e.g. search for docs containing Syrup -or- Lager in their Name field
    .Search(x => x.Name, "Syrup Lager" )
    .OfType<Product>() 
    .ToList();

// When running the above query on the RavenDB sample data
// the results contain 3 product documents.

// To get the score details for the first document from the results
// call 'GetExplanations' on the resulting Explanations object as follows:
string[] scoreDetails = explanations.GetExplanations(products[0].Id);
`}
</CodeBlock>
</TabItem>
<TabItem value="Query_async" label="Query_async">
<CodeBlock language="csharp">
{`List<Product> products = await asyncSession
     // Query the index
    .Query<Products_BySearchName.IndexEntry, Products_BySearchName>()
     // Convert the IRavenQueryable to IDocumentQuery
     // to be able to use 'IncludeExplanations'
     .ToAsyncDocumentQuery()
     // Call 'IncludeExplanations', provide an out param for the explanations results
    .IncludeExplanations(out Explanations explanations)
     // Convert back to IRavenQueryable
     // to continue building the query using LINQ
    .ToQueryable()
     // Define query criteria
     // e.g. search for docs containing Syrup -or- Lager in their Name field
    .Search(x => x.Name, "Syrup Lager" )
    .OfType<Product>() 
    .ToListAsync();

// When running the above query on the RavenDB sample data
// the results contain 3 product documents.

// To get the score details for the first document from the results
// call 'GetExplanations' on the resulting Explanations object as follows:
string[] scoreDetails = explanations.GetExplanations(products[0].Id);
`}
</CodeBlock>
</TabItem>
<TabItem value="DocumentQuery" label="DocumentQuery">
<CodeBlock language="csharp">
{`List<Product> products = session.Advanced
     // Query the index
    .DocumentQuery<Products_BySearchName.IndexEntry, Products_BySearchName>()
     // Call 'IncludeExplanations', provide an out param for the explanations results
    .IncludeExplanations(out Explanations explanations)
     // Define query criteria
     // e.g. search for docs containing Syrup -or- Lager in their Name field
    .Search(x => x.Name, "Syrup Lager" )
    .OfType<Product>() 
    .ToList();

// When running the above query on the RavenDB sample data
// the results contain 3 product documents.

// To get the score details for the first document from the results
// call 'GetExplanations' on the resulting Explanations object as follows:
string[] scoreDetails = explanations.GetExplanations(products[0].Id);
`}
</CodeBlock>
</TabItem>
<TabItem value="DocumentQuery_async" label="DocumentQuery_async">
<CodeBlock language="csharp">
{`List<Product> products = await asyncSession.Advanced
     // Query the index
    .AsyncDocumentQuery<Products_BySearchName.IndexEntry, Products_BySearchName>()
     // Call 'IncludeExplanations', provide an out param for the explanations results
    .IncludeExplanations(out Explanations explanations)
     // Define query criteria
     // e.g. search for docs containing Syrup -or- Lager in their Name field
    .Search(x => x.Name, "Syrup Lager" )
    .OfType<Product>() 
    .ToListAsync();

// When running the above query on the RavenDB sample data
// the results contain 3 product documents.

// To get the score details for the first document from the results
// call 'GetExplanations' on the resulting Explanations object as follows:
string[] scoreDetails = explanations.GetExplanations(products[0].Id);
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from index "Products/BySearchName"
where search(Name, "Syrup Lager")
include explanations()
// Or:
from index "Products/BySearchName"
where search(Name, "Syrup") or search(Name, "Lager")
include explanations()
`}
</CodeBlock>
</TabItem>
</Tabs>



## Include explanations when querying Map-Reduce index

<Tabs groupId='languageSyntax'>
<TabItem value="Map_Reduce_index" label="Map_Reduce_index">
<CodeBlock language="csharp">
{`// This index counts the number of units ordered per category in all Product documents
// ===================================================================================

public class NumberOfUnitsOrdered_PerCategory : 
    AbstractIndexCreationTask<Product, NumberOfUnitsOrdered_PerCategory.IndexEntry>
{
    public class IndexEntry
    {
        public string Category { get; set; }
        public int NumberOfUnitsOrdered { get; set; }
    }
    
    public NumberOfUnitsOrdered_PerCategory()
    {
        Map = products => from product in products
            // Load the products' category 
            let categoryName = LoadDocument<Category>(product.Category).Name
            
            select new IndexEntry()
            {
                Category = categoryName,
                NumberOfUnitsOrdered = product.UnitsOnOrder
            };

        Reduce = results => from result in results
            group result by result.Category
            into g
            let unitsOrdered = g.Sum(x => x.NumberOfUnitsOrdered)
            
            select new IndexEntry()
            {
                Category = g.Key,
                NumberOfUnitsOrdered = unitsOrdered
            };
    }
}
`}
</CodeBlock>
</TabItem>
<TabItem value="Query" label="Query">
<CodeBlock language="csharp">
{`List<NumberOfUnitsOrdered_PerCategory.IndexEntry> results = session
     // Query the Map-Reduce index
    .Query<NumberOfUnitsOrdered_PerCategory.IndexEntry, 
        NumberOfUnitsOrdered_PerCategory>()
     // Convert the IRavenQueryable to IDocumentQuery
     // to be able to use 'IncludeExplanations'
    .ToDocumentQuery()
     // Call 'IncludeExplanations', provide:
     // * The group key for each result item
     // * An out param for the explanations results
    .IncludeExplanations(
        new ExplanationOptions { GroupKey = "Category" }, 
        out Explanations explanations)
     // Convert back to IRavenQueryable
     // to continue building the query using LINQ
    .ToQueryable()
     // Query for categories that have a total of more than a 400 units ordered
    .Where(x => x.NumberOfUnitsOrdered > 400)
    .ToList();

// Get the score details for an item in the results
// Pass the group key (Category, in this case) to 'GetExplanations'
string[] scoreDetails = explanations.GetExplanations(results[0].Category);
`}
</CodeBlock>
</TabItem>
<TabItem value="Query_async" label="Query_async">
<CodeBlock language="csharp">
{`List<NumberOfUnitsOrdered_PerCategory.IndexEntry> results = await asyncSession
     // Query the Map-Reduce index
    .Query<NumberOfUnitsOrdered_PerCategory.IndexEntry, 
        NumberOfUnitsOrdered_PerCategory>()
     // Convert the IRavenQueryable to IDocumentQuery
     // to be able to use 'IncludeExplanations'
    .ToAsyncDocumentQuery()
     // Call 'IncludeExplanations', provide:
     // * The group key for each result item
     // * An out param for the explanations results
    .IncludeExplanations(
        new ExplanationOptions { GroupKey = "Category" }, 
        out Explanations explanations)
     // Convert back to IRavenQueryable
     // to continue building the query using LINQ
    .ToQueryable()
     // Query for categories that have a total of more than a 400 units ordered
    .Where(x => x.NumberOfUnitsOrdered > 400)
    .ToListAsync();

// Get the score details for an item in the results
// Pass the group key (Category, in this case) to 'GetExplanations'
string[] scoreDetails = explanations.GetExplanations(results[0].Category);
`}
</CodeBlock>
</TabItem>
<TabItem value="DocumentQuery" label="DocumentQuery">
<CodeBlock language="csharp">
{`List<NumberOfUnitsOrdered_PerCategory.IndexEntry> results = session.Advanced
     // Query the Map-Reduce index
    .DocumentQuery<NumberOfUnitsOrdered_PerCategory.IndexEntry, 
        NumberOfUnitsOrdered_PerCategory>()
     // Call 'IncludeExplanations', provide:
     // * The group key for each result item
     // * An out param for the explanations results
    .IncludeExplanations(
        new ExplanationOptions { GroupKey = "Category" }, 
        out Explanations explanations)
     // Query for categories that have a total of more than a 400 units ordered
    .WhereGreaterThan(x => x.NumberOfUnitsOrdered, 400)
    .ToList();

// Get the score details for an item in the results
// Pass the group key (Category, in this case) to 'GetExplanations'
string[] scoreDetails = explanations.GetExplanations(results[0].Category);
`}
</CodeBlock>
</TabItem>
<TabItem value="DocumentQuery_async" label="DocumentQuery_async">
<CodeBlock language="csharp">
{`List<NumberOfUnitsOrdered_PerCategory.IndexEntry> results = await asyncSession.Advanced
     // Query the Map-Reduce index
    .AsyncDocumentQuery<NumberOfUnitsOrdered_PerCategory.IndexEntry, 
        NumberOfUnitsOrdered_PerCategory>()
     // Call 'IncludeExplanations', provide:
     // * The group key for each result item
     // * An out param for the explanations results
    .IncludeExplanations(
        new ExplanationOptions { GroupKey = "Category" }, 
        out Explanations explanations)
     // Query for categories that have a total of more than a 400 units ordered
    .WhereGreaterThan(x => x.NumberOfUnitsOrdered, 400)
    .ToListAsync();

// Get the score details for an item in the results
// Pass the group key (Category, in this case) to 'GetExplanations'
string[] scoreDetails = explanations.GetExplanations(results[0].Category);
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from index "NumberOfUnitsOrdered/PerCategory"
where NumberOfUnitsOrdered > 400
include explanations($p0)
{"p0" : { "GroupKey" : "Category" }}
`}
</CodeBlock>
</TabItem>
</Tabs>



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="csharp">
{`// Use this overload when querying a Map index
IDocumentQuery<T> IncludeExplanations(out Explanations explanations);

// Use this overload when querying a Map-Reduce index
IDocumentQuery<T> IncludeExplanations(ExplanationOptions options, out Explanations explanations);
`}
</CodeBlock>
</TabItem>

| Parameter         | Type                 | Description                                                             |
|-------------------|----------------------|-------------------------------------------------------------------------|
| **explanations**  | `Explanations`       | An _out_ param that will be filled with the explanations results.       |
| **options**       | `ExplanationOptions` | An object that specifies the GroupKey when querying a Map-Reduce index. |

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="csharp">
{`public class Explanations
\{
    // Returns a list with all explanations.
    // Pass the document ID of a document from the results to get its score details (Map index)
    // Pass the GroupKey of an item from the results to get its score details (Map-Reduce index)
    public string[] GetExplanations(string key);
\}
`}
</CodeBlock>
</TabItem>
<TabItem value="syntax_3" label="syntax_3">
<CodeBlock language="csharp">
{`public sealed class ExplanationOptions
\{
    // The group key that was used to group by the items in the Map-Reduce index
    public string GroupKey \{ get; set; \}
\}
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="nodejs">

<Admonition type="note" title="">

* This article provides examples of including explanations when querying a static-index.  

* **Prior to this article**, please refer to [Include Query Explanations](../../client-api/session/querying/debugging/include-explanations.mdx) for dynamic-query examples  
  and general knowledge about including explanations to retrieve the score of resulting documents.
  
    <Admonition type="info" title="">
    * Including explanations is available only when using **Lucene** as the underlying search engine for static-indexes.
    * You can configure which search engine will be used. Learn how in [Selecting the search engine](../../indexes/search-engine/corax.mdx#selecting-the-search-engine).
    </Admonition>
* In this page:
  * [Include explanations when querying Map index](../../indexes/querying/include-explanations.mdx#include-explanations-when-querying-map-index)  
  * [Include explanations when querying Map-Reduce index](../../indexes/querying/include-explanations.mdx#include-explanations-when-querying-map-reduce-index)  
  * [Syntax](../../indexes/querying/include-explanations.mdx#syntax)

</Admonition>
## Include explanations when querying Map index

<Tabs groupId='languageSyntax'>
<TabItem value="Map_index" label="Map_index">
<CodeBlock language="js">
{`class Products_BySearchName extends AbstractJavaScriptIndexCreationTask {
    constructor() {
        super();

        this.map("Products", product => {
            return {
                name: product.Name
            };
        });

        // Configure the index-field 'Name' for FTS
        this.index("name", "Search");
    }
}
`}
</CodeBlock>
</TabItem>
<TabItem value="Query" label="Query">
<CodeBlock language="js">
{`// Define an object that will receive the explanations results
let explanationsResults;

const products = await session
     // Query the index
    .query({ indexName: "Products/BySearchName" })
     // Call 'includeExplanations', provide an object for the explanations results
    .includeExplanations(e => explanationsResults = e)
    .search("name", "Syrup Lager")
    .all();

// When running the above query on the RavenDB sample data
// the results contain 3 product documents.

// Get the score details for a specific document from 'explanationsResults'
const id = session.advanced.getDocumentId(products[0]);
const scoreDetails = explanationsResults.explanations[products[0].id];
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from index "Products/BySearchName"
where search(name, "Syrup Lager")
include explanations()
// Or:
from index "Products/BySearchName"
where search(name, "Syrup") or search(name, "Lager")
include explanations()
`}
</CodeBlock>
</TabItem>
</Tabs>



## Include explanations when querying Map-Reduce index

<Tabs groupId='languageSyntax'>
<TabItem value="Map_Reduce_index" label="Map_Reduce_index">
<CodeBlock language="js">
{`class NumberOfUnitsOrdered_PerCategory extends AbstractJavaScriptIndexCreationTask {
    constructor() {
        super();

        const { load } = this.mapUtils();

        this.map("Products", product => {
            return {
                category: load(product.Category, "Categories").Name,
                numberOfUnitsOrdered: product.UnitsOnOrder
            };
        });

        this.reduce(results => results.groupBy(x => x.category).aggregate(g => {
            return {
                category: g.key,
                numberOfUnitsOrdered: g.values.reduce((a, b) => a + b.numberOfUnitsOrdered, 0)
            }
        }));
    }
}
`}
</CodeBlock>
</TabItem>
<TabItem value="Query" label="Query">
<CodeBlock language="js">
{`// Define an object that will receive the explanations results
let explanationsResults;

// Define the group key by which to get explanations results
const explanationsOptions = { groupKey: "category" }

const items = await session
     // Query the Map-Reduce index
    .query({ indexName: "NumberOfUnitsOrdered/PerCategory" })
     // Call 'includeExplanations', provide:
     // * Options with the defined group key
     // * An object for the explanations results
    .includeExplanations(explanationsOptions, e => explanationsResults = e)
     // Query for categories that have a total of more than a 400 units ordered
    .whereGreaterThan("numberOfUnitsOrdered", 400)
    .all();

// Get the score details for an item in the results
// Pass the group key (category, in this case) to 'explanations'
const scoreDetails = explanationsResults.explanations[items[0].category];
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from index "NumberOfUnitsOrdered/PerCategory"
where numberOfUnitsOrdered > 400
include explanations($p0)
{"p0" : { "GroupKey": "category" }}
`}
</CodeBlock>
</TabItem>
</Tabs>



## Syntax

<TabItem value="syntax_1" label="syntax_1">
<CodeBlock language="js">
{`// Use this overload when querying a Map index
query.includeExplanations(explanationsCallback)

// Use this overload when querying a Map-Reduce index
query.includeExplanations(options, explanationsCallback)
`}
</CodeBlock>
</TabItem>

| Parameter                | Type                            | Description                                                                                                                                                                    |
|--------------------------|---------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **explanationsCallback** | `(explanationsResults) => void` | &lt;ul&gt;&lt;li&gt;A callback function with an output parameter.&lt;/li&gt;&lt;li&gt;The parameter passed to the callback will be filled with the `Explanations` object when query returns.&lt;/li&gt;&lt;/ul&gt; |
| **options**              | `object`                        | An object that specifies the group key when querying a Map-Reduce index.                                                                                                       |

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="js">
{`// The Explanations object:
// ========================

class Explanations \{
    get explanations(): \{
        [key: string]: string[]; // An explanations list per key
    \};
\}
`}
</CodeBlock>
</TabItem>
<TabItem value="syntax_3" label="syntax_3">
<CodeBlock language="js">
{`// The Explanation Options object:
// ===============================
\{
    // The group key that was used to group by the items in the Map-Reduce index 
    groupKey; // string;
\}
`}
</CodeBlock>
</TabItem>




</LanguageContent>

<!---
### Indexes
- [Query Overview](../../client-api/session/querying/how-to-query)

### Querying
- [Indexing Basics](../../indexes/indexing-basics)


-->