---
title: "Listeners: What are store listeners and how to work with them?"
hide_table_of_contents: true
sidebar_label: Store listeners
sidebar_position: 1
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "java"];


# Listeners: What are store listeners and how to work with them?
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">


In order execute a custom action before or after a document is stored the `IDocumentStoreListener` needs to be implemented:

<TabItem value="document_store_interface" label="document_store_interface">
<CodeBlock language="csharp">
{`public interface IDocumentStoreListener
\{
	/// <summary>
	/// Invoked before the store request is sent to the server.
	/// </summary>
	/// <param name="key">The key.</param>
	/// <param name="entityInstance">The entity instance.</param>
	/// <param name="metadata">The metadata.</param>
	/// <param name="original">The original document that was loaded from the server</param>
	/// <returns>
	/// Whatever the entity instance was modified and requires us re-serialize it.
	/// Returning true would force re-serialization of the entity, returning false would 
	/// mean that any changes to the entityInstance would be ignored in the current SaveChanges call.
	/// </returns>
	bool BeforeStore(string key, object entityInstance, RavenJObject metadata,
						RavenJObject original);

	/// <summary>
	/// Invoked after the store request is sent to the server.
	/// </summary>
	/// <param name="key">The key.</param>
	/// <param name="entityInstance">The entity instance.</param>
	/// <param name="metadata">The metadata.</param>
	void AfterStore(string key, object entityInstance, RavenJObject metadata);
\}
`}
</CodeBlock>
</TabItem>

## Example

To prevent anyone from adding documents with a certain key, you can create `FilterForbiddenKeysDocumentListener`. In result the document with the specified forbidden id will not be stored.

<TabItem value="document_store_example" label="document_store_example">
<CodeBlock language="csharp">
{`public class FilterForbiddenKeysDocumentListener : IDocumentStoreListener
\{
	private readonly IList<string> forbiddenKeys = new List<string> \{ "system" \};

    public bool BeforeStore(string key, object entityInstance, RavenJObject metadata,
        RavenJObject original)
    \{
        if (forbiddenKeys.Any(x => x.ToLower().Equals(key)))
        \{
            throw new InvalidOperationException($"Store a document with a key: \{key\} is forbidden");
        \}
        return false;
    \}

    public void AfterStore(string key, object entityInstance, RavenJObject metadata)
	\{
	\}
\}
`}
</CodeBlock>
</TabItem>

</LanguageContent>
<LanguageContent language="java">


In order execute a custom action before or after a document is stored the `IDocumentStoreListener` needs to be implemented:

<TabItem value="document_store_interface" label="document_store_interface">
<CodeBlock language="java">
{`public interface IDocumentStoreListener \{
  /**
   * Invoked before the store request is sent to the server.
   * @param key The key.
   * @param entityInstance The entity instance.
   * @param metadata The metadata.
   * @param original The original document that was loaded from the server
   * @return
   *
   * Whatever the entity instance was modified and requires us re-serialize it.
   * Returning true would force re-serialization of the entity, returning false would
   * mean that any changes to the entityInstance would be ignored in the current SaveChanges call.
   */
  boolean beforeStore(String key, Object entityInstance, RavenJObject metadata, RavenJObject original);

  /**
   * Invoked after the store request is sent to the server.
   * @param key The key.
   * @param entityInstance The entity instance.
   * @param metadata The metadata
   */
  void afterStore(String key, Object entityInstance, RavenJObject metadata);
\}
`}
</CodeBlock>
</TabItem>

## Example

To prevent anyone from adding documents with a certain key, you can create `FilterForbiddenKeysDocumentListener`. In result the document with the specified forbidden id will not be stored.

<TabItem value="document_store_example" label="document_store_example">
<CodeBlock language="java">
{`public static class FilterForbiddenKeysDocumentListener implements IDocumentStoreListener \{
  private static final List<String> FORBIDDEN_KEYS = Arrays.asList("system");

  @Override
  public boolean beforeStore(String key, Object entityInstance, RavenJObject metadata, RavenJObject original) \{
    return FORBIDDEN_KEYS.contains(key.toLowerCase());
  \}

  @Override
  public void afterStore(String key, Object entityInstance, RavenJObject metadata) \{
    //empty by design
  \}
\}
`}
</CodeBlock>
</TabItem>

</LanguageContent>

<!---

-->