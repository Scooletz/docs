---
title: "Session: Querying: How to perform queries lazily?"
hide_table_of_contents: true
sidebar_label: Perform a Lazy Query
sidebar_position: 15
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "java"];


# Session: Querying: How to perform queries lazily?
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">


In some situations query execution must be delayed. To cover such scenario `Lazily` and many others query extensions has been introduced.

## Lazily and LazilyAsync

<TabItem value="lazy_1" label="lazy_1">
<CodeBlock language="csharp">
{`// Define a lazy query
Lazy<IEnumerable<Employee>> lazyEmployees = session
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
     // Add a call to 'Lazily'
    .Lazily();

IEnumerable<Employee> employees = lazyEmployees.Value; // Query is executed here
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **onEval** | Action&lt;IEnumerable&lt;TResult&gt;&gt; | Action that will be performed on query results. |

| Return Value | |
| ------------- | ----- |
| Lazy&lt;IEnumerable&lt;TResult&gt;&gt; | Lazy query initializer returning query results. |

### Example

<TabItem value="lazy_2" label="lazy_2">
<CodeBlock language="csharp">
{`// Define a lazy query
Lazy<Task<IEnumerable<Employee>>> lazyEmployees = asyncSession
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
     // Add a call to 'LazilyAsync'
    .LazilyAsync();

IEnumerable<Employee> employees = await lazyEmployees.Value; // Query is executed here
`}
</CodeBlock>
</TabItem>

or

<TabItem value="lazy_3" label="lazy_3">
<CodeBlock language="csharp">
{`// Define a lazy DocumentQuery
Lazy<IEnumerable<Employee>> lazyEmployees = session.Advanced
    .DocumentQuery<Employee>()
    .WhereEquals(x => x.FirstName, "Robert")
     // Add a call to 'Lazily'
    .Lazily();

IEnumerable<Employee> employees = lazyEmployees.Value; // DocumentQuery is executed here
`}
</CodeBlock>
</TabItem>



## CountLazily

<TabItem value="lazy_4" label="lazy_4">
<CodeBlock language="csharp">
{`// Define a lazy count query
Lazy<int> lazyCount = session
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
     // Add a call to 'CountLazily'
    .CountLazily();

int count = lazyCount.Value; // Query is executed here
`}
</CodeBlock>
</TabItem>

| Return Value | |
| ------------- | ----- |
| Lazy&lt;IEnumerable&lt;TResult&gt;&gt; | Lazy query initializer returning count of matched documents. |

### Example

<TabItem value="lazy_5" label="lazy_5">
<CodeBlock language="csharp">
{`// Define a lazy count query
Lazy<Task<int>> lazyCount = asyncSession
    .Query<Employee>()
    .Where(x => x.FirstName == "Robert")
     // Add a call to 'CountLazilyAsync'
    .CountLazilyAsync();

int count = await lazyCount.Value; // Query is executed here
`}
</CodeBlock>
</TabItem>



## SuggestLazy

<TabItem value="lazy_6" label="lazy_6">
<CodeBlock language="csharp">
{`// Define a lazy DocumentQuery
Lazy<int> lazyCount = session.Advanced
    .DocumentQuery<Employee>()
    .WhereEquals(x => x.FirstName, "Robert")
     // Add a call to 'CountLazily'
    .CountLazily();

int count = lazyCount.Value; // DocumentQuery is executed here
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **query** | [SuggestionQuery](../../../glossary/suggestion-query.mdx) | A suggestion query definition containing all information required to query a specified index. |

| Return Value | |
| ------------- | ----- |
| Lazy&lt;[SuggestionQueryResult](../../../glossary/suggestion-query-result.mdx)&gt; | Lazy query initializer containing array of all suggestions for executed query. |

### Example

<TabItem value="lazy_7" label="lazy_7">
<CodeBlock language="csharp">
{`// Define a lazy suggestion query
Lazy<Dictionary<string, SuggestionResult>> lazySuggestions = session
    .Query<Product>()
    .SuggestUsing(builder => builder.ByField(x => x.Name, "chaig"))
     // Add a call to 'ExecuteLazy'
    .ExecuteLazy();

Dictionary<string, SuggestionResult> suggest = lazySuggestions.Value; // Query is executed here
List<string> suggestions = suggest["Name"].Suggestions;
`}
</CodeBlock>
</TabItem>



## ToFacetsLazy

<TabItem value="lazy_8" label="lazy_8">
<CodeBlock language="csharp">
{`// Define a lazy suggestion query
Lazy<Task<Dictionary<string, SuggestionResult>>> lazySuggestions = asyncSession
    .Query<Employee>()
    .SuggestUsing(builder => builder.ByField("Name", "chaig"))
     // Add a call to 'ExecuteLazyAsync'
    .ExecuteLazyAsync();

Dictionary<string, SuggestionResult> suggest = await lazySuggestions.Value; // Query is executed here
List<string> suggestions = suggest["Name"].Suggestions;
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **facets** | List&lt;[Facet](../../../glossary/facet.mdx)&gt; | List of facets required to perform a facet query (mutually exclusive with `facetSetupDoc`). |
| **facetSetupDoc** | string | Document key that contains predefined [FacetSetup](../../../glossary/facet-setup.mdx) (mutually exclusive with `facets`). |
| **start** | int | number of results that should be skipped. Default: `0`. |
| **pageSize** | int | maximum number of results that will be retrieved. Default: `null`. |

| Return Value | |
| ------------- | ----- |
| Lazy&lt;[FacetResults](../../../glossary/facet-results.mdx)&gt; | Lazy query initializer containing Facet query results with query `Duration` and list of `Results` - one entry for each term/range as specified in [FacetSetup] document or passed in parameters. |

### Example

<TabItem value="lazy_9" label="lazy_9">
<CodeBlock language="csharp">
{`// Define a lazy DocumentQuery
Lazy<Dictionary<string, SuggestionResult>> lazySuggestions = session.Advanced
    .DocumentQuery<Employee>()
    .SuggestUsing(builder => builder.ByField("Name", "chaig"))
     // Add a call to 'ExecuteLazy'
    .ExecuteLazy();

Dictionary<string, SuggestionResult> suggest = lazySuggestions.Value; // DocumentQuery is executed here
List<string> suggestions = suggest["FullName"].Suggestions;
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="java">


In some situations query execution must be delayed. To cover such scenario `lazily` and many others query extensions has been introduced.

## Lazily

<TabItem value="lazy_1" label="lazy_1">
<CodeBlock language="java">
{`Lazy<List<T>> lazily();

Lazy<List<T>> lazily(Consumer<List<T>> onEval);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **onEval** | Action1&lt;List&lt;T&gt;&gt; | Action that will be performed on query results. |

| Return Value | |
| ------------- | ----- |
| Lazy&lt;List&lt;TResult&gt;&gt; | Lazy query initializer returning query results. |

### Example

<TabItem value="lazy_2" label="lazy_2">
<CodeBlock language="java">
{`Lazy<List<Employee>> employeesLazy = session
    .query(Employee.class)
    .whereEquals("FirstName", "Robert")
    .lazily();

List<Employee> employees = employeesLazy.getValue(); // query will be executed here
`}
</CodeBlock>
</TabItem>



## CountLazily

<TabItem value="lazy_4" label="lazy_4">
<CodeBlock language="java">
{`Lazy<Integer> countLazily();
`}
</CodeBlock>
</TabItem>

| Return Value | |
| ------------- | ----- |
| Lazy&lt;List&lt;TResult&gt;&gt; | Lazy query initializer returning count of matched documents. |

### Example

<TabItem value="lazy_5" label="lazy_5">
<CodeBlock language="java">
{`Lazy<Integer> countLazy = session
    .query(Employee.class)
    .whereEquals("FirstName", "Robert")
    .countLazily();

Integer count = countLazy.getValue(); // query will be executed here
`}
</CodeBlock>
</TabItem>



## SuggestLazy

<TabItem value="lazy_6" label="lazy_6">
<CodeBlock language="java">
{`Lazy<Map<String, SuggestionResult>> executeLazy();

Lazy<Map<String, SuggestionResult>> executeLazy(Consumer<Map<String, SuggestionResult>> onEval);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **query** | [SuggestionQuery](../../../glossary/suggestion-query.mdx) | A suggestion query definition containing all information required to query a specified index. |

| Return Value | |
| ------------- | ----- |
| Lazy&lt;[SuggestionQueryResult](../../../glossary/suggestion-query-result.mdx)&gt; | Lazy query initializer containing array of all suggestions for executed query. |

### Example

<TabItem value="lazy_7" label="lazy_7">
<CodeBlock language="java">
{`Lazy<Map<String, SuggestionResult>> suggestLazy = session
    .query(Employee.class, Query.index("Employees_ByFullName"))
    .suggestUsing(builder -> builder.byField("FullName", "johne"))
    .executeLazy();

Map<String, SuggestionResult> suggest = suggestLazy.getValue(); // query will be executed here
List<String> suggestions = suggest.get("FullName").getSuggestions();
`}
</CodeBlock>
</TabItem>



## ToFacetsLazy

<TabItem value="lazy_8" label="lazy_8">
<CodeBlock language="java">
{`Lazy<Map<String, FacetResult>> executeLazy();

Lazy<Map<String, FacetResult>> executeLazy(Consumer<Map<String, FacetResult>> onEval);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **facets** | List&lt;[Facet](../../../glossary/facet.mdx)&gt; | List of facets required to perform a facet query (mutually exclusive with `facetSetupDoc`). |
| **facetSetupDoc** | String | Document key that contains predefined [FacetSetup](../../../glossary/facet-setup.mdx) (mutually exclusive with `facets`). |
| **start** | int | number of results that should be skipped. Default: `0`. |
| **pageSize** | int | maximum number of results that will be retrieved. Default: `null`. |

| Return Value | |
| ------------- | ----- |
| Lazy&lt;[FacetResults](../../../glossary/facet-results.mdx)&gt; | Lazy query initializer containing Facet query results with query `Duration` and list of `Results` - one entry for each term/range as specified in [FacetSetup] document or passed in parameters. |

### Example

<TabItem value="lazy_9" label="lazy_9">
<CodeBlock language="java">
{`Lazy<Map<String, FacetResult>> facetsLazy = session
    .query(Camera.class, Query.index("Camera/Costs"))
    .aggregateUsing("facets/CameraFacets")
    .executeLazy();

Map<String, FacetResult> facets = facetsLazy.getValue(); // query will be executed here
FacetResult results = facets.get("manufacturer");
`}
</CodeBlock>
</TabItem>




</LanguageContent>

<!---
- [How to perform operations lazily?](../how-to/perform-operations-lazily)

-->