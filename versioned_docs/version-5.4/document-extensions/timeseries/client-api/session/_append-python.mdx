import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* Use `time_series_for.append_single` or `time_series_for.append` for the following actions:
    * **Creating a new time series**  
      Appending an entry to a time series that doesn't exist yet  
      will create the time series and add it the new entry.
    * **Creating a new time series entry**  
      Appending a new entry to an existing time series  
      will add the entry to the series at the specified timestamp.
    * **Modifying an existing time series entry**  
      Use `append_single` or `append` to update the data of an existing entry with the specified timestamp.

* Each call to `append_single` handles a **single** time series value at 
  a **single** [time series entry](../../../../document-extensions/timeseries/design.mdx#time-series-entries).  
  Each call to `append` can handle **multiple** time series values at 
  a **single** [time series entry](../../../../document-extensions/timeseries/design.mdx#time-series-entries).  

* To append **multiple** entries in a single transaction you can:  
   * Call `append_single` or `append` as many times as needed before calling `session.save_changes`, as shown in the examples below.  
   * Use patching to update the time series. Learn more in [Patch time series entries](../../../../document-extensions/timeseries/client-api/session/patch.mdx).  
   * Append entries directly on the _Store_ via [Operations](../../../../client-api/operations/what-are-operations.mdx). 
     Learn more in [Append time series operations](../../../../document-extensions/timeseries/client-api/operations/append-and-delete.mdx).  

* In this page:
    * [Usage](../../../../document-extensions/timeseries/client-api/session/append.mdx#usage)
    * [Examples](../../../../document-extensions/timeseries/client-api/session/append.mdx#examples)
       * [Append entries with a single value](../../../../document-extensions/timeseries/client-api/session/append.mdx#append-entries-with-a-single-value)
       * [Append entries with multiple values](../../../../document-extensions/timeseries/client-api/session/append.mdx#append-entries-with-multiple-values)
    * [Syntax](../../../../document-extensions/timeseries/client-api/session/append.mdx#syntax)

</Admonition>
## Usage

**Flow**:

* Open a session.
* Create an instance of `time_series_for` and pass it the following:
    * Provide an explicit document ID, -or-  
      pass an [entity tracked by the session](../../../../client-api/session/what-is-a-session-and-how-does-it-work.mdx#unit-of-work-pattern),
      e.g. a document object returned from [session.query](../../../../client-api/session/querying/how-to-query.mdx) 
      or from [session.load](../../../../client-api/session/loading-entities.mdx#load).
    * Specify the time series name.
* Call `time_series_for.append_single` or `time_series_for.append` and pass it the time series entry details.
* Call `session.save_changes` for the action to take effect on the server.

**Note**:

* A `DocumentDoesNotExistException` exception is thrown if the specified document does not exist.



## Examples

#### Append entries with a single value:

* In this example, entries are appended with a single value.
* Although a loop is used to append multiple entries,  
  all entries are appended in a single transaction when `save_changes` is executed.

<TabItem value="timeseries_region_TimeSeriesFor-Append-TimeSeries-Range" label="timeseries_region_TimeSeriesFor-Append-TimeSeries-Range">
<CodeBlock language="python">
{`base_line = datetime.utcnow()

# Append 10 HeartRate values
with store.open_session() as session:
    session.store(User(name="John"), "users/john")

    tsf = session.time_series_for("users/john", "HeartRates")

    for i in range(10):
        tsf.append_single(base_line + timedelta(seconds=i), 67.0, "watches/fitbit")

    session.save_changes()
`}
</CodeBlock>
</TabItem>
#### Append entries with multiple values:

* In this example, we append multi-value StockPrice entries.  
* Notice the clarity gained by naming the values.  

<Tabs groupId='languageSyntax'>
<TabItem value="Native" label="Native">
<CodeBlock language="python">
{`with store.open_session() as session:
    session.store(User(name="John"), "users/john")

    session.time_series_for("users/john", "StockPrices").append(
        base_line + timedelta(days=1), [52, 54, 63.5, 51.4, 9824], "companies/kitchenAppliances"
    )

    session.time_series_for("users/john", "StockPrices").append(
        base_line + timedelta(days=2), [54, 55, 61.5, 49.4, 8400], "companies/kitchenAppliances"
    )

    session.time_series_for("users/john", "StockPrices").append(
        base_line + timedelta(days=3), [55, 57, 65.5, 50, 9020], "companies/kitchenAppliances"
    )

    session.save_changes()
`}
</CodeBlock>
</TabItem>
<TabItem value="Using_named_values" label="Using_named_values">
<CodeBlock language="python">
{`with store.open_session() as session:
    session.store(User(name="John"), "users/john")

    session.typed_time_series_for(StockPrice, "users/john").append_single(
        base_line + timedelta(days=1), StockPrice(52, 54, 63.5, 51.4, 9824), "companies/kitchenAppliances"
    )

    session.typed_time_series_for(StockPrice, "users/john").append_single(
        base_line + timedelta(days=2), StockPrice(54, 55, 61.5, 49.4, 8400), "companies/kitchenAppliances"
    )

    session.typed_time_series_for(StockPrice, "users/john").append_single(
        base_line + timedelta(days=3), StockPrice(55, 57, 65.5, 50, 9020), "companies/kitchenAppliances"
    )

    session.save_changes()
`}
</CodeBlock>
</TabItem>
</Tabs>



## Syntax

<TabItem value="TimeSeriesFor-Append-definition-double" label="TimeSeriesFor-Append-definition-double">
<CodeBlock language="python">
{`def append_single(self, timestamp: datetime, value: float, tag: Optional[str] = None) -> None: ...
`}
</CodeBlock>
</TabItem>

<TabItem value="TimeSeriesFor-Append-definition-inum" label="TimeSeriesFor-Append-definition-inum">
<CodeBlock language="python">
{`def append(self, timestamp: datetime, values: List[float], tag: Optional[str] = None) -> None: ...
`}
</CodeBlock>
</TabItem>

| Parameter | Type | Description |
|-----------|------|-------------|
| **timestamp** | `datetime` | Time series entry's timestamp |
| **value** | `float` | Entry's value |
| **values** | `List[float]` | Entry's values |
| **tag** (Optional) | `str` | An optional tag for the entry |




