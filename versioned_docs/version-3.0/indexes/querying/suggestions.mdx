---
title: "Suggestions"
hide_table_of_contents: true
sidebar_label: Suggestions
sidebar_position: 10
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "java"];


# Suggestions
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">


RavenDB indexing mechanism in built upon Lucene engine that has a great suggestions feature. This capability has been also introduced to RavenDB and allows a significant improvement of search functionalities enhancing the overall user experience of the application.

Let's consider an example where the users have the option to look for products by their name. The index and query would look as follow:

<TabItem value="suggestions_1" label="suggestions_1">
<CodeBlock language="csharp">
{`0
                    // Define the suggestion request for multiple terms
                    var suggestionRequest = new SuggestionWithTerms("ProductName")
                    \{
                        // Looking for terms from index-field 'ProductName' that are similar to 'chokolade' OR 'syrop'  
                        Terms = new[] \{ "chokolade", "syrop"\}
                    \};

                    // Query the index for suggestions 
                    Dictionary<string, SuggestionResult> suggestions = session
                        .Query<Products_ByName.IndexEntry, Products_ByName>()
                         // Call 'SuggestUsing' - pass the suggestion request
                        .SuggestUsing(suggestionRequest)
                        .Execute();
`}
</CodeBlock>
</TabItem>

<TabItem value="suggestions_2" label="suggestions_2">
<CodeBlock language="csharp">
{`// This query on index 'Products/ByName' has NO resulting documents
List<Product> products = session
    .Query<Products_ByName.IndexEntry, Products_ByName>()
    .Search(x => x.ProductName, "chokolade")
    .OfType<Product>()
    .ToList();
`}
</CodeBlock>
</TabItem>

If our database have `Northwind` samples deployed then it will not return any results, but we can ask RavenDB for help by using:

<TabItem value="suggestions_3" label="suggestions_3">
<CodeBlock language="csharp">
{`// Query the index for suggested terms for single term:
// ====================================================

Dictionary<string, SuggestionResult> suggestions = session
     // Query the index   
    .Query<Products_ByName.IndexEntry, Products_ByName>()
     // Call 'SuggestUsing'
    .SuggestUsing(builder => builder
         // Request to get terms from index-field 'ProductName' that are similar to 'chokolade' 
        .ByField(x => x.ProductName, "chokolade"))
    .Execute();
`}
</CodeBlock>
</TabItem>

It will produce the suggestions:

    Did you mean?
        chang
        chai

The `Suggest` method is an extension contained in `Raven.Client` namespace. It also has an overload that takes one parameter - `SuggestionQuery` that allows
you to specify the suggestion query options:

* *Field* - the name of the field that you want to find suggestions in,
* *Term* - the provided by user search term,
* *MaxSuggestions* - the number of suggestions to return (default: `15`),
* *Distance* - the enum that indicates what string distance algorithm should be used: [JaroWinkler](https://en.wikipedia.org/wiki/Jaro%E2%80%93Winkler_distance), [Levenshtein](https://en.wikipedia.org/wiki/Levenshtein_distance) (default) or [NGram](http://webdocs.cs.ualberta.ca/~kondrak/papers/spire05.pdf),
* *Accuracy* - the minimal accuracy required from a string distance for a suggestion match (default: 0.0),
* *Popularity* - determines whether the returned terms should be in order of popularity (default: false).

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="csharp">
{`session
	.Query<Product, Products_ByName>()
	.Suggest(
		new SuggestionQuery
		{
			Field = "Name",
			Term = "chaig",
			Accuracy = 0.4f,
			MaxSuggestions = 5,
			Distance = StringDistanceTypes.JaroWinkler,
			Popularity = true
		});
`}
</CodeBlock>
</TabItem>
<TabItem value="Commands" label="Commands">
<CodeBlock language="csharp">
{`store
	.DatabaseCommands
	.Suggest(
		"Products/ByName",
		new SuggestionQuery
		{
			Field = "Name",
			Term = "chaig",
			Accuracy = 0.4f,
			MaxSuggestions = 5,
			Distance = StringDistanceTypes.JaroWinkler,
			Popularity = true
		});
`}
</CodeBlock>
</TabItem>
<TabItem value="Index" label="Index">
<CodeBlock language="csharp">
{`public class Products_ByName : AbstractIndexCreationTask<Product>
{
	public Products_ByName()
	{
		Map = products => from product in products
						  select new
							{
								product.Name
							};

		Indexes.Add(x => x.Name, FieldIndexing.Analyzed);	// (optional) splitting name into multiple tokens
		Suggestion(x => x.Name);				// configuring suggestions
	}
}
`}
</CodeBlock>
</TabItem>
</Tabs>

## Suggest over multiple words

RavenDB allows you to perform a suggestion query over multiple words. In order to use this functionalify you have to pass words that you are looking for in *Term* by using special RavenDB syntax (more details [here](../../indexes/querying/full-query-syntax.mdx#suggestions-over-multiple-words)):

<TabItem value="query_suggestion_over_multiple_words" label="query_suggestion_over_multiple_words">
<CodeBlock language="csharp">
{`var resultsByMultipleWords = session
    .Query<Product, Products_ByName>()
    .SuggestUsing(builder => builder
        .ByField(x => x.Name, new[] \{ "chaig", "tof" \})
        .WithOptions(new SuggestionOptions
        \{
            Accuracy = 0.4f,
            PageSize = 5,
            Distance = StringDistanceTypes.JaroWinkler,
            SortMode = SuggestionSortMode.Popularity
        \}))
    .Execute();

Console.WriteLine("Did you mean?");

foreach (string suggestion in resultsByMultipleWords["Name"].Suggestions)
\{
    Console.WriteLine("\\t\{0\}", suggestion);
\}
`}
</CodeBlock>
</TabItem>

This will produce the results:

    Did you mean?
        chai
        chang
        chartreuse
        chef
        tofu

## Remarks

<Admonition type="warning" title="Warning">
Suggestions does not take advantage of the [encryption bundle](../../server/bundles/encryption.mdx). You should never use this feature on information that should be encrypted, because then you have a risk of storing sensitive data on a disk in unsecured manner.
</Admonition>

<Admonition type="warning" title="Increased indexing time" id="increased-indexing-time" href="#increased-indexing-time">

Indexes with turned on suggestions tend to use much more CPU power than other indexes, this can impact indexing speed (querying is not impacted).

</Admonition>


</LanguageContent>
<LanguageContent language="java">


RavenDB indexing mechanism in built upon Lucene engine that has a great suggestions feature. This capability has been also introduced to RavenDB and allows a significant improvement of search functionalities enhancing the overall user experience of the application.

Let's consider an example where the users have the option to look for products by their name. The index and query would look as follow:

<TabItem value="suggestions_1" label="suggestions_1">
<CodeBlock language="java">
{`public class Products_ByName extends AbstractIndexCreationTask \{
    public Products_ByName() \{
        map = "from product in docs.Products " +
            "select new " +
            "\{ " +
            "  product.Name " +
            "\} ";

        index("Name", FieldIndexing.SEARCH); // (optional) splitting name into multiple tokens
        suggestion("Name");// configuring suggestions
    \}
\}
`}
</CodeBlock>
</TabItem>

<TabItem value="suggestions_2" label="suggestions_2">
<CodeBlock language="java">
{`Product product = session
    .query(Product.class, Products_ByName.class)
    .search("Name", "chaig")
    .firstOrDefault();
`}
</CodeBlock>
</TabItem>

If our database have `Northwind` samples deployed then it will not return any results, but we can ask RavenDB for help by using:

<TabItem value="suggestions_3" label="suggestions_3">
<CodeBlock language="java">
{`Map<String, SuggestionResult> suggestionResult = session
    .query(Product.class, Products_ByName.class)
    .suggestUsing(builder -> builder.byField("Name", "chaig"))
    .execute();

System.out.println("Did you mean?");

for (String suggestion : suggestionResult.get("Name").getSuggestions()) \{
    System.out.println("\\t" + suggestion);
\}
`}
</CodeBlock>
</TabItem>

It will produce the suggestions:

    Did you mean?
        chang
        chai

The `suggest` method has an overload that takes one parameter - `SuggestionQuery` that allows
you to specify the suggestion query options:

* *Field* - the name of the field that you want to find suggestions in,
* *Term* - the provided by user search term,
* *MaxSuggestions* - the number of suggestions to return (default: `15`),
* *Distance* - the enum that indicates what string distance algorithm should be used: [JaroWinkler](https://en.wikipedia.org/wiki/Jaro%E2%80%93Winkler_distance), [Levenshtein](https://en.wikipedia.org/wiki/Levenshtein_distance) (default) or [NGram](http://webdocs.cs.ualberta.ca/~kondrak/papers/spire05.pdf),
* *Accuracy* - the minimal accuracy required from a string distance for a suggestion match (default: 0.0),
* *Popularity* - determines whether the returned terms should be in order of popularity (default: false).

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="java">
{`SuggestionQuery suggestionQuery = new SuggestionQuery();
suggestionQuery.setField("Name");
suggestionQuery.setTerm("chaig");
suggestionQuery.setAccuracy(0.4f);
suggestionQuery.setMaxSuggestions(5);
suggestionQuery.setDistance(StringDistanceTypes.JARO_WINKLER);
suggestionQuery.setPopularity(true);
session
  .query(Product.class, Products_ByName.class)
  .suggest(suggestionQuery);
`}
</CodeBlock>
</TabItem>
<TabItem value="Commands" label="Commands">
<CodeBlock language="java">
{`SuggestionQuery suggestionQuery = new SuggestionQuery();
suggestionQuery.setField("Name");
suggestionQuery.setTerm("chaig");
suggestionQuery.setAccuracy(0.4f);
suggestionQuery.setMaxSuggestions(5);
suggestionQuery.setDistance(StringDistanceTypes.JARO_WINKLER);
suggestionQuery.setPopularity(true);
store
  .getDatabaseCommands()
  .suggest("Products/ByName", suggestionQuery);
`}
</CodeBlock>
</TabItem>
<TabItem value="Index" label="Index">
<CodeBlock language="java">
{`public static class Products_ByName extends AbstractIndexCreationTask {
  public Products_ByName() {
    QProduct p = QProduct.product;
    map =
     " from product in docs.Products " +
     " select new                    " +
     "   {                           " +
     "       product.Name            " +
     "   }; ";

    index(p.name, FieldIndexing.ANALYZED); // (optional) splitting name into multiple tokens
    suggestion(p.name); // configuring suggestions
  }
}
`}
</CodeBlock>
</TabItem>
</Tabs>

## Suggest over multiple words

RavenDB allows you to perform a suggestion query over multiple words. In order to use this functionalify you have to pass words that you are looking for in *Term* by using special RavenDB syntax (more details [here](../../indexes/querying/full-query-syntax.mdx#suggestions-over-multiple-words)):

<TabItem value="query_suggestion_over_multiple_words" label="query_suggestion_over_multiple_words">
<CodeBlock language="java">
{`SuggestionOptions options = new SuggestionOptions();
options.setAccuracy(0.4f);
options.setPageSize(5);
options.setDistance(StringDistanceTypes.JARO_WINKLER);
options.setSortMode(SuggestionSortMode.POPULARITY);

Map<String, SuggestionResult> resultsByMultipleWords = session
    .query(Product.class, Products_ByName.class)
    .suggestUsing(builder ->
        builder.byField("Name", new String[]\{"chaig", "tof"\})
            .withOptions(options))
    .execute();

System.out.println("Did you mean?");

for (String suggestion : resultsByMultipleWords.get("Name").getSuggestions()) \{
    System.out.println("\\t" + suggestion);
\}
`}
</CodeBlock>
</TabItem>

This will produce the results:

    Did you mean?
        chai
        chang
        chartreuse
        chef
        tofu

## Remarks

<Admonition type="warning" title="Warning">
Suggestions does not take advantage of the [encryption bundle](../../server/bundles/encryption.mdx). You should never use this feature on information that should be encrypted, because then you have a risk of storing sensitive data on a disk in unsecured manner.
</Admonition>

<Admonition type="warning" title="Increased indexing time" id="increased-indexing-time" href="#increased-indexing-time">

Indexes with turned on suggestions tend to use much more CPU power than other indexes, this can impact indexing speed (querying is not impacted).

</Admonition>


</LanguageContent>

<!---
- [Client API : Session : How to work with suggestions?](../../client-api/session/querying/how-to-work-with-suggestions)

-->