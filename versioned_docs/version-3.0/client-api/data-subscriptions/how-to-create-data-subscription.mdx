---
title: "No title"
hide_table_of_contents: true
sidebar_label: How to create a data subscription?
sidebar_position: 1
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "java"];



<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">


In order to create a data subscription you have to specify the criteria that documents must match to be incorporated into subscription results. Note there are two types of
criteria you can pass into `Create` method:

<TabItem value="create_1" label="create_1">
<CodeBlock language="csharp">
{`long Create(SubscriptionCriteria criteria, string database = null);

long Create<T>(SubscriptionCriteria<T> criteria, string database = null);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **criteria** | SubscriptionCriteria / SubscriptionCriteria&lt;T&gt; | Subscription criteria - standard or strongly typed. |
| **database** | string | Name of database to create a data subscription. If `null`, default database configured in DocumentStore will be used. |

| Return value | |
| ------------- | ----- |
| long | A data subscription identifier. |

The first one is `SubscriptionCriteria`, where you can specify the following filters:

* _KeyStartsWith_ - a document id must starts with a specified prefix,
* _BelongsToAnyCollection_ - list of collections that the subscription deals with,
* _PropertiesMatch_ - dictionary of field names and related values that a document must have,
* _PropertiesNotMatch_ - dictionary of field names and related values that a document must not have,
* _StartEtag_ - an etag of a document which a subscription is going to consider as already acknowledged and start processing docs with higher etags.

The second one is generic `SubscriptionCriteria<T>` where `T` is an entity type. Analogously you can set:

* &lt;em&gt;KeyStartsWith&lt;/em&gt;,
* &lt;em&gt;PropertiesMatch&lt;/em&gt;,
* &lt;em&gt;PropertiesNotMatch&lt;/em&gt;,
* &lt;em&gt;StartEtag&lt;/em&gt;

_BelongsToAnyCollection_ will be automatically filled in by a single value based on the entity type (see [FindTypeTagName](../configuration/conventions/identifier-generation/global.mdx#findtypetagname-and-finddynamictagname) convention).

Additionally the criteria object has _StartEtag_ property which sets the etag of the first document that the subscription starts from (in large databases can be used to skip documents that you already know they won't match the given criteria).

The execution of `Create` method will create a data subscription in a database and return its identifier (you can see `Raven/Subscriptions/[id]` documents in the database).
This identifier is needed to open the subscription so you need to keep that information to be able to make use of it later.

### Example I

<TabItem value="create_2" label="create_2">
<CodeBlock language="csharp">
{`var id = store.Subscriptions.Create(new SubscriptionCriteria
\{
	KeyStartsWith = "employees/",
	PropertiesNotMatch = new Dictionary<string, RavenJToken>()
	\{
		\{ "Address.City", "Seattle" \}
	\}
\});
`}
</CodeBlock>
</TabItem>

In this case we want to get all documents that id starts with `employees/` but does not contain `Address.City` field with value `Seattle`.
Note that although we specified `employees/` prefix id it doesn't mean we will get documents belonging to the same collection. It can return a developer (`employees/developers/1`)
as well as a manager (`employees/managers/1`), anyhow we can be sure that none of them is living in `Seattle`.

### Example II

<TabItem value="create_3" label="create_3">
<CodeBlock language="csharp">
{`var id = store.Subscriptions.Create(new SubscriptionCriteria<Order>()
\{
	PropertiesMatch = new Dictionary<Expression<Func<Order, object>>, RavenJToken>()
	\{
		\{ x => x.Employee, "employees/1"\}
	\}
\});
`}
</CodeBlock>
</TabItem>

In this case, it will give us all the orders, but only those which are handled by `employees/1` employee. Here we used generic type criteria, so we can specify properties filtering in strongly typed way.
Also we can be sure that all returned documents belong to `Orders` collection (so we will be able to open the strongly typed subscription).

</LanguageContent>
<LanguageContent language="java">


In order to create a data subscription you have to specify the criteria that documents must match to be incorporated into subscription results.

<TabItem value="create_1" label="create_1">
<CodeBlock language="java">
{`long create(Class<?> expectedType, SubscriptionCriteria criteria);

long create(Class<?> expectedType, SubscriptionCriteria criteria, String database);

long create(SubscriptionCriteria criteria);

long create(SubscriptionCriteria criteria, String database);
`}
</CodeBlock>
</TabItem>

| Parameters | | |
| ------------- | ------------- | ----- |
| **clazz** | Class | Use for creating strongly typed subscription. |
| **criteria** | SubscriptionCriteria | Subscription criteria. |
| **database** | String | Name of database to create a data subscription. If `null`, default database configured in DocumentStore will be used. |

| Return value | |
| ------------- | ----- |
| long | A data subscription identifier. |

In `SubscriptionCriteria`, where you can specify the following filters:

* _KeyStartsWith_ - a document id must starts with a specified prefix,
* _BelongsToAnyCollection_ - list of collections that the subscription deals with,
* _PropertiesMatch_ - map of field names and related values that a document must have,
* _PropertiesNotMatch_ - map of field names and related values that a document must not have,
* _StartEtag_ - an etag of a document which a subscription is going to consider as already acknowledged and start processing docs with higher etags.

_BelongsToAnyCollection_ will be automatically filled in by a single value based on the entity type (see [findTypeTagName](../configuration/conventions/identifier-generation/global.mdx#findtypetagname-and-finddynamictagname) convention), when using override with clazz parameter.

Additionally the criteria object has _StartEtag_ property which sets the etag of the first document that the subscription starts from (in large databases can be used to skip documents that you already know they won't match the given criteria).

The execution of `create` method will create a data subscription in a database and return its identifier (you can see `Raven/Subscriptions/[id]` documents in the database).
This identifier is needed to open the subscription so you need to keep that information to be able to make use of it later.

### Example I

<TabItem value="create_2" label="create_2">
<CodeBlock language="java">
{`SubscriptionCriteria criteria = new SubscriptionCriteria();
criteria.setKeyStartsWith("employees/");
criteria.propertyNotMatch("Address.City", RavenJToken.fromObject("Seattle"));
long id = store.subscriptions().create(criteria);
`}
</CodeBlock>
</TabItem>

In this case we want to get all documents that id starts with `employees/` but does not contain `Address.City` field with value `Seattle`.
Note that although we specified `employees/` prefix id it doesn't mean we will get documents belonging to the same collection. It can return a developer (`employees/developers/1`)
as well as a manager (`employees/managers/1`), anyhow we can be sure that none of them is living in `Seattle`.

### Example II

<TabItem value="create_3" label="create_3">
<CodeBlock language="java">
{`QOrder o = QOrder.order;
SubscriptionCriteria criteria = new SubscriptionCriteria();
criteria.propertyMatch(o.company, "company/1");
long id = store.subscriptions().create(criteria);
`}
</CodeBlock>
</TabItem>

In this case, it will give us all the orders, but only those which are handled by `employees/1` employee. Here we used generic type criteria, so we can specify properties filtering in strongly typed way.
Also we can be sure that all returned documents belong to `Orders` collection (so we will be able to open the strongly typed subscription).

</LanguageContent>

<!---

-->