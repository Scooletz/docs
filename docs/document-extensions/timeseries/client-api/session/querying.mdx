---
title: "Time Series Querying"
sidebar_label: Querying
sidebar_position: 5
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "nodejs"];


# Time Series Querying 
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">

<Admonition type="note" title="Note">

* Time series data can be effectively queried in RavenDB, 
  allowing users to access and analyze information based on specific time intervals.
  
* Time series queries can be made using:  
  * The high-level `Query` method utilizing LINQ,  
  * The lower-level API `DocumentQuery`,  
  * Or directly through [RQL](../../../../client-api/session/querying/what-is-rql),
    which can be provided to a `RawQuery` or executed from the Studio's [Query view](../../../../studio/database/queries/query-view).

* In this page:  
    * [Query](../../../../document-extensions/timeseries/client-api/session/querying#query)
        * [Query usage](../../../../document-extensions/timeseries/client-api/session/querying#query-usage)
        * [Query examples](../../../../document-extensions/timeseries/client-api/session/querying#query-examples)  
        * [Query syntax](../../../../document-extensions/timeseries/client-api/session/querying#query-syntax)
    * [DocumentQuery](../../../../document-extensions/timeseries/client-api/session/querying#documentquery)
        * [DocumentQuery usage](../../../../document-extensions/timeseries/client-api/session/querying#documentquery-usage)
        * [DocumentQuery examples](../../../../document-extensions/timeseries/client-api/session/querying#documentquery-examples)
        * [DocumentQuery Syntax](../../../../document-extensions/timeseries/client-api/session/querying#documentquery-syntax)
    * [RawQuery](../../../../document-extensions/timeseries/client-api/session/querying#rawquery)
        * [RawQuery usage](../../../../document-extensions/timeseries/client-api/session/querying#rawquery-usage)
        * [RawQuery examples](../../../../document-extensions/timeseries/client-api/session/querying#rawquery-examples)
        * [RawQuery syntax](../../../../document-extensions/timeseries/client-api/session/querying#rawquery-syntax)
    
</Admonition>

<Admonition type="info" title="Info">
Learn more about time series queries in the [section dedicated to this subject](../../../../document-extensions/timeseries/querying/overview-and-syntax).  
</Admonition>
## Query

### Query usage

* Open a session  
* Call `session.Query`:
  * Extend the query using LINQ expressions
  * Provide a `Where` query predicate to locate documents whose time series you want to query  
  * Use `Select` to choose a time series and project time series data
  * Execute the query
* Results will be in the form:
  * `TimeSeriesRawResult` for non-aggregated data, or -  
  * `TimeSeriesAggregationResult` for aggregated data  
* Note:  
  The RavenDB client translates the LINQ query to [RQL](../../../../client-api/session/querying/what-is-rql) before transmitting it to the server for execution.
### Query examples

* This LINQ query filters users by their age and retrieves their HeartRates time series.  
  The first occurence of `Where` filters the documents.  
  The second `Where` filters the time series entries.
<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="csharp">
{`using (var session = store.OpenSession())
{
    // Define the query:
    var query = session.Query<User>()
             // Filter the user documents
            .Where(u => u.Age < 30)
             // Call 'Select' to project the time series entries
            .Select(q => RavenQuery.TimeSeries(q, "HeartRates")
                 // Filter the time series entries    
                .Where(ts => ts.Tag == "watches/fitbit")
                 // 'ToList' must be applied here to the inner time series query definition
                 // This will not trigger query execution at this point
                .ToList());
    
    // Execute the query:
    // The following call to 'ToList' will trigger query execution
    List<TimeSeriesRawResult> result = query.ToList();
}
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Users" as q
where q.Age < 30
select timeseries(from q.HeartRates where (Tag == "watches/fitbit"))
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, we select a three-day range from the HeartRates time series.  
<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="csharp">
{`var baseTime = new DateTime(2020, 5, 17, 00, 00, 00);

var query = session.Query<User>()
    .Select(q => RavenQuery
        .TimeSeries(q, "HeartRates", baseTime, baseTime.AddDays(3))
        .ToList());

List<TimeSeriesRawResult> result = query.ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Users" as q
select timeseries(from q.HeartRates between "2020-05-17T00:00:00.0000000" and "2020-05-17T00:03:00.0000000")
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, we retrieve a company's stock trade data.  
  Note the usage of named values, so we may address trade Volume [by name](../../../../document-extensions/timeseries/client-api/named-time-series-values).  
<Tabs groupId='languageSyntax'>
<TabItem value="Native" label="Native">
<CodeBlock language="csharp">
{`using (var session = store.OpenSession())
{
    var query = session.Query<Company>()
        .Where(c => c.Address.City == "New York")
        .Select(q => RavenQuery.TimeSeries(q, "StockPrices", baseTime, baseTime.AddDays(3))
            .Where(ts => ts.Tag == "companies/kitchenAppliances")
            .ToList());

    List<TimeSeriesRawResult> queryResults = query.ToList();
    
    TimeSeriesEntry[] tsEntries = queryResults[0].Results;
    
    double volumeDay1 = tsEntries[0].Values[4];
    double volumeDay2 = tsEntries[1].Values[4];
    double volumeDay3 = tsEntries[2].Values[4];
}
`}
</CodeBlock>
</TabItem>
<TabItem value="Named" label="Named">
<CodeBlock language="csharp">
{`using (var session = store.OpenSession())
{
    var query =
        session.Query<Company>()
        .Where(c => c.Address.City == "New York")
         // Use the StockPrice type in the time series query
        .Select(q => RavenQuery.TimeSeries<StockPrice>(q, "StockPrices", baseTime, baseTime.AddDays(3))
            .Where(ts => ts.Tag == "companies/kitchenAppliances")
            .ToList());

    List<TimeSeriesRawResult<StockPrice>> queryResults = query.ToList();
    
    var tsEntries = queryResults[0].Results;

    double volumeDay1 = tsEntries[0].Value.Volume;
    double volumeDay2 = tsEntries[1].Value.Volume;
    double volumeDay3 = tsEntries[2].Value.Volume;
}
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, we group heart-rate data of people above the age of 72 into 1-day groups,  
  and retrieve each group's average heart rate and number of measurements.  
  The aggregated results are retrieved as `List<TimeSeriesAggregationResult>`.
<TabItem value="something" label="ts_region_LINQ-6-Aggregation">
<CodeBlock language="csharp">
{`var query = session.Query<User>()
    .Where(u => u.Age > 72)
    .Select(q => RavenQuery.TimeSeries(q, "HeartRates", baseline, baseline.AddDays(10))
        .Where(ts => ts.Tag == "watches/fitbit")
        .GroupBy(g => g.Days(1))
        .Select(g => new
        \{
            Avg = g.Average(),
            Cnt = g.Count()
        \})
        .ToList());

List<TimeSeriesAggregationResult> result = query.ToList();
`}
</CodeBlock>
</TabItem>
### Query syntax

* The `session.Query` syntax is available [here](../../../../client-api/session/querying/how-to-query#syntax).

* To define a time series query use `RavenQuery.TimeSeries` within the query `Select` clause.

* `RavenQuery.TimeSeries` overloads:

<TabItem value="something" label="RavenQuery-TimeSeries-Definition-Without-Range">
<CodeBlock language="csharp">
{`public static ITimeSeriesQueryable TimeSeries(object documentInstance,
    string name)
`}
</CodeBlock>
</TabItem>
<TabItem value="something" label="RavenQuery-TimeSeries-Definition-With-Range">
<CodeBlock language="csharp">
{`public static ITimeSeriesQueryable TimeSeries(object documentInstance,
    string name, DateTime from, DateTime to)
`}
</CodeBlock>
</TabItem>

    | Parameter            | Type       | Description                             |
    |----------------------|------------|-----------------------------------------|
    | **documentInstance** | `object`   | Document Instance                       |
    | **name**             | `string`   | Time Series Name                        |
    | **from** (optional)  | `DateTime` | Range Start<br/> Default: `DateTime.Min` |
    | **to** (optional)    | `DateTime` | Range End<br/> Default: `DateTime.Max`   |

* `RavenQuery.TimeSeries` can be extended with the following time series methods:

<TabItem value="something" label="csharp">
<CodeBlock language="csharp">
{`Offset(TimeSpan offset);
Scale(double value);
FromLast(Action<ITimePeriodBuilder> timePeriod);
FromFirst(Action<ITimePeriodBuilder> timePeriod);
LoadByTag<TEntity>();
GroupBy(string s);
GroupBy(Action<ITimePeriodBuilder> timePeriod);
Where(Expression<Func<TimeSeriesEntry, bool>> predicate);
`}
</CodeBlock>
</TabItem>



## DocumentQuery

### DocumentQuery usage

* Open a session
* Call `session.Advanced.DocumentQuery`:
    * Extend the query using RavenDB's fluent API methods
    * Provide a `WhereEquals` query predicate to locate documents whose time series you want to query
    * Use `SelectTimeSeries` to choose a time series and project time series data
    * Execute the query
* Results will be in the form:
    * `TimeSeriesRawResult` for non-aggregated data, or -
    * `TimeSeriesAggregationResult` for aggregated data
* Note:  
  The RavenDB client translates query to [RQL](../../../../client-api/session/querying/what-is-rql) before transmitting it to the server for execution.
### DocumentQuery examples

* A _DocumentQuery_ using only the `From()` method.  
  The query returns all entries from the 'HeartRates' time series.
<TabItem value="something" label="TS_DocQuery_1">
<CodeBlock language="csharp">
{`// Define the query:
var query = session.Advanced.DocumentQuery<User>()
    .SelectTimeSeries(builder => builder
        .From("HeartRates")
         // 'ToList' must be applied here to the inner time series query definition
         // This will not trigger query execution at this point
        .ToList());

    
// Execute the query:
// The following call to 'ToList' will trigger query execution
List<TimeSeriesRawResult> results = query.ToList();
`}
</CodeBlock>
</TabItem>  

* A _DocumentQuery_ using `Between()`.  
  The query returns only entries from the specified time range.
<TabItem value="something" label="TS_DocQuery_2">
<CodeBlock language="csharp">
{`var query = session.Advanced.DocumentQuery<User>()
    .SelectTimeSeries(builder => builder
        .From("HeartRates")
        .Between(DateTime.Now, DateTime.Now.AddDays(1))
        .ToList());

List<TimeSeriesRawResult> results = query.ToList();
`}
</CodeBlock>
</TabItem>  

* A _DocumentQuery_ using `FromFirst()`.  
  The query returns the first three days of the 'HeartRates' time series.  
<TabItem value="something" label="TS_DocQuery_3">
<CodeBlock language="csharp">
{`var query = session.Advanced.DocumentQuery<User>()
    .SelectTimeSeries(builder => builder
        .From("HeartRates")
        .FromFirst(x => x.Days(3))
        .ToList());

List<TimeSeriesRawResult> results = query.ToList();
`}
</CodeBlock>
</TabItem>  

* A _DocumentQuery_ using `FromLast()`.  
  The query returns the last three days of the 'HeartRates' time series.  
<TabItem value="something" label="TS_DocQuery_4">
<CodeBlock language="csharp">
{`var query = session.Advanced.DocumentQuery<User>()
    .SelectTimeSeries(builder => builder
        .From("HeartRates")
        .FromLast(x => x.Days(3))
        .ToList());

List<TimeSeriesRawResult> results = query.ToList();
`}
</CodeBlock>
</TabItem>  

* A _DocumentQuery_ that loads the related `Monitor` documents that are specified in the time entries tags.  
  The results are then filtered by their content. 
<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="csharp">
{`var query = session.Advanced.DocumentQuery<User>()
    .SelectTimeSeries(builder => builder
        .From("HeartRates")
        .LoadByTag<Monitor>()
        .Where((entry, monitor) => entry.Value <= monitor.Accuracy)
        .ToList());

List<TimeSeriesRawResult> results = query.ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Class" label="Class">
<CodeBlock language="csharp">
{`public class Monitor
{
    public double Accuracy { get; set; }
}
`}
</CodeBlock>
</TabItem>
</Tabs>
### DocumentQuery syntax

The session [DocumentQuery](../../../../client-api/session/querying/document-query/what-is-document-query),
which is accessible from `session.Advanced`, can be extended with several useful time series methods.
To access these methods, begin with method `SelectTimeSeries()`:

<TabItem value="something" label="csharp">
<CodeBlock language="csharp">
{`IDocumentQuery SelectTimeSeries(Func<ITimeSeriesQueryBuilder, TTimeSeries> timeSeriesQuery);
`}
</CodeBlock>
</TabItem>

`SelectTimeSeries()` takes an `ITimeSeriesQueryBuilder`. The builder has the following methods:

<TabItem value="something" label="csharp">
<CodeBlock language="csharp">
{`From(string name);
Between(DateTime start, DateTime end);
FromLast(Action<ITimePeriodBuilder> timePeriod);
FromFirst(Action<ITimePeriodBuilder> timePeriod);
LoadByTag<TTag>();
//LoadByTag is extended by a special version of Where():
Where(Expression<Func<TimeSeriesEntry, TTag, bool>> predicate);
`}
</CodeBlock>
</TabItem>

| Parameter                  | Type                                            | Description                                                                                                                                                               |
|----------------------------|-------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **name**                   | `string`                                        | The name of the time series (in one or more documents) to query                                                                                                           |
| **start**                  | `DateTime`                                      | First parameter for `Between()`.<br/>The beginning of the time series range to filter.                                                                                     |
| **end**                    | `DateTime`                                      | Second parameter for `Between()`.<br/>The end of the time series range to filter.                                                                                          |
| **timePeriod**             | `Action<ITimePeriodBuilder>`                    | Expression returning a number of time units representing a time series range either at the beginning or end of the queried time series.                                   |
| `LoadByTag` type parameter | `TTag`                                          | Time series entry tags can be just strings, but they can also be document IDs, representing a reference to a related document. `LoadByTag` takes the type of the entity. |
| **predicate**              | `Expression<Func<TimeSeriesEntry, TTag, bool>>` |

`FromLast()` and `FromFirst()` take an `ITimePeriodBuilder`, which is used to represent a range of time from milliseconds to years:

<TabItem value="something" label="csharp">
<CodeBlock language="csharp">
{`public interface ITimePeriodBuilder
\{
    Milliseconds(int duration);
    Seconds(int duration);
    Minutes(int duration);
    Hours(int duration);
    Days(int duration);
    Months(int duration);
    Quarters(int duration);
    Years(int duration);
\}
`}
</CodeBlock>
</TabItem>

#### Return Value:

* **`List<TimeSeriesAggregationResult>`**  for aggregated data.  
  When the query [aggregates time series entries](../../../../document-extensions/timeseries/querying/aggregation-and-projections),
  the results are returned in an aggregated array.

* **`List<TimeSeriesRawResult>`** for non-aggregated data.  
  When the query doesn't aggregate time series entries, the results are returned in a list of time series results.



## RawQuery

### RawQuery usage

* Open a session  
* Call `session.Advanced.RawQuery`, pass it the raw RQL that will be sent to the server 
* Results will be in the form:  
   * `TimeSeriesRawResult` for non-aggregated data, or -
   * `TimeSeriesAggregationResult` for aggregated data
* Note:  
  The raw query transmits the provided RQL to the server as is, without checking or altering its content.
### RawQuery examples

* In this example, we retrieve all HearRates time series for all users under 30.
<Tabs groupId='languageSyntax'>
<TabItem value="RawQuery" label="RawQuery">
<CodeBlock language="csharp">
{`// Raw query with no aggregation - Select syntax
var query = session.Advanced.RawQuery<TimeSeriesRawResult>(@"
        from Users where Age < 30
        select timeseries (
            from HeartRates
        )");

List<TimeSeriesRawResult> results = query.ToList();
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, a raw RQL query retrieves 24 hours of heart rate data from users under the age of 30.  
  The query does not aggregate data, so results are in the form of a `TimeSeriesRawResult` list.  
  We define an **offset**, to adjust retrieved results to the client's local time-zone.
<Tabs groupId='languageSyntax'>
<TabItem value="Declare-Syntax" label="Declare-Syntax">
<CodeBlock language="csharp">
{`var baseTime = new DateTime(2020, 5, 17, 00, 00, 00); // May 17 2020, 00:00:00

// Raw query with no aggregation - Declare syntax
var query =
    session.Advanced.RawQuery<TimeSeriesRawResult>(@"
        declare timeseries getHeartRates(user) 
        {
            from user.HeartRates 
                between $from and $to
                offset '02:00'
        }
        from Users as u where Age < 30
        select getHeartRates(u)
        ")
    .AddParameter("from", baseTime)
    .AddParameter("to", baseTime.AddHours(24));

List<TimeSeriesRawResult> results = query.ToList();
`}
</CodeBlock>
</TabItem>
<TabItem value="Select-Syntax" label="Select-Syntax">
<CodeBlock language="csharp">
{`var baseline = new DateTime(2020, 5, 17, 00, 00, 00); // May 17 2020, 00:00:00

// Raw query with no aggregation - Select syntax
var query =
    session.Advanced.RawQuery<TimeSeriesRawResult>(@"
        from Users as u where Age < 30
        select timeseries (
            from HeartRates 
                between $from and $to
                offset '02:00'
        )")
    .AddParameter("from", baseline)
    .AddParameter("to", baseline.AddHours(24));

var results = query.ToList();
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, the query aggregates 7 days of HeartRates entries into 1-day groups.  
  From each group, two values are selected and projected to the client:  
  the **min** and **max** hourly HeartRates values.  
  The aggregated results are in the form of a `TimeSeriesAggregationResult` list.
<TabItem value="something" label="ts_region_Raw-Query-Aggregated">
<CodeBlock language="csharp">
{`var baseline = new DateTime(2020, 5, 17, 00, 00, 00); // May 17 2020, 00:00:00

// Raw Query with aggregation
var query =
    session.Advanced.RawQuery<TimeSeriesAggregationResult>(@"
        from Users as u
        select timeseries(
            from HeartRates 
                between $start and $end
            group by '1 days'
            select min(), max()
            offset '03:00')
        ")
        .AddParameter("start", baseline)
        .AddParameter("end", baseline.AddDays(7));

List<TimeSeriesAggregationResult> results = query.ToList();
`}
</CodeBlock>
</TabItem>
### RawQuery syntax

<TabItem value="something" label="RawQuery-definition">
<CodeBlock language="csharp">
{`IRawDocumentQuery<T> RawQuery<T>(string query);
`}
</CodeBlock>
</TabItem>

| Parameter  | Type     | Description          |
|------------|----------|----------------------|
|  **query** | `string` | The RQL query string |

**Return Value**:

* **`List<TimeSeriesAggregationResult>`**  for aggregated data.  
  When the query [aggregates time series entries](../../../../document-extensions/timeseries/querying/aggregation-and-projections),
  the results are returned in an aggregated array.

* **`List<TimeSeriesRawResult>`** for non-aggregated data.  
  When the query doesn't aggregate time series entries, the results are returned in a list of time series results.




</LanguageContent>
<LanguageContent language="nodejs">

<Admonition type="note" title="Note">

* Time series data can be effectively queried in RavenDB, 
  allowing users to access and analyze information based on specific time intervals.
  
* Time series queries can be made using:  
  * The `query` method 
  * Or directly through [RQL](../../../../client-api/session/querying/what-is-rql),
    which can be provided to a `rawQuery` or executed from the Studio's [Query view](../../../../studio/database/queries/query-view).

* In this page:  
    * [Query](../../../../document-extensions/timeseries/client-api/session/querying#query)
        * [Query usage](../../../../document-extensions/timeseries/client-api/session/querying#query-usage)
        * [Query examples](../../../../document-extensions/timeseries/client-api/session/querying#query-examples)  
        * [Query syntax](../../../../document-extensions/timeseries/client-api/session/querying#query-syntax)
    * [RawQuery](../../../../document-extensions/timeseries/client-api/session/querying#rawquery)
        * [RawQuery usage](../../../../document-extensions/timeseries/client-api/session/querying#rawquery-usage)
        * [RawQuery examples](../../../../document-extensions/timeseries/client-api/session/querying#rawquery-examples)
        * [RawQuery syntax](../../../../document-extensions/timeseries/client-api/session/querying#rawquery-syntax)
    
</Admonition>

<Admonition type="info" title="Info">
Learn more about time series queries in the [section dedicated to this subject](../../../../document-extensions/timeseries/querying/overview-and-syntax).  
</Admonition>
## Query

### Query usage

* Open a session  
* Call `session.query`:
  * Provide a query predicate to locate documents whose time series you want to query  
  * Use `selectTimeSeries` to choose a time series and project time series data
  * Execute the query
* Results will be in the form:
  * `TimeSeriesRawResult` for non-aggregated data, or -  
  * `TimeSeriesAggregationResult` for aggregated data  
* Note:  
  The RavenDB client translates the query to [RQL](../../../../client-api/session/querying/what-is-rql) before transmitting it to the server for execution.
### Query examples

* This query filters users by their age and retrieves their HeartRates time series.
<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="nodejs">
{`// Define the time series query part (expressed in RQL):
const tsQueryText = \`
    from HeartRates
    where Tag == "watches/fitbit"\`;

// Define the high-level query:
const query = session.query({ collection: "users" })
    .whereLessThan("age", 30)
     // Call 'selectTimeSeries' and pass it:
     // * the time series query text
     // * the \`TimeSeriesRawResult\` return type
    .selectTimeSeries(b => b.raw(tsQueryText), TimeSeriesRawResult);

// Execute the query:
const results = await query.all();

// Access entries results:
rawResults = results[0];
assert.equal((rawResults instanceof TimeSeriesRawResult), true);

const tsEntry = rawResults.results[0];
assert.equal((tsEntry instanceof TimeSeriesEntry), true);

const tsValue = tsEntry.value;
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "users"
where age < 30
select timeseries(
    from "HeartRates"
    where Tag == "watches/fitbit"
)
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, we select a 5-minute range from the HeartRates time series.  
<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="nodejs">
{`const startTime = new Date();
const endTime = new Date(startTime.getTime() + 5 * 60_000);

// Define the time series query text:
const tsQueryText = \`
    from HeartRates
    between $start and $end\`;

// Define the query:
const query = session.query({ collection: "users" })
     // Call 'selectTimeSeries' and pass it:
     // * the time series query text
     // * the \`TimeSeriesRawResult\` return type
    .selectTimeSeries(b => b.raw(tsQueryText), TimeSeriesRawResult)
     // Add the parameters content
    .addParameter("start", startTime)
    .addParameter("end", endTime);

// Execute the query:
const results = await query.all();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Users"
select timeseries(
    from "HeartRates"
    between "2024-05-19T18:13:17.466Z" and "2024-05-19T18:18:17.466Z"
)
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, we retrieve a company's stock trade data.  
  Note the usage of named values, so we may address trade Volume [by name](../../../../document-extensions/timeseries/client-api/named-time-series-values).  
  This example is based on the sample entries that were entered in [this example](../../../../document-extensions/timeseries/client-api/session/append#append-entries-with-multiple-values).  
<Tabs groupId='languageSyntax'>
<TabItem value="Native" label="Native">
<CodeBlock language="nodejs">
{`const oneDay = 24 * 60 * 60 * 1000;
const startTime = new Date();
const endTime = new Date(startTime.getTime() + 3 * oneDay);

// Note: the 'where' clause must come after the 'between' clause
const tsQueryText = \`
    from StockPrices
    between $start and $end
    where Tag == "AppleTech"\`;

const query = session.query({ collection: "companies" })
    .whereEquals("address.city", "New York")
    .selectTimeSeries(b => b.raw(tsQueryText), TimeSeriesRawResult)
    .addParameter("start", startTime)
    .addParameter("end", endTime);

// Execute the query:
const results = await query.all();

// Access entries results:
const tsEntries = results[0].results;

const volumeDay1 = tsEntries[0].values[4];
const volumeDay2 = tsEntries[1].values[4];
const volumeDay3 = tsEntries[2].values[4];
`}
</CodeBlock>
</TabItem>
<TabItem value="Named" label="Named">
<CodeBlock language="nodejs">
{`const oneDay = 24 * 60 * 60 * 1000;
const startTime = new Date();
const endTime = new Date(startTime.getTime() + 3 * oneDay);

// Note: the 'where' clause must come after the 'between' clause
const tsQueryText = \`
    from StockPrices
    between $start and $end
    where Tag == "AppleTech"\`;

const query = session.query({ collection: "companies" })
    .whereEquals("address.city", "New York")
    .selectTimeSeries(b => b.raw(tsQueryText), TimeSeriesRawResult)
    .addParameter("start", startTime)
    .addParameter("end", endTime);

// Execute the query:
const results = await query.all();

// Access entries results:
const tsEntries = results[0].results;

// Call 'asTypedEntry' to be able to access the entry's values by their names
// Pass the class type (StockPrice)
const volumeDay1 = tsEntries[0].asTypedEntry(StockPrice).value.volume;
const volumeDay2 = tsEntries[1].asTypedEntry(StockPrice).value.volume;
const volumeDay3 = tsEntries[2].asTypedEntry(StockPrice).value.volume;
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "companies"
where address.city == "New York"
select timeseries(
    from StockPrices
    between $start and $end
    where Tag == "AppleTech"
)
{"start":"2024-05-20T07:54:07.259Z","end":"2024-05-23T07:54:07.259Z"}
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, we group heart-rate data of people above the age of 72 into 1-day groups,
  For each group, we retrieve the number of measurements, the minimum, maximum, and average heart rate.
<Tabs groupId='languageSyntax'>
<TabItem value="Native" label="Native">
<CodeBlock language="nodejs">
{`const oneDay = 24 * 60 * 60 * 1000;
const startTime = new Date();
const endTime = new Date(startTime.getTime() + 10 * oneDay);

const tsQueryText = \`from HeartRates between $start and $end
    where Tag == "watches/fitbit"
    group by "1 day"
    select count(), min(), max(), avg()\`;

const query = session.query({ collection: "users" })
    .whereGreaterThan("age", 72)
     // Call 'selectTimeSeries' and pass it:
     // * the time series query text
     // * the \`TimeSeriesAggregationResult\` return type
    .selectTimeSeries(b => b.raw(tsQueryText), TimeSeriesAggregationResult)
    .addParameter("start", startTime)
    .addParameter("end", endTime);

// Execute the query:
const results = await query.all();
const aggregatedResults = results[0].results;

const averageForDay1 = aggregatedResults[0].average[0];
const averageForDay2 = aggregatedResults[1].average[0];
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "users"
where age > 72
select timeseries(
    from HeartRates between $start and $end
    where Tag == "watches/fitbit"
    group by '1 day'
    select count(), min(), max(), avg()
)
{"start":"2024-05-20T09:32:58.951Z","end":"2024-05-30T09:32:58.951Z"}
`}
</CodeBlock>
</TabItem>
</Tabs>
### Query syntax

The `session.query` syntax is available [here](../../../../client-api/session/querying/how-to-query#syntax).

Extend the `session.query` method with `selectTimeSeries()`.

<TabItem value="something-something" label="syntax_1">
<CodeBlock language="nodejs">
{`selectTimeSeries(timeSeriesQuery, projectionClass);
`}
</CodeBlock>
</TabItem>

| Parameter             | Type                | Description                                                                     |
|-----------------------|---------------------|---------------------------------------------------------------------------------|
| **timeSeriesQuery**   | `(builder) => void` | The time series query builder                                                   |
| **projectionClass**   | `object`            | The query result type<br/>`TimeSeriesRawResult` or `TimeSeriesAggregationResult` |

The time series query builder has one method:

<TabItem value="something-something" label="syntax_2">
<CodeBlock language="nodejs">
{`raw(queryText);
`}
</CodeBlock>
</TabItem>

| Parameter      | Type     | Description                                   |
|----------------|----------|-----------------------------------------------|
| **queryText**  | `string` | The time series query part, expressed in RQL. |

| Return value                    | Description                                                                                                               |
|---------------------------------|---------------------------------------------------------------------------------------------------------------------------|
| `TimeSeriesRawResult[]`         | The returned value for non-aggregated data                                                                                |
| `TimeSeriesAggregationResult[]` | The returned value for [aggregated data](../../../../document-extensions/timeseries/querying/aggregation-and-projections) |

<TabItem value="something-something" label="syntax_3">
<CodeBlock language="nodejs">
{`class TimeSeriesRawResult \{
    results; // TimeSeriesEntry[]
    asTypedResult>(clazz);
\}

class TimeSeriesAggregationResult extends TimeSeriesQueryResult \{
    results; // TimeSeriesRangeAggregation[];
    asTypedEntry(clazz);
\}
`}
</CodeBlock>
</TabItem>



## RawQuery

### RawQuery usage

* Open a session  
* Call `session.advanced.rawQuery`, pass it the raw RQL that will be sent to the server 
* Results will be in the form:  
    * `TimeSeriesRawResult` for non-aggregated data, or -
    * `TimeSeriesAggregationResult` for aggregated data
* Note:  
  The raw query transmits the provided RQL to the server as is, without checking or altering its content.
### RawQuery examples

* In this example, we retrieve all HearRates time series for all users under 30.
<Tabs groupId='languageSyntax'>
<TabItem value="RawQuery" label="RawQuery">
<CodeBlock language="nodejs">
{`const rql = \`from users where age < 30
     select timeseries(
        from HeartRates
     )\`;

const query = session.advanced.rawQuery(rql, TimeSeriesRawResult);

const result = await query.all();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from users where age < 30
select timeseries(
    from HeartRates
)
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, a raw RQL query retrieves 24 hours of heart rate data from users under 30.  
  The query does not aggregate data, so results are in the form of a `TimeSeriesRawResult` list.  
  We define an **offset**, to adjust retrieved results to the client's local time-zone.
<Tabs groupId='languageSyntax'>
<TabItem value="Declare-Syntax" label="Declare-Syntax">
<CodeBlock language="nodejs">
{`const rql = \`
    declare timeseries getHeartRates(user) 
    {
        from user.HeartRates 
            between $start and $end
            offset "03:00"
    }
    
    from users as u where age < 30
    select getHeartRates(u)\`;

const startTime = new Date();
const endTime = new Date(startTime.getTime() + 24 * 60 * 60 * 1000);

const query = session.advanced.rawQuery(rql, TimeSeriesRawResult)
    .addParameter("start", startTime)
    .addParameter("end", endTime);

const result = await query.all();
`}
</CodeBlock>
</TabItem>
<TabItem value="Select-Syntax" label="Select-Syntax">
<CodeBlock language="nodejs">
{`const rql = \`
    from Users as u where Age < 30
    select timeseries (
        from HeartRates 
            between $start and $end
            offset "03:00"
    )\`;

const startTime = new Date();
const endTime = new Date(startTime.getTime() + 24 * 60 * 60 * 1000);

const query = session.advanced.rawQuery(rql, TimeSeriesRawResult)
    .addParameter("start", startTime)
    .addParameter("end", endTime);

const result = await query.all();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`// declare syntax
// ==============

declare timeseries getHeartRates(user)
{
    from user.HeartRates
    between $start and $end
    offset '03:00'
}

from users as u where age < 30
select getHeartRates(u)
{"start":"2024-05-20T11:52:22.316Z","end":"2024-05-21T11:52:22.316Z"}

// select syntax
// =============

from Users as u where Age < 30
select timeseries (
    from HeartRates 
        between $start and $end
        offset "03:00"
)
{"start":"2024-05-20T11:55:56.701Z","end":"2024-05-21T11:55:56.701Z"}
`}
</CodeBlock>
</TabItem>
</Tabs>

* In this example, the query aggregates 7 days of HeartRates entries into 1-day groups.  
  From each group, two values are selected and projected to the client:  
  the **min** and **max** hourly HeartRates values.  
  The aggregated results are in the form of a `TimeSeriesAggregationResult` list.
<Tabs groupId='languageSyntax'>
<TabItem value="RawQuery" label="RawQuery">
<CodeBlock language="nodejs">
{`const rql = \`
    from users as u
    select timeseries(
        from HeartRates between $start and $end
        group by '1 day'
        select min(), max()
        offset "03:00"
    )\`;

const oneDay = 24 * 60 * 60 * 1000;
const startTime = new Date();
const endTime = new Date(startTime.getTime() + 7 * oneDay);

const query = session.advanced.rawQuery(rql, TimeSeriesRawResult)
    .addParameter("start", startTime)
    .addParameter("end", endTime);

const result = await query.all();
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from users as u
select timeseries(
    from HeartRates between $start and $end
    group by '1 day'
    select min(), max()
    offset "03:00"
)
{"start":"2024-05-20T12:06:40.595Z","end":"2024-05-27T12:06:40.595Z"}
`}
</CodeBlock>
</TabItem>
</Tabs>
### RawQuery syntax

<TabItem value="something-something" label="syntax_4">
<CodeBlock language="nodejs">
{`session.rawQuery(query);
`}
</CodeBlock>
</TabItem>

| Parameter  | Type     | Description          |
|------------|----------|----------------------|
|  **query** | `string` | The RQL query string |

The return value is the same as listed under the [query syntax](../../../../document-extensions/timeseries/client-api/session/querying#query-syntax).




</LanguageContent>