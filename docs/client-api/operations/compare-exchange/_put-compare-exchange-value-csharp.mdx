import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* Use `PutCompareExchangeValueOperation` to save a compare-exchange _Value_ for the specified _Key_.  

* Create a new _Key_ or modify an existing one.  

* The _Value_ is saved only if the passed _index_ is equal to the _index_ currently stored in the server for the specified _Key_.  

* Creating a new compare exchange item is possible only when the passed _index_ is `0`.  
  
* For an overview of the 'Compare Exchange' feature see: [Compare Exchange Overview](../../../client-api/operations/compare-exchange/overview.mdx).

* In this page:  
  * [Syntax](../../../client-api/operations/compare-exchange/put-compare-exchange-value.mdx#syntax)  
  * [Example I - Create a new key](../../../client-api/operations/compare-exchange/put-compare-exchange-value.mdx#example-i---create-a-new-key)  
  * [Example II - Update an existing key](../../../client-api/operations/compare-exchange/put-compare-exchange-value.mdx#example-ii---update-an-existing-key)  
  * [Example III - Try to create an item with a non-zero index](../../../client-api/operations/compare-exchange/put-compare-exchange-value.mdx#example-iii---try-to-create-an-item-with-a-non-zero-index)  
  
</Admonition>
## Syntax

**Method**:
<TabItem value="put_0" label="put_0">
<CodeBlock language="csharp">
{`public PutCompareExchangeValueOperation(string key, T value, long index)
`}
</CodeBlock>
</TabItem>

| Parameter | Type     | Description                                                                                                                          |
|-----------|----------|--------------------------------------------------------------------------------------------------------------------------------------|
| **key**   | `string` | Object identifier under which _value_ is saved, unique in the database scope across the cluster. This string can be up to 512 bytes. |
| **value** | `T`      | The value to be saved for the specified _key_.                                                                                       |
| **index** | `long`   | * `0` if creating a new key <br/> * The current version of _Value_ when updating a value for an existing key.                        |

**Returned object**:
<TabItem value="compare_exchange_result" label="compare_exchange_result">
<CodeBlock language="csharp">
{`public class CompareExchangeResult<T>
\{
    public bool Successful;
    public T Value;
    public long Index;
\}
`}
</CodeBlock>
</TabItem>

| Return Value   | Type   | Description                                                                                                                            |
|----------------|--------|----------------------------------------------------------------------------------------------------------------------------------------|
| **Successful** | `bool` | * _True_ if the save operation has completed successfully <br/> * _False_ if the save operation failed                                 |
| **Value**      | `T`    | * The value that was saved if operation was successful <br/> * The currently existing value in the server upon failure                 |
| **Index**      | `long` | * The version number of the value that was saved upon success <br/> * The currently existing version number in the server upon failure |

<Admonition type="note" title="Note:" id="note" href="#note">
When calling the 'Put' operation, the index from the request is compared to the index that is currently stored in the server (compare stage).  
The value is updated only if the two are **equal** (exchange stage).  
</Admonition>


## Example I - Create a new key

<TabItem value="put_1" label="put_1">
<CodeBlock language="csharp">
{`CompareExchangeResult<string> compareExchangeResult
    = store.Operations.Send(
        new PutCompareExchangeValueOperation<string>("Emails/foo@example.org", "users/123", 0));

bool successful = compareExchangeResult.Successful;
// If successfull is true: then Key 'foo@example.org' now has the value of "users/123"
`}
</CodeBlock>
</TabItem>


## Example II - Update an existing key

<TabItem value="put_2" label="put_2">
<CodeBlock language="csharp">
{`// Get existing value
CompareExchangeValue<User> readResult =
    store.Operations.Send(
        new GetCompareExchangeValueOperation<User>("AdminUser"));

readResult.Value.Age++;

// Update value
CompareExchangeResult<User> saveResult
    = store.Operations.Send(
        new PutCompareExchangeValueOperation<User>("AdminUser", readResult.Value, readResult.Index));

// The save result is successful only if 'index' wasn't changed between the read and write operations
bool saveResultSuccessful = saveResult.Successful;
`}
</CodeBlock>
</TabItem>


## Example III - Try to create an item with a non-zero index

<TabItem value="put_3" label="put_3">
<CodeBlock language="csharp">
{`// Creating the item will fail because the index is not 0
CompareExchangeResult<string> compareExchangeResult
    = store.Operations.Send(
        new PutCompareExchangeValueOperation<string>("key", "value", 123));

// Creating the item will succeed because the index is 0
compareExchangeResult = store.Operations.Send(
        new PutCompareExchangeValueOperation<string>("key", "value", 0));
`}
</CodeBlock>
</TabItem>



