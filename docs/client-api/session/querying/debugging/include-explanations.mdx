---
title: "Include Query Explanations"
hide_table_of_contents: true
sidebar_label: Include Query Explanations
sidebar_position: 0
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["java", "csharp", "python", "php", "nodejs"];


# Include Query Explanations
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="java">


`includeExplanations` allows to investigate details related to score assigned for each query result.

<Admonition type="info" title="">

* Including explanations is available only when using **Lucene** as the underlying search engine.  
* You can configure which search engine will be used. Learn how in [Selecting the search engine](../../../../indexes/search-engine/corax.mdx#selecting-the-search-engine).

</Admonition>
## Syntax


<TabItem value="explain_1" label="explain_1">
<CodeBlock language="java">
{`IDocumentQuery<T> includeExplanations(Reference<Explanations> explanations);
`}
</CodeBlock>
</TabItem>

## Example

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="java">
{`Reference<Explanations> explanationRef = new Reference<>();
List<Product> syrups = session.advanced().documentQuery(Product.class)
    .includeExplanations(explanationRef)
    .search("Name", "Syrup")
    .toList();

String[] scoreDetails = explanationRef.value.getExplanations(syrups.get(0).getId());
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Products" 
where search(Name, "Syrup")
include explanations()
`}
</CodeBlock>
</TabItem>
</Tabs>

---
Sample explanation:

```
4.650658 = (MATCH) fieldWeight(search(Name):syrup in 2), product of:
  1 = tf(termFreq(search(Name):syrup)=1)
  4.650658 = idf(docFreq=1, maxDocs=77)
  1 = fieldNorm(field=search(Name), doc=2)
```

</LanguageContent>
<LanguageContent language="csharp">

<Admonition type="note" title="">

* When making a query, each document in the query results is assigned a **score**.  
  This score determines the order by which the documents come back in the results when requesting   
  to [order by score](../../../../client-api/session/querying/sort-query-results.mdx#order-by-score).

* Each document in the results includes this score under the `@index-score` property in its metadata.

* **To get the score details** and see how it was calculated,  
  use method `IncludeExplanations`, which is available in the [IDocumentQuery](../../../../client-api/session/querying/document-query/what-is-document-query.mdx) interface.

    <Admonition type="info" title="">
    * Including explanations is available only when using **Lucene** as the underlying search engine.  
    * You can configure which search engine will be used. Learn how in [Selecting the search engine](../../../../indexes/search-engine/corax.mdx#selecting-the-search-engine).
    </Admonition>
* This article provides examples of including explanations when making a **dynamic-query**.  
  For including explanations when querying a **static-index** see [Include explanations in index query](../../../../indexes/querying/include-explanations.mdx).

* In this page:
    * [Include explanations in a query](../../../../client-api/session/querying/debugging/include-explanations.mdx#include-explanations-in-a-query)  
    * [View explanations](../../../../client-api/session/querying/debugging/include-explanations.mdx#view-explanations)  
    * [Syntax](../../../../client-api/session/querying/debugging/include-explanations.mdx#syntax)  
</Admonition>
## Include explanations in a query

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="csharp">
{`var products = session
    .Query<Product>()
     // Convert the IRavenQueryable to IDocumentQuery
     // to be able to use 'IncludeExplanations'
    .ToDocumentQuery()
     // Call IncludeExplanations, provide an out param for the explanations results
    .IncludeExplanations(out Explanations explanations)
     // Convert back to IRavenQueryable
     // to continue building the query using LINQ
    .ToQueryable()
     // Define query criteria
     // e.g. search for docs containing Syrup -or- Lager in their Name field
    .Search(x => x.Name, "Syrup Lager")
     // Execute the query
    .ToList();

// Get the score details for a specific document from the results
// Call GetExplanations on the resulting Explanations object
string[] scoreDetails = explanations.GetExplanations(products[0].Id);
`}
</CodeBlock>
</TabItem>
<TabItem value="Query_async" label="Query_async">
<CodeBlock language="csharp">
{`var products = await asyncSession
    .Query<Product>()
     // Convert the IRavenQueryable to IDocumentQuery
     // to be able to use 'IncludeExplanations'
    .ToAsyncDocumentQuery()
     // Call IncludeExplanations, provide an out param for the explanations results
    .IncludeExplanations(out Explanations explanations)
     // Convert back to IRavenQueryable
     // to continue building the query using LINQ
    .ToQueryable()
     // Define query criteria
     // e.g. search for docs containing Syrup -or- Lager in their Name field
    .Search(x => x.Name, "Syrup Lager")
     // Execute the query
    .ToListAsync();

// Get the score details for a specific document from the results
// Call GetExplanations on the resulting Explanations object
string[] scoreDetails = explanations.GetExplanations(products[0].Id);
`}
</CodeBlock>
</TabItem>
<TabItem value="DocumentQuery" label="DocumentQuery">
<CodeBlock language="csharp">
{`// Query with \`DocumentQuery\`
var products = session.Advanced
    .DocumentQuery<Product>()
     // Call IncludeExplanations, provide an out param for the explanations results
    .IncludeExplanations(out Explanations explanations)
     // Define query criteria
     // e.g. search for docs containing Syrup -or- Lager in their Name field
    .Search(x => x.Name, "Syrup Lager")
     // Execute the query
    .ToList();

// Get the score details for a specific document from the results
// Call GetExplanations on the resulting Explanations object
string[] scoreDetails = explanations.GetExplanations(products[0].Id);
`}
</CodeBlock>
</TabItem>
<TabItem value="DocumentQuery_async" label="DocumentQuery_async">
<CodeBlock language="csharp">
{`// Query with \`AsyncDocumentQuery\`
var products = await asyncSession.Advanced
    .AsyncDocumentQuery<Product>()
     // Call IncludeExplanations, provide an out param for the explanations results
    .IncludeExplanations(out Explanations explanations)
     // Define query criteria
     // e.g. search for docs containing Syrup -or- Lager in their Name field
    .Search(x => x.Name, "Syrup Lager")
     // Execute the query
    .ToListAsync();

// Get the score details for a specific document from the results
// Call GetExplanations on the resulting Explanations object
string[] scoreDetails = explanations.GetExplanations(products[0].Id);
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Products"
where search(Name, "Syrup") or search(Name, "Lager")
include explanations()
`}
</CodeBlock>
</TabItem>
</Tabs>



## View explanations

* The detailed explanations can be viewed from the **Query view** in Studio.  

* Running a query with `include explanations()` will show an additional **Explanations Tab**.

![Figure 1. Explanations in the Studio](./assets/include-explanations-1.png)

* Sample score details:

![Figure 2. View explanations](./assets/include-explanations-2.png)



## Syntax

<TabItem value="syntax" label="syntax">
<CodeBlock language="csharp">
{`IDocumentQuery<T> IncludeExplanations(out Explanations explanations);
`}
</CodeBlock>
</TabItem>

| Parameter        | Type           | Description                                                      |
|------------------|----------------|------------------------------------------------------------------|
| **explanations** | `Explanations` | An _out_ param that will be filled with the explanations results |

| `Explanations`                           |                                                                                                                                |
|------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| `string[] GetExplanations(string docId)` | &lt;ul&gt;&lt;li&gt;Pass the resulting document ID for which to get score details.&lt;/li&gt;&lt;li&gt;Returns a list with all explanations.&lt;/li&gt;&lt;/ul&gt; |



</LanguageContent>
<LanguageContent language="python">

<Admonition type="note" title="">

* When making a query, each document in the query results is assigned a **score**.  
  This score determines the order by which the documents come back in the results when requesting   
  to [order by score](../../../../client-api/session/querying/sort-query-results.mdx#order-by-score).

* Each document in the results includes this score under the `@index-score` property in its metadata.

* Use `include_explanations` to get the score details** and see how it was calculated.  

    <Admonition type="info" title="">
    * Including explanations is available only when using **Lucene** as the underlying search engine.
    * You can configure which search engine will be used. Learn how in [Selecting the search engine](../../../../indexes/search-engine/corax.mdx#selecting-the-search-engine).
    </Admonition>
* In this page:
    * [Include explanations in a query](../../../../client-api/session/querying/debugging/include-explanations.mdx#include-explanations-in-a-query)  
    * [View explanations](../../../../client-api/session/querying/debugging/include-explanations.mdx#view-explanations)  
    * [Syntax](../../../../client-api/session/querying/debugging/include-explanations.mdx#syntax)  

</Admonition>
## Include explanations in a query

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="python">
{`# Prepare a callback
explanations_results: Optional[Explanations] = None

def explanations_callback(explanations: Explanations):
    explanations_results = explanations

# Query with 'document_query'

# Execute the query
results = list(
    # Prepare a query
    session.advanced.document_query(object_type=Product)
    # Call include_expirations, provide an out param for the explanations results
    .include_explanations()
    # Define query criteria
    # i.e. search for docs containing Syrup -or- Lager in their Name field
    .search("Name", "Syrup Lager")
)

# Get the score details for a specific document from the results
# Get explanations from the resulting Explanations object
score_details = explanations_results.explanations[results[0].Id]
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Products"
where search(Name, "Syrup") or search(Name, "Lager")
include explanations()
`}
</CodeBlock>
</TabItem>
</Tabs>



## View explanations

* The detailed explanations can be viewed from the **Query view** in Studio.  

* Running a query with `include_explanations` will show an additional **Explanations Tab**.

![Figure 1. Explanations in the Studio](./assets/include-explanations-1.png)

* Sample score details:

![Figure 2. View explanations](./assets/include-explanations-2.png)



## Syntax

<TabItem value="syntax" label="syntax">
<CodeBlock language="python">
{`def include_explanations(
    self,
    options: Optional[ExplanationOptions] = None,
    explanations_callback: Callable[[Explanations], None] = None,
) -> DocumentQuery[_T]: ...
`}
</CodeBlock>
</TabItem>

| Parameter                 | Type                             | Description                                                                                                                                                                                                                             |
|---------------------------|----------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **explanations_callback** | `Callable[[Explanations], None]` | &lt;ul&gt;&lt;li&gt;A callback function (action) that takes `Explanations` as an argument. It will be called by the client with the resulting `Explanations`.&lt;/li&gt; &lt;li&gt;You can interact with resulting Explanations inside your callback.&lt;/li&gt;&lt;/ul&gt; |
| **options** (Optional)    | `ExplanationOptions`             | Can be a `group_key` string                                                                                                                                                                                                             |

| `Explanations`         |                                                                                                                                |
|------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| `Dict[str, List[str]]` | &lt;ul&gt;&lt;li&gt;Pass the resulting document ID for which to get score details.&lt;/li&gt;&lt;li&gt;Returns a list with all explanations.&lt;/li&gt;&lt;/ul&gt; |



</LanguageContent>
<LanguageContent language="php">

<Admonition type="note" title="">

* When making a query, each document in the query results is assigned a **score**.  
  This score determines the order by which the documents come back in the results when requesting   
  to [order by score](../../../../client-api/session/querying/sort-query-results.mdx#order-by-score).

* Each document in the results includes this score under the `@index-score` property in its metadata.

* Use `includeExplanations` to get the score details and see how it was calculated.  

    <Admonition type="info" title="">
    * Including explanations is available only when using **Lucene** as the underlying search engine.
    * You can configure which search engine will be used. Learn how in [Selecting the search engine](../../../../indexes/search-engine/corax.mdx#selecting-the-search-engine).
    </Admonition>
* In this page:
    * [Include explanations in a query](../../../../client-api/session/querying/debugging/include-explanations.mdx#include-explanations-in-a-query)  
    * [View explanations](../../../../client-api/session/querying/debugging/include-explanations.mdx#view-explanations)  
    * [Syntax](../../../../client-api/session/querying/debugging/include-explanations.mdx#syntax)  
</Admonition>
## Include explanations in a query

<Tabs groupId='languageSyntax'>
<TabItem value="query" label="query">
<CodeBlock language="php">
{`$explanations = new Explanations();

/** @var array<Product> $syrups */
$syrups = $session->advanced()->documentQuery(Product::class)
    ->includeExplanations(null, $explanations)
    ->search("Name", "Syrup")
    ->toList();

$scoreDetails = $explanations->getExplanations($syrups[0]->getId());
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Products"
where search(Name, "Syrup") or search(Name, "Lager")
include explanations()
`}
</CodeBlock>
</TabItem>
</Tabs>

<Admonition type="note" title="">
Please note that the First parameter is optional.  
If you intend to use the default options, just paste `null` instead of the options object.  
</Admonition>



## View explanations

* The detailed explanations can be viewed from the **Query view** in Studio.  

* Running a query with `includeExplanations` will show an additional **Explanations Tab**.

![Figure 1. Explanations in the Studio](./assets/include-explanations-1.png)

* Sample score details:

![Figure 2. View explanations](./assets/include-explanations-2.png)



## Syntax

<TabItem value="syntax" label="syntax">
<CodeBlock language="php">
{`public function includeExplanations(?ExplanationOptions $options, Explanations &$explanations): DocumentQueryInterface;
`}
</CodeBlock>
</TabItem>

| Parameter          | Type                  | Description                                                                                                                                                                                                                             |
|--------------------|-----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **$options**       | `?ExplanationOptions` | This object is optional.<br/>If you intend to use the default options, place `null` here.                                                                                                                                                |
| **&$explanations** | `Explanations`        | &lt;ul&gt;&lt;li&gt;A callback function (action) that takes `Explanations` as an argument. It will be called by the client with the resulting `Explanations`.&lt;/li&gt; &lt;li&gt;You can interact with resulting Explanations inside your callback.&lt;/li&gt;&lt;/ul&gt; |



</LanguageContent>
<LanguageContent language="nodejs">

<Admonition type="note" title="">

* When making a query, each document in the query results is assigned a **score**.  
  This score determines the order by which the documents come back in the results when requesting   
  to [order by score](../../../../client-api/session/querying/sort-query-results.mdx#order-by-score).

* Each document in the results includes this score under the `@index-score` property in its metadata.

* Use `includeExplanations` in your query **to get the score details** and see how it was calculated.  

    <Admonition type="info" title="">
    * Including explanations is available only when using **Lucene** as the underlying search engine.
    * You can configure which search engine will be used. Learn how in [Selecting the search engine](../../../../indexes/search-engine/corax.mdx#selecting-the-search-engine).
    </Admonition>
* This article provides examples of including explanations when making a **dynamic-query**.  
  For including explanations when querying a **static-index** see [Include explanations in index query](../../../../indexes/querying/include-explanations.mdx).

* In this page:
    * [Include explanations in a query](../../../../client-api/session/querying/debugging/include-explanations.mdx#include-explanations-in-a-query)  
    * [View explanations](../../../../client-api/session/querying/debugging/include-explanations.mdx#view-explanations)  
    * [Syntax](../../../../client-api/session/querying/debugging/include-explanations.mdx#syntax)  
</Admonition>
## Include explanations in a query

<Tabs groupId='languageSyntax'>
<TabItem value="Query" label="Query">
<CodeBlock language="js">
{`// Define an object that will receive the explanations results
let explanationsResults;

const products = await session.query({ collection: "Products" })
     // Call includeExplanations, pass a callback function
     // Output param 'explanationsResults' will be filled with explanations results when query returns 
    .includeExplanations(e => explanationsResults = e)
     // Define query criteria
     // i.e. search for docs containing Syrup -or- Lager in their Name field
    .search("Name", "Syrup Lager")
     // Execute the query
    .all();

// Get the score details for a specific document from 'explanationsResults'
const id = session.advanced.getDocumentId(products[0]);
const scoreDetails = explanationsResults.explanations[id];
`}
</CodeBlock>
</TabItem>
<TabItem value="RQL" label="RQL">
<CodeBlock language="sql">
{`from "Products"
where search(Name, "Syrup") or search(Name, "Lager")
include explanations()
`}
</CodeBlock>
</TabItem>
</Tabs>



## View explanations

* The detailed explanations can be viewed from the **Query view** in Studio.  
* Running a query with `include explanations()` will show an additional **Explanations Tab**.

![Figure 1. Explanations in the Studio](./assets/include-explanations-1.png)

* Sample score details:

![Figure 2. View explanations](./assets/include-explanations-2.png)



## Syntax

<TabItem value="syntax" label="syntax">
<CodeBlock language="js">
{`query.includeExplanations(explanationsCallback)
`}
</CodeBlock>
</TabItem>

| Parameter                | Type                            | Description                                                                                                                                                                    |
|--------------------------|---------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **explanationsCallback** | `(explanationsResults) => void` | &lt;ul&gt;&lt;li&gt;A callback function with an output parameter.&lt;/li&gt;&lt;li&gt;The parameter passed to the callback will be filled with the `Explanations` object when query returns.&lt;/li&gt;&lt;/ul&gt; |

<TabItem value="syntax_2" label="syntax_2">
<CodeBlock language="js">
{`// The Explanations object:
// ========================

class Explanations \{
    get explanations(): \{
        [key: string]: string[]; // An explanations list per document ID key
    \};
\}
`}
</CodeBlock>
</TabItem>



</LanguageContent>

<!---

-->