---
title: "Session: Subscribing to Session Events"
hide_table_of_contents: true
sidebar_label: ...subscribe to events
sidebar_position: 5
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "java", "nodejs"];


# Session: Subscribing to Session Events
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">

<Admonition type="note" title="">

* **Events** allow users to perform custom actions in response to operations made in 
  a `Document Store` or a `Session`.  

* An event is invoked when the selected action is executed on an entity, or querying is performed.  

* Subscribing to an event within a `Session` is valid only for this session.  
  
     E.g., to invoke an event after SaveChanges() is called by **this session** only, use -  
     `session.Advanced.OnAfterSaveChanges += OnAfterSaveChangesEvent;`

* Subscribing to an event at the `DocumentStore` level subscribes to this 
  event in all subsequent sessions.  
  
      E.g., to invoke an event after SaveChanges() is called by **any subsequent session**, use -  
      `store.OnAfterSaveChanges += OnAfterSaveChangesEvent;`

      Read more about `DocumentStore` events [here](../../../client-api/how-to/subscribe-to-store-events.mdx).  

* In this Page:  
   * [OnBeforeStore](../../../client-api/session/how-to/subscribe-to-events.mdx#onbeforestore)  
   * [OnBeforeDelete](../../../client-api/session/how-to/subscribe-to-events.mdx#onbeforedelete)  
   * [OnAfterSaveChanges](../../../client-api/session/how-to/subscribe-to-events.mdx#onaftersavechanges)  
   * [OnBeforeQuery](../../../client-api/session/how-to/subscribe-to-events.mdx#onbeforequery)  
   * [OnBeforeConversionToDocument](../../../client-api/session/how-to/subscribe-to-events.mdx#onbeforeconversiontodocument)  
   * [OnAfterConversionToDocument](../../../client-api/session/how-to/subscribe-to-events.mdx#onafterconversiontodocument)  
   * [OnBeforeConversionToEntity](../../../client-api/session/how-to/subscribe-to-events.mdx#onbeforeconversiontoentity)  
   * [OnAfterConversionToEntity](../../../client-api/session/how-to/subscribe-to-events.mdx#onafterconversiontoentity)  
   * [OnSessionDisposing](../../../client-api/session/how-to/subscribe-to-events.mdx#onsessiondisposing)  

</Admonition>

## OnBeforeStore

This event is invoked as a part of `SaveChanges` but before it is actually sent to the server.  
It should be defined with this signature:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`private void OnBeforeStoreEvent(object sender, BeforeStoreEventArgs args);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **sender** | `IDocumentSession` | The session on which `SaveChanges()` has been called, triggering this event |
| **args** | `BeforeStoreEventArgs` | `args` contains the session on which `SaveChanges()` has been called, the ID of the document being Stored, the document's metadata, and the document itself. |

The class `BeforeStoreEventArgs`:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`public class BeforeStoreEventArgs
\{
    public InMemoryDocumentSessionOperations Session;
    public string DocumentId;
    public object Entity;
    public IMetadataDictionary DocumentMetadata;
\}
`}
</CodeBlock>
</TabItem>

### Example

Say we want to discontinue all of the products that are not in stock.  

<TabItem value="on_before_store_event" label="on_before_store_event">
<CodeBlock language="csharp">
{`private void OnBeforeStoreEvent(object sender, BeforeStoreEventArgs args)
\{
    var product = args.Entity as Product;
    if (product?.UnitsInStock == 0)
    \{
        product.Discontinued = true;
    \}
\}
`}
</CodeBlock>
</TabItem>

After we subscribe to the event, every stored entity will invoke the method.  

<TabItem value="store_session" label="store_session">
<CodeBlock language="csharp">
{`// Subscribe to the event
session.Advanced.OnBeforeStore += OnBeforeStoreEvent;

session.Store(new Product
\{
    Name = "RavenDB v3.5",
    UnitsInStock = 0
\});
session.Store(new Product
\{
    Name = "RavenDB v4.0",
    UnitsInStock = 1000
\});

session.SaveChanges(); // Here the method is invoked
`}
</CodeBlock>
</TabItem>



## OnBeforeDelete

This event is invoked by `Delete(id)` or `Delete(entity)`. It is only executed when `SaveChanges()` 
is called, but before the commands are actually sent to the server.  
It should be defined with this signature:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`private void OnBeforeDeleteEvent(object sender, BeforeDeleteEventArgs args);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **sender** | `IDocumentSession` | The session on which `SaveChanges()` has been called, triggering this event |
| **args** | `BeforeDeleteEventArgs` | `args` contains the session on which `SaveChanges()` has been called, the ID of the document being deleted, the document's metadata, and the document itself. |

The class `BeforeDeleteEventArgs`:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`public class BeforeDeleteEventArgs
\{
    public InMemoryDocumentSessionOperations Session;
    public string DocumentId;
    public object Entity;
    public IMetadataDictionary DocumentMetadata;
\}
`}
</CodeBlock>
</TabItem>

### Example

To prevent anyone from deleting entities we can create a method as follows:

<TabItem value="on_before_delete_event" label="on_before_delete_event">
<CodeBlock language="csharp">
{`private void OnBeforeDeleteEvent(object sender, BeforeDeleteEventArgs args)
\{
    throw new NotSupportedException();
\}
`}
</CodeBlock>
</TabItem>

and subscribe it to the session:

<TabItem value="delete_session" label="delete_session">
<CodeBlock language="csharp">
{`// Subscribe to the event
session.Advanced.OnBeforeDelete += OnBeforeDeleteEvent;

var product = session.Load<Product>("products/1-A");
var product2 = session.Load<Product>("products/2-A");

// OnBeforeDelete is triggered whether you
// call Delete() on an entity or on its ID
session.Delete(product);
session.SaveChanges(); // NotSupportedException will be thrown

session.Delete("products/2-A");
session.SaveChanges(); // NotSupportedException will be thrown
`}
</CodeBlock>
</TabItem>



## OnAfterSaveChanges

This event is invoked after the `SaveChanges` is returned.  
It should be defined with this signature:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`private void OnAfterSaveChangesEvent(object sender, AfterSaveChangesEventArgs args);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **sender** | `IDocumentSession` | The session on which `SaveChanges()` has been called, triggering this event |
| **args** | `AfterSaveChangesEventArgs` | `args` contains the session on which `SaveChanges()` has been called, the ID of the document being deleted, and the document itself. |

The class `AfterSaveChangesEventArgs`:

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`public class AfterSaveChangesEventArgs
\{
    public InMemoryDocumentSessionOperations Session;
    public string DocumentId;
    public object Entity;
\}
`}
</CodeBlock>
</TabItem>

### Example

If we want to log each entity that was saved, we can create a method as follows:  

<TabItem value="on_after_save_changes_event" label="on_after_save_changes_event">
<CodeBlock language="csharp">
{`private void OnAfterSaveChangesEvent(object sender, AfterSaveChangesEventArgs args)
\{
    if (Log.IsInfoEnabled)
        Log.Info($"Document '\{args.DocumentId\}' was saved.");
\}
`}
</CodeBlock>
</TabItem>



## OnBeforeQuery

This event is invoked just before the query is sent to the server. 
It should be defined with this signature:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`private void OnBeforeQueryEvent(object sender, BeforeQueryEventArgs args);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **sender** | `IDocumentSession` | The session on which `SaveChanges()` has been called, triggering this event |
| **args** | `BeforeQueryEventArgs` | `args` contains the session on which `SaveChanges()` has been called, and the query's [query customizations](../../../client-api/session/querying/how-to-customize-query.mdx). |

The class `BeforeQueryEventArgs`:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`public class BeforeQueryEventArgs
\{
    public InMemoryDocumentSessionOperations Session;
    public IDocumentQueryCustomization queryCustomization;
\}
`}
</CodeBlock>
</TabItem>

### Example I

If you want to disable caching of all query results, you can implement the method as follows:  

<TabItem value="on_before_query_execute_event" label="on_before_query_execute_event">
<CodeBlock language="csharp">
{`private void OnBeforeQueryEvent(object sender, BeforeQueryEventArgs args)
\{
    args.QueryCustomization.NoCaching();
\}
`}
</CodeBlock>
</TabItem>

### Example II

If you want each query to [wait for non-stale results](../../../indexes/stale-indexes.mdx) you can create an event as follows:  

<TabItem value="on_before_query_execute_event_2" label="on_before_query_execute_event_2">
<CodeBlock language="csharp">
{`private void OnBeforeQueryEvent(object sender, BeforeQueryEventArgs args)
\{
    args.QueryCustomization.WaitForNonStaleResults(TimeSpan.FromSeconds(30));
\}
`}
</CodeBlock>
</TabItem>



## OnBeforeConversionToDocument

This event is invoked before conversion of an entity to blittable JSON document. E.g. it's called when sending a document to a server.  
It should be defined with this signature:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`private void OnBeforeConversionToDocumentEvent(object sender, BeforeConversionToDocumentEventArgs args);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **sender** | `IDocumentSession` | The session on which `SaveChanges()` has been called, triggering this event |
| **args** | `BeforeConversionToDocumentEventArgs` | `args` contains the session on which `SaveChanges()` has been called, the ID of the document being ConversionToDocumentd, and the document itself. |

The class `BeforeConversionToDocumentEventArgs`:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`public class BeforeConversionToDocumentEventArgs
\{
    public InMemoryDocumentSessionOperations Session;
    public string DocumentId;
    public object Entity;
\}
`}
</CodeBlock>
</TabItem>

### Example

<TabItem value="on_before_conversion_to_document" label="on_before_conversion_to_document">
<CodeBlock language="csharp">
{`private void OnBeforeConversionToDocument(object sender, BeforeConversionToDocumentEventArgs args)
\{
    if (args.Entity is Item item)
        item.Before = true;
\}
`}
</CodeBlock>
</TabItem>



## OnAfterConversionToDocument

This event is invoked after conversion of an entity to blittable JSON document.  
It should be defined with this signature:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`private void OnAfterConversionToDocumentEvent(object sender, AfterConversionToDocumentEventArgs args);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **sender** | `IDocumentSession` | The session on which `SaveChanges()` has been called, triggering this event |
| **args** | `AfterConversionToDocumentEventArgs` | `args` contains the session on which `SaveChanges()` has been called, the ID of the document being ConversionToDocumentd, and the document itself. |

The class `AfterConversionToDocumentEventArgs`:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`public class AfterConversionToDocumentEventArgs
\{
    public InMemoryDocumentSessionOperations Session;
    public string DocumentId;
    public object Entity;
\}
`}
</CodeBlock>
</TabItem>

### Example

<TabItem value="on_after_conversion_to_document" label="on_after_conversion_to_document">
<CodeBlock language="csharp">
{`private void OnAfterConversionToDocument(object sender, AfterConversionToDocumentEventArgs args)
\{
    if (args.Entity is Item item)
    \{
        if (args.Document.Modifications == null)
            args.Document.Modifications = new DynamicJsonValue();

        args.Document.Modifications["After"] = true;
        args.Document = args.Session.Context.ReadObject(args.Document, args.Id);

        item.After = true;
    \}
\}
`}
</CodeBlock>
</TabItem>



## OnBeforeConversionToEntity

This event is invoked before conversion of a JSON document to an entity. E.g. it's called when loading a document.  

It takes the argument `BeforeConversionToEntityEventArgs`, that consists of a JSON document, its ID and type, and the session instance.  

<TabItem value="on_before_conversion_to_entity" label="on_before_conversion_to_entity">
<CodeBlock language="csharp">
{`private void OnBeforeConversionToEntity(object sender, BeforeConversionToEntityEventArgs args)
\{
    var document = args.Document;
    if (document.Modifications == null)
        document.Modifications = new DynamicJsonValue();

    document.Modifications["Before"] = true;
    args.Document = args.Session.Context.ReadObject(document, args.Id);
\}
`}
</CodeBlock>
</TabItem>




## OnAfterConversionToEntity

This event is invoked after conversion of a JSON document to an entity. It takes the argument `AfterConversionToEntityEventArgs`, that consists of a JSON document, its ID, the session instance and a converted entity.  

<TabItem value="on_after_conversion_to_entity" label="on_after_conversion_to_entity">
<CodeBlock language="csharp">
{`private void OnAfterConversionToEntity(object sender, AfterConversionToEntityEventArgs args)
\{
    if (args.Entity is Item item)
        item.After = true;
\}
`}
</CodeBlock>
</TabItem>



## OnSessionDisposing

This event is invoked by the disposal of a session, **before** the session is disposed of.  
Keeping track of sessions disposal allows you, among other uses, to verify that sessions 
that are no longer needed are disposed of.  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`private void OnSessionDisposingEvent(object sender, SessionDisposingEventArgs args);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **sender** | `IDocumentSession` | The session whose disposal triggered this event |
| **args** | `SessionDisposingEventArgs` | `args` contains the session that is disposed of. |

The class `SessionDisposingEventArgs`:  

<TabItem value="csharp" label="csharp">
<CodeBlock language="csharp">
{`public class SessionDisposingEventArgs : EventArgs
\{
    public InMemoryDocumentSessionOperations Session \{ get; \}
\}
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="java">


* **Events** allow users to perform custom actions in response to operations made in 
  a `Document Store` or a `Session`.  

* An event is invoked when the selected action is executed on an entity, or querying is performed.  

* Subscribing to an event in a `Session` is valid only for this session.  

* Subscribing to an event at the `DocumentStore` level subscribes to this 
  event in all subsequent sessions.  
  Read more about `DocumentStore` events [here](../../../client-api/how-to/subscribe-to-store-events.mdx).  

## beforeStoreListener

This event is invoked as a part of `saveChanges` but before it is actually sent to the server.  
It should be defined with this signature:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public void addBeforeStoreListener(EventHandler<BeforeStoreEventArgs> handler);

public void removeBeforeStoreListener(EventHandler<BeforeStoreEventArgs> handler);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **handler** | `EventHandler<BeforeStoreEventArgs>` | handle this event |

The class `BeforeStoreEventArgs`:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public BeforeStoreEventArgs(InMemoryDocumentSessionOperations session, String documentId, Object entity);
`}
</CodeBlock>
</TabItem>

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public class BeforeStoreEventArgs
\{
    private IMetadataDictionary _documentMetadata;
    private final InMemoryDocumentSessionOperations session;
    private final String documentId;
    private final Object entity;

    //getters and setters (omitted for brevity)
\}
`}
</CodeBlock>
</TabItem>

### Example

Say we want to discontinue all of the products that are not in stock.  

<TabItem value="on_before_store_event" label="on_before_store_event">
<CodeBlock language="java">
{`private void onBeforeStoreEvent(Object sender, BeforeStoreEventArgs args) \{
    if (args.getEntity() instanceof Product) \{
        Product product = (Product) args.getEntity();
        if (product.getUnitsInStock() == 0) \{
            product.setDiscontinued(true);
        \}
    \}
\}
`}
</CodeBlock>
</TabItem>

After we subscribe to the event, every stored entity will invoke the method.  

<TabItem value="store_session" label="store_session">
<CodeBlock language="java">
{`// subscribe to the event
store.addBeforeStoreListener(this::onBeforeStoreEvent);

try (IDocumentSession session = store.openSession()) \{
    Product product1 = new Product();
    product1.setName("RavenDB v3.5");
    product1.setUnitsInStock(0);

    session.store(product1);

    Product product2 = new Product();
    product2.setName("RavenDB v4.0");
    product2.setUnitsInStock(1000);
    session.store(product2);

    session.saveChanges();  // Here the method is invoked
\}
`}
</CodeBlock>
</TabItem>



## beforeDeleteListener

This event is invoked by `delete(id)` or `delete(entity)`. It is only executed when `saveChanges()` 
is called, but before the commands are actually sent to the server.  
It should be defined with this signature:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public void addBeforeDeleteListener(EventHandler<BeforeDeleteEventArgs> handler);

public void removeBeforeDeleteListener(EventHandler<BeforeDeleteEventArgs> handler);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **handler** | `EventHandler<BeforeDeleteEventArgs>` | handle this event |

The class `BeforeDeleteEventArgs`:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public BeforeDeleteEventArgs(InMemoryDocumentSessionOperations session, String documentId, Object entity);
`}
</CodeBlock>
</TabItem>

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public class BeforeDeleteEventArgs
\{
    private IMetadataDictionary _documentMetadata;
    private final InMemoryDocumentSessionOperations session;
    private final String documentId;
    private final Object entity;

    //getters and setters (omitted for brevity)
\}
`}
</CodeBlock>
</TabItem>

### Example

To prevent anyone from deleting entities we can create a method as follows:

<TabItem value="on_before_delete_event" label="on_before_delete_event">
<CodeBlock language="java">
{`private void onBeforeDeleteEvent(Object sender, BeforeDeleteEventArgs args) \{
    throw new NotImplementedException("Sample");
\}
`}
</CodeBlock>
</TabItem>

and subscribe it to the session:

<TabItem value="delete_session" label="delete_session">
<CodeBlock language="java">
{`// subscribe to the event
store.addBeforeDeleteListener(this::onBeforeDeleteEvent);

// open a session and delete entity
try (IDocumentSession session = store.openSession()) \{
    Product product = session.load(Product.class, "products/1-A");

    session.delete(product);
    session.saveChanges(); // NotImplementedException will be thrown here
\}
`}
</CodeBlock>
</TabItem>



## afterSaveChangesListener

This event is invoked after the `saveChanges` is returned.  
It should be defined with this signature:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public void addAfterSaveChangesListener(EventHandler<AfterSaveChangesEventArgs> handler);

public void removeAfterSaveChangesListener(EventHandler<AfterSaveChangesEventArgs> handler);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **handler** | `EventHandler<AfterSaveChangesEventArgs>` | handle this event |


The class `AfterSaveChangesEventArgs`:


<TabItem value="java" label="java">
<CodeBlock language="java">
{`public AfterSaveChangesEventArgs(InMemoryDocumentSessionOperations session, String documentId, Object entity);
`}
</CodeBlock>
</TabItem>

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public class AfterSaveChangesEventArgs
\{
    private IMetadataDictionary _documentMetadata;
    private final InMemoryDocumentSessionOperations session;
    private final String documentId;
    private final Object entity;

    //getters and setters (omitted for brevity)
\}
`}
</CodeBlock>
</TabItem>

### Example

If we want to log each entity that was saved, we can create a method as follows:  

<TabItem value="on_after_save_changes_event" label="on_after_save_changes_event">
<CodeBlock language="java">
{`private void onAfterSaveChangesEvent(Object sender, AfterSaveChangesEventArgs args) \{
    if (log.isLoggable(Level.INFO)) \{
        log.info("Document " + args.getDocumentId() + " was saved");
    \}
\}
`}
</CodeBlock>
</TabItem>



## beforeQueryListener

This event is invoked just before the query is sent to the server. 
It should be defined with this signature:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public void addBeforeQueryListener(EventHandler<BeforeQueryEventArgs> handler);

public void removeBeforeQueryListener(EventHandler<BeforeQueryEventArgs> handler);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **handler** | `EventHandler<BeforeQueryEventArgs>` | handle this event |

The class `BeforeQueryEventArgs`:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public class BeforeQueryEventArgs
\{
    private final InMemoryDocumentSessionOperations session;
    private final IDocumentQueryCustomization queryCustomization;

    //getters (omitted for brevity)
\}
`}
</CodeBlock>
</TabItem>

### Example I

If you want to disable caching of all query results, you can implement the method as follows:  

<TabItem value="on_before_query_execute_event" label="on_before_query_execute_event">
<CodeBlock language="java">
{`private void onBeforeQueryEvent(Object sender, BeforeQueryEventArgs args) \{
    args.getQueryCustomization().noCaching();
\}
`}
</CodeBlock>
</TabItem>

### Example II

If you want each query to [wait for non-stale results](../../../indexes/stale-indexes.mdx) you can create an event as follows:  

<TabItem value="on_before_query_execute_event_2" label="on_before_query_execute_event_2">
<CodeBlock language="java">
{`private void onBeforeQueryEvent(BeforeQueryEventArgs args) \{
    args.getQueryCustomization().waitForNonStaleResults(Duration.ofSeconds(30));
\}
`}
</CodeBlock>
</TabItem>



## beforeConversionToDocumentListener

This event is invoked before conversion of an entity to blittable JSON document. E.g. it's called when sending a document to a server.  
It should be defined with this signature:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public void addBeforeConversionToDocumentListener(EventHandler<BeforeConversionToDocumentEventArgs> handler);

public void removeBeforeConversionToDocumentListener(EventHandler<BeforeConversionToDocumentEventArgs> handler);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **handler** | `EventHandler<BeforeConversionToDocumentEventArgs>` | handle this event |

The class `BeforeConversionToDocumentEventArgs`:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public BeforeConversionToDocumentEventArgs(InMemoryDocumentSessionOperations session, String id, Object entity);
`}
</CodeBlock>
</TabItem>


<TabItem value="java" label="java">
<CodeBlock language="java">
{`public class BeforeConversionToDocumentEventArgs
\{
    private String _id;
    private Object _entity;
    private InMemoryDocumentSessionOperations _session;

    //getters (omitted for brevity)
\}
`}
</CodeBlock>
</TabItem>

### Example

<TabItem value="on_before_conversion_to_document" label="on_before_conversion_to_document">
<CodeBlock language="java">
{`private void onBeforeConversionToDocument(Object sender, BeforeConversionToDocumentEventArgs args) \{
    if (args.getEntity() instanceof Item) \{
        Item item = (Item) args.getEntity();
        item.setBefore(true);
    \}
\}
`}
</CodeBlock>
</TabItem>



## afterConversionToDocumentListener

This event is invoked after conversion of an entity to blittable JSON document.  
It should be defined with this signature:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public void addAfterConversionToDocumentListener(EventHandler<AfterConversionToDocumentEventArgs> handler);

public void removeAfterConversionToDocumentListener(EventHandler<AfterConversionToDocumentEventArgs> handler);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **handler** | `EventHandler<AfterConversionToDocumentEventArgs>` | handle this event |

The class `AfterConversionToDocumentEventArgs`:  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public AfterConversionToDocumentEventArgs(InMemoryDocumentSessionOperations session, String id, Object entity, Reference<ObjectNode> document);
`}
</CodeBlock>
</TabItem>

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public class AfterConversionToDocumentEventArgs
\{
    private String _id;
    private Object _entity;
    private Reference<ObjectNode> _document;
    private InMemoryDocumentSessionOperations _session;

    //getters (omitted for brevity)
\}
`}
</CodeBlock>
</TabItem>

### Example

<TabItem value="on_after_conversion_to_document" label="on_after_conversion_to_document">
<CodeBlock language="java">
{`private void onAfterConversionToDocument(Object sender, AfterConversionToDocumentEventArgs args) \{
    if (args.getEntity() instanceof Item)
    \{
        Item item = (Item) args.getEntity();
        item.setAfter(true);
    \}
\}
`}
</CodeBlock>
</TabItem>



## beforeConversionToEntityListener

This event is invoked before conversion of a JSON document to an entity. E.g. it's called when loading a document.  

It takes the argument `BeforeConversionToEntityEventArgs`, that consists of a JSON document, its ID and type, and the session instance.  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public void addBeforeConversionToEntityListener(EventHandler<BeforeConversionToEntityEventArgs> handler);

public void removeBeforeConversionToEntityListener(EventHandler<BeforeConversionToEntityEventArgs> handler);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **handler** | `EventHandler<BeforeConversionToEntityEventArgs>` | handle this event |


<TabItem value="java" label="java">
<CodeBlock language="java">
{`public class BeforeConversionToEntityEventArgs\{

    private String _id;
    private Class _type;
    private Reference<ObjectNode> _document;
    private InMemoryDocumentSessionOperations _session;

    //getters (omitted for brevity)
\}
`}
</CodeBlock>
</TabItem>

<TabItem value="on_before_conversion_to_entity" label="on_before_conversion_to_entity">
<CodeBlock language="java">
{`private void onBeforeConversionToEntity(Object sender, BeforeConversionToEntityEventArgs args) \{
    if (args.getId() == "item/1-A")
    \{
        if (log.isLoggable(Level.INFO)) \{
            log.info("Document " + args.getId() + " has found");
        \}
    \}
\}
`}
</CodeBlock>
</TabItem>



## afterConversionToEntityListener

This event is invoked after conversion of a JSON document to an entity. It takes the argument `AfterConversionToEntityEventArgs`, that consists of a JSON document, its ID, the session instance and a converted entity.  

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public void addAfterConversionToEntityListener(EventHandler<AfterConversionToEntityEventArgs> handler);

public void removeAfterConversionToEntityListener(EventHandler<AfterConversionToEntityEventArgs> handler);
`}
</CodeBlock>
</TabItem>

| Parameters | Type | Description |
| - | - | - |
| **handler** | `EventHandler<AfterConversionToEntityEventArgs>` | handle this event |

<TabItem value="java" label="java">
<CodeBlock language="java">
{`public class AfterConversionToEntityEventArgs \{

    private String _id;
    private ObjectNode _document;
    private Object _entity;
    private InMemoryDocumentSessionOperations _session;

    //getters (omitted for brevity)
\}
`}
</CodeBlock>
</TabItem>

<TabItem value="on_after_conversion_to_entity" label="on_after_conversion_to_entity">
<CodeBlock language="java">
{`private void onAfterConversionToEntity(Object sender, AfterConversionToEntityEventArgs args) \{
    if (args.getEntity() instanceof Item) \{
        Item item = (Item) args.getEntity();
        item.setAfter(true);
    \}
\}
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="nodejs">


* **Events** allow users to perform custom actions in response to operations made in 
  a `Document Store` or a `Session`.  

* An event is invoked when the selected action is executed on an entity, or querying is performed.  

* Subscribing to an event in a `Session` is valid only for this session.  

* Subscribing to an event at the `DocumentStore` level subscribes to this 
  event in all subsequent sessions.  
  Read more about `DocumentStore` events [here](../../../client-api/how-to/subscribe-to-store-events.mdx).  

## OnBeforeStore

This event is invoked as a part of `saveChanges()` but before it is actually sent to the server.  
It should be defined with this signature:  

<TabItem value="OnBeforeStore" label="OnBeforeStore">
<CodeBlock language="js">
{`store.addSessionListener("beforeStore", event => onBeforeStore(event));
`}
</CodeBlock>
</TabItem>

The usage of `SessionBeforeStoreEventArgs`:  

<TabItem value="beforeStoreEventArgs" label="beforeStoreEventArgs">
<CodeBlock language="js">
{`const beforeStoreEventArgs = new SessionBeforeStoreEventArgs(session, documentId, entity);
`}
</CodeBlock>
</TabItem>

### Example

Say we want to discontinue all of the products that are not in stock.  

<TabItem value="on_before_store_event" label="on_before_store_event">
<CodeBlock language="js">
{`function onBeforeStore(args) \{
    if (args.getEntity() instanceof Product) \{
        const product = args.getEntity();
        if (product.unitsInStock === 0) \{
            product.discontinued = true;
        \}
    \}
\}
`}
</CodeBlock>
</TabItem>

After we subscribe to the event, every stored entity will invoke the method.  

<TabItem value="store_session" label="store_session">
<CodeBlock language="js">
{`store.addSessionListener("beforeStore", event => onBeforeStore(event));

session = store.openSession();
await session.store(new Product(
    \{
        name: "RavenDB v3.5",
        unitsInStock: 0
    \})
)

await session.store(new Product(
    \{
        name: "RavenDB v4.0",
        unitsInStock: 1000
    \})
)

await session.saveChanges(); // Here the method is invoked
`}
</CodeBlock>
</TabItem>



## OnBeforeDelete

This event is invoked by `delete(id)` or `delete(entity)`. It is only executed when `saveChanges()` 
is called, but before the commands are actually sent to the server.  
It should be defined with this signature:  

<TabItem value="before_delete_event" label="before_delete_event">
<CodeBlock language="js">
{`store.addSessionListener("beforeDelete", event => onBeforeDelete(event));
`}
</CodeBlock>
</TabItem>

The usage of `SessionBeforeDeleteEventArgs`:  

<TabItem value="beforeDeleteEventArgs" label="beforeDeleteEventArgs">
<CodeBlock language="js">
{`const beforeDeleteEventArgs = new SessionBeforeDeleteEventArgs(session, documentId, entity);
`}
</CodeBlock>
</TabItem>

### Example

To prevent anyone from deleting entities we can create a method as follows:

<TabItem value="on_Before_Delete_Event" label="on_Before_Delete_Event">
<CodeBlock language="js">
{`function onBeforeDelete(args) \{
    throw new Error("Not implemented");
\}
`}
</CodeBlock>
</TabItem>

and subscribe it to the session:

<TabItem value="delete_session" label="delete_session">
<CodeBlock language="js">
{`store.addSessionListener("beforeDelete", event => onBeforeDelete(event));

session = store.openSession();
let product = await session.load("products/1-A", Product);
let product2 = await session.load("products/2-A", Product);

// onBeforeDelete is triggered whether you
// call delete() on an entity or on its ID
await session.delete(product);
await session.saveChanges(); // NotSupportedException will be thrown

await session.delete("products/2-A");
await session.saveChanges(); // NotSupportedException will be thrown
`}
</CodeBlock>
</TabItem>



## OnAfterSaveChanges

This event is invoked after the `saveChanges` is returned.  
It should be defined with this signature:  

<TabItem value="after_save_event" label="after_save_event">
<CodeBlock language="js">
{`store.addSessionListener("afterSave", event => onAfterSaveChanges(event));
`}
</CodeBlock>
</TabItem>


The usage of `SessionAfterSaveChangesEventArgs`:

<TabItem value="afterSaveChangesEventArgs" label="afterSaveChangesEventArgs">
<CodeBlock language="js">
{`const afterSaveChangesEventArgs = new SessionAfterSaveChangesEventArgs(session, documentId, entity);
`}
</CodeBlock>
</TabItem>


### Example

If we want to log each entity that was saved, we can create a method as follows:  

<TabItem value="on_after_save_changes_event" label="on_after_save_changes_event">
<CodeBlock language="js">
{`function onAfterSaveChanges(args) \{
    console.log("Document " + args.documentId + " was saved.");
\}
`}
</CodeBlock>
</TabItem>



## OnBeforeQuery

This event is invoked just before the query is sent to the server. 
It should be defined with this signature:  

<TabItem value="before_query_event" label="before_query_event">
<CodeBlock language="js">
{`store.addSessionListener("beforeQuery", event => onBeforeQuery(event));
`}
</CodeBlock>
</TabItem>

The usage of `SessionBeforeQueryEventArgs`:  

<TabItem value="beforeQueryEventArgs" label="beforeQueryEventArgs">
<CodeBlock language="js">
{`const beforeQueryEventArgs = new SessionBeforeQueryEventArgs(session, documentId, entity);
`}
</CodeBlock>
</TabItem>

### Example I

If you want to disable caching of all query results, you can implement the method as follows:  

<TabItem value="on_before_query_execute_event" label="on_before_query_execute_event">
<CodeBlock language="js">
{`function onBeforeQuery(args) \{
    args.queryCustomization.noCaching();
\}
`}
</CodeBlock>
</TabItem>

### Example II

If you want each query to [wait for non-stale results](../../../indexes/stale-indexes.mdx) you can create an event as follows:  

<TabItem value="on_before_query_execute_event_2" label="on_before_query_execute_event_2">
<CodeBlock language="js">
{`function onBeforeQuery(args) \{
    args.queryCustomization.waitForNonStaleResults(30);
\}
`}
</CodeBlock>
</TabItem>



## OnBeforeConversionToDocument

This event is invoked before conversion of an entity to blittable JSON document. E.g. it's called when sending a document to a server.  
It should be defined with this signature:  

<TabItem value="beforeConversionToDocument_event" label="beforeConversionToDocument_event">
<CodeBlock language="js">
{`store.addSessionListener("beforeConversionToDocument", event => onBeforeConversionToDocument(event));
`}
</CodeBlock>
</TabItem>

The usage of `BeforeConversionToDocumentEventArgs`:  

<TabItem value="beforeConversionToDocument" label="beforeConversionToDocument">
<CodeBlock language="js">
{`const beforeConversionToDocumentEventArgs = new BeforeConversionToDocumentEventArgs(session, documentId, entity);
`}
</CodeBlock>
</TabItem>

### Example

<TabItem value="on_before_conversion_to_document" label="on_before_conversion_to_document">
<CodeBlock language="js">
{`function onBeforeConversionToDocument(args) \{
    if (args.getEntity() instanceof Product) \{
        const product = args.getEntity();
        product.before = true;
    \}
\}
`}
</CodeBlock>
</TabItem>



## OnAfterConversionToDocument

This event is invoked after conversion of an entity to blittable JSON document.  
It should be defined with this signature:  

<TabItem value="afterConversionToDocument_event" label="afterConversionToDocument_event">
<CodeBlock language="js">
{`store.addSessionListener("afterConversionToDocument", event => onAfterConversionToDocument(event));
`}
</CodeBlock>
</TabItem>

The class `AfterConversionToDocumentEventArgs`:  

<TabItem value="afterConversionToDocument" label="afterConversionToDocument">
<CodeBlock language="js">
{`const afterConversionToDocument = new AfterConversionToDocumentEventArgs(session, documentId, entity, document);
`}
</CodeBlock>
</TabItem>


### Example

<TabItem value="on_after_conversion_to_document" label="on_after_conversion_to_document">
<CodeBlock language="js">
{`function onAfterConversionToDocument(args) \{
    if (args.getEntity() instanceof Product) \{
        const product = args.getEntity();
        if (product.document.after == null) \{
            product.document.after = true;
        \}
    \}
\}
`}
</CodeBlock>
</TabItem>



## OnBeforeConversionToEntity

This event is invoked before conversion of a JSON document to an entity. E.g. it's called when loading a document.  

It takes the argument `BeforeConversionToEntityEventArgs`, that consists of a JSON document, its ID and type, and the session instance.  

<TabItem value="on_before_conversion_to_entity" label="on_before_conversion_to_entity">
<CodeBlock language="js">
{`store.addSessionListener("beforeConversionToEntity", (event: BeforeConversionToEntityEventArgs) => \{
    const document = ObjectUtil.clone(event.document);

    document.before = true;
    event.document = document;
\});
`}
</CodeBlock>
</TabItem>




## OnAfterConversionToEntity

This event is invoked after conversion of a JSON document to an entity. It takes the argument `AfterConversionToEntityEventArgs`, that consists of a JSON document, its ID, the session instance and a converted entity.  

<TabItem value="on_after_conversion_to_entity" label="on_after_conversion_to_entity">
<CodeBlock language="js">
{`store.addSessionListener("afterConversionToEntity", (event: AfterConversionToEntityEventArgs) => \{
    if (event.entity instanceof Item) \{
        const item = event.entity;
        item.after = true;
    \}
\});
`}
</CodeBlock>
</TabItem>




</LanguageContent>

<!---
### Document Store
- [What is a Document Store](../../../client-api/what-is-a-document-store)

### Session
- [What is a Session and How does it Work](../../../client-api/session/what-is-a-session-and-how-does-it-work)
- [Subscribe to Store Events](../../../client-api/how-to/subscribe-to-store-events)


-->