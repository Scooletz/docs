import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';

<Admonition type="note" title="">

* `Defer` allows you to register server commands via the session.

* All the deferred requests will be stored in the session and sent to the server in a single batch when SaveChanges is called,
  along with any other changes/operations made on the session.  
  Thus, all deferred commands are __executed as part of the session's SaveChanges transaction__.

* In this page:   
    * [Defer commands example](../../../client-api/session/how-to/defer-operations.mdx#defer-commands-example)  
    * [Commands that can be deferred](../../../client-api/session/how-to/defer-operations.mdx#commands-that-can-be-deferred)
    * [Syntax](../../../client-api/session/how-to/defer-operations.mdx#syntax)  
</Admonition>
## Defer commands example

<TabItem value="defer_1" label="defer_1">
<CodeBlock language="csharp">
{`// Defer is available in the session's Advanced methods 
session.Advanced.Defer(
    
    // Define commands to be executed:
    // i.e. Put a new document
    new PutCommandData("products/999-A", null, new DynamicJsonValue
        \{
            ["Name"] = "My Product",
            ["Supplier"] = "suppliers/1-A",
            ["@metadata"] = new DynamicJsonValue
            \{
                ["@collection"] = "Products"
            \}
        \}),
    
    // Patch document
    new PatchCommandData("products/999-A", null, new PatchRequest
            \{
                Script = "this.Supplier = 'suppliers/2-A';"
            \},
            null),
    
    // Force a revision to be created
    new ForceRevisionCommandData("products/999-A"),
    
    // Delete a document
    new DeleteCommandData("products/1-A", null)
);

// All deferred commands will be sent to the server upon calling SaveChanges
session.SaveChanges();
`}
</CodeBlock>
</TabItem>



## Commands that can be deferred

The following commands implement the `ICommandData` interface and can be deferred:  

  - [PutCommandData](../../../glossary/put-command-data.mdx)
  - [DeleteCommandData](../../../glossary/delete-command-data.mdx)
  - DeletePrefixedCommandData
  - [PatchCommandData](../../../glossary/patch-command-data.mdx)
  - BatchPatchCommandData
  - PutAttachmentCommandData
  - DeleteAttachmentCommandData
  - [CopyAttachmentCommandData](../../../glossary/copy-attachment-command-data.mdx)
  - [MoveAttachmentCommandData](../../../glossary/move-attachment-command-data.mdx)
  - [CountersBatchCommandData](../../../glossary/counters-batch-command-data.mdx)
  - PutCompareExchangeCommandData
  - DeleteCompareExchangeCommandData
  - CopyTimeSeriesCommandData
  - TimeSeriesBatchCommandData
  - ForceRevisionCommandData


## Syntax

<TabItem value="syntax" label="syntax">
<CodeBlock language="csharp">
{`void Defer(ICommandData command, params ICommandData[] commands);
void Defer(ICommandData[] commands);
`}
</CodeBlock>
</TabItem>

| Parameter | Type | Description |
| - |-|-|
| **command** | A command that implements the `ICommandData` interface | The command to be executed |
| **commands** | `ICommandData[]` | Array of commands to be executed |




