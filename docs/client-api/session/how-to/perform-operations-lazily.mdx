---
title: "Perform requests lazily"
sidebar_label: ...perform requests lazily
sidebar_position: 4
hide_table_of_contents: true
---

import Admonition from '@theme/Admonition';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import CodeBlock from '@theme/CodeBlock';
import LanguageSwitcher from "@site/src/components/LanguageSwitcher";
import LanguageContent from "@site/src/components/LanguageContent";

export const supportedLanguages = ["csharp", "python", "php", "nodejs"];


# Perform requests lazily
<LanguageSwitcher supportedLanguages={supportedLanguages} />
<LanguageContent language="csharp">

<Admonition type="note" title="Note">

* **Lazy request**:

    * You can define a lazy request within a session (e.g. a lazy-query or a lazy-load request)  
      and defer its execution until actually needed.

    * The lazy request definition is stored in the session and a `Lazy<T>` instance is returned.  
      The request will be sent to the server and executed only when you access the value of this instance.

* **Multiple lazy requests**:

    * Multiple lazy requests can be defined within the same session.

    * When triggering the deferred execution (whether implicitly or explicitly),  
      ALL pending lazy requests held up by the session will be sent to the server in a single call.  
      This can help reduce the number of remote calls made to the server over the network.

* In this page:
    * [Requests that can be executed lazily](../../../client-api/session/how-to/perform-operations-lazily#operations-that-can-be-executed-lazily)
        * [Load entities](../../../client-api/session/how-to/perform-operations-lazily#load-entities)
        * [Load entities with include](../../../client-api/session/how-to/perform-operations-lazily#load-entities-with-include)
        * [Load entities starting with](../../../client-api/session/how-to/perform-operations-lazily#load-entities-starting-with)
        * [Conditional load](../../../client-api/session/how-to/perform-operations-lazily#conditional-load)
        * [Run query](../../../client-api/session/how-to/perform-operations-lazily#run-query)
        * [Get revisions](../../../client-api/session/how-to/perform-operations-lazily#get-revisions)
        * [Get compare-exchange value](../../../client-api/session/how-to/perform-operations-lazily#get-compare-exchange-value)
    * [Multiple lazy requests](../../../client-api/session/how-to/perform-operations-lazily#multiple-lazy-requests)
        * [Execute all requests - implicitly](../../../client-api/session/how-to/perform-operations-lazily#execute-all-requests---implicitly)
        * [Execute all requests - explicitly](../../../client-api/session/how-to/perform-operations-lazily#execute-all-requests---explicitly)

</Admonition>
## Operations that can be executed lazily

### Load entities

[Load](../../../client-api/session/loading-entities#load) loads a document entity from 
the database into the session.  
Loading entities can be executed **lazily**.   

<TabItem value="something" label="lazy_Load">
<CodeBlock language="csharp">
{`Lazy<Employee> lazyEmployee = session
     // Add a call to Lazily 
    .Advanced.Lazily
     // Document will Not be loaded from the database here, no server call is made
    .Load<Employee>("employees/1-A");

Employee employee = lazyEmployee.Value; // 'Load' operation is executed here
// The employee entity is now loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
### Load entities with include

[Load with include](../../../client-api/session/loading-entities#load-with-includes) loads both the document and the specified related document.    
Loading entities with include can be executed **lazily**.

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_load_with_include" label="Lazy_load_with_include">
<CodeBlock language="csharp">
{`Lazy<Product> lazyProduct = session
     // Add a call to Lazily 
    .Advanced.Lazily
     // Request to include the related Supplier document
     // Documents will Not be loaded from the database here, no server call is made
    .Include<Product>(x => x.SupplierId) 
    .Load<Product>("products/1-A"); 

// 'Load with include' operation will be executed here
// Both documents will be retrieved from the database
Product product = lazyProduct.Value;
// The product entity is now loaded & tracked by the session

// Access the related document, no additional server call is made
Supplier supplier = session.Load<Supplier>(product.SupplierId);
// The supplier entity is now also loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
<TabItem value="The_document" label="The_document">
<CodeBlock language="csharp">
{`public class Product
{
    public string Id { get; set; }
    public string Name { get; set; }
    public string SupplierId { get; set; } // The related document ID
}
`}
</CodeBlock>
</TabItem>
</Tabs>
### Load entities starting with

[LoadStartingWith](../../../client-api/session/loading-entities#loadstartingwith) loads entities whose ID starts with the specified prefix.  
Loading entities with a common prefix can be executed **lazily**.

<TabItem value="something" label="lazy_LoadStartingWith">
<CodeBlock language="csharp">
{`Lazy<Dictionary<string, Employee>> lazyEmployees = session
     // Add a call to Lazily 
    .Advanced.Lazily
     // Request to load entities whose ID starts with 'employees/'
     // Documents will Not be loaded from the database here, no server call is made
    .LoadStartingWith<Employee>("employees/");

var employees = lazyEmployees.Value; // 'Load' operation is executed here
// The employee entities are now loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
### Conditional load

[ConditionalLoad](../../../client-api/session/loading-entities#conditionalload) logic is: 

* If the entity is already loaded to the session:  
  no server call is made, the tracked entity is returned.  
* If the entity is Not already loaded to the session:  
  the document will be loaded from the server only if the change-vector provided to the 
  method is older than the one in the server (i.e. if the document in the server is newer).  
* Loading entities conditionally can be executed **lazily**.  

<TabItem value="something" label="lazy_ConditionalLoad">
<CodeBlock language="csharp">
{`// Create document and get its change-vector:
string changeVector; 
using (var session1 = store.OpenSession())
\{
    Employee employee = new Employee();
    session1.Store(employee, "employees/1-A");
    session1.SaveChanges();
    
    // Get the tracked entity change-vector
    changeVector = session1.Advanced.GetChangeVectorFor(employee);
\}

// Conditionally lazy-load the document:
using (var session2 = store.OpenSession())
\{
    var lazyEmployee = session2
         // Add a call to Lazily 
        .Advanced.Lazily
         // Document will Not be loaded from the database here, no server call is made
        .ConditionalLoad<Employee>("employees/1-A", changeVector);

    var loadedItem = lazyEmployee.Value; // 'ConditionalLoad' operation is executed here
    Employee employee = loadedItem.Entity;
    
    // If ConditionalLoad has actually fetched the document from the server (logic described above)
    // then the employee entity is now loaded & tracked by the session
    
\}
`}
</CodeBlock>
</TabItem>
### Run query

A Query can be executed **lazily**.  
Learn more about running queries lazily in [lazy queries](../../../client-api/session/querying/how-to-perform-queries-lazily).

<TabItem value="something" label="lazy_Query">
<CodeBlock language="csharp">
{`// Define a lazy query:
Lazy<IEnumerable<Employee>> lazyEmployees = session
    .Query<Employee>()
    .Where( x => x.FirstName == "John")
     // Add a call to Lazily, the query will Not be executed here 
    .Lazily();

IEnumerable<Employee> employees = lazyEmployees.Value; // Query is executed here

// Note: Since query results are not projected,
// then the resulting employee entities will be tracked by the session.
`}
</CodeBlock>
</TabItem>
### Get revisions

All methods for [getting revisions](../../../document-extensions/revisions/client-api/session/loading) and their metadata can be executed **lazily**.

<TabItem value="something" label="lazy_Revisions">
<CodeBlock language="csharp">
{`Lazy<List<Employee>> lazyRevisions = session
     // Add a call to Lazily 
    .Advanced.Revisions.Lazily
     // Revisions will Not be fetched here, no server call is made
    .GetFor<Employee>("employees/1-A");

     // Usage is the same for the other get revisions methods:
     // .Get()
     // .GetMetadataFor()

List<Employee> revisions = lazyRevisions.Value; // Getting revisions is executed here
`}
</CodeBlock>
</TabItem>
### Get compare-exchange value

[Getting compare-exchange](../../../client-api/session/cluster-transaction/compare-exchange#get-compare-exchange) 
values can be executed **lazily**.

<TabItem value="something" label="lazy_CompareExchange">
<CodeBlock language="csharp">
{`using (var session =
       store.OpenSession(new SessionOptions \{ TransactionMode = TransactionMode.ClusterWide \}))
\{
    // Create compare-exchange value:
    session.Advanced.ClusterTransaction
        .CreateCompareExchangeValue(key: "someKey", value: "someValue");
    session.SaveChanges();

    // Get the compare-exchange value lazily: 
    Lazy<CompareExchangeValue<string>> lazyCmpXchg = session
        // Add a call to Lazily 
        .Advanced.ClusterTransaction.Lazily
        // Compare-exchange values will Not be fetched here, no server call is made
        .GetCompareExchangeValue<string>("someKey");
    
    // Usage is the same for the other method:
    // .GetCompareExchangeValues()

    CompareExchangeValue<string> cmpXchgValue =
        lazyCmpXchg.Value; // Getting compare-exchange value is executed here
\}
`}
</CodeBlock>
</TabItem>



## Multiple lazy requests 

### Execute all requests - implicitly

Accessing the value of ANY of the lazy instances will trigger
the execution of ALL pending lazy requests held up by the session, 
in a SINGLE server call.  

<TabItem value="something" label="lazy_ExecuteAll_Implicit">
<CodeBlock language="csharp">
{`// Define multiple lazy requests
Lazy<User> lazyUser1 = session.Advanced.Lazily.Load<User>("users/1-A");
Lazy<User> lazyUser2 = session.Advanced.Lazily.Load<User>("users/2-A");

Lazy<IEnumerable<Employee>> lazyEmployees = session.Query<Employee>()
    .Lazily();
Lazy<IEnumerable<Product>> lazyProducts = session.Query<Product>()
    .Search(x => x.Name, "Ch*")
    .Lazily();

// Accessing the value of ANY of the lazy instances will trigger
// the execution of ALL pending lazy requests held up by the session
// This is done in a SINGLE server call
User user1 = lazyUser1.Value;

// ALL the other values are now also available
// No additional server calls are made when accessing these values
User user2 = lazyUser2.Value;
IEnumerable<Employee> employees = lazyEmployees.Value;
IEnumerable<Product> products = lazyProducts.Value;
`}
</CodeBlock>
</TabItem>
### Execute all requests - explicitly

Explicitly calling `ExecuteAllPendingLazyOperations` will execute 
ALL pending lazy requests held up by the session, in a SINGLE server call.  

<TabItem value="something" label="lazy_ExecuteAll_Explicit">
<CodeBlock language="csharp">
{`// Define multiple lazy requests
Lazy<User> lazyUser1 = session.Advanced.Lazily.Load<User>("users/1-A");
Lazy<User> lazyUser2 = session.Advanced.Lazily.Load<User>("users/2-A");

Lazy<IEnumerable<Employee>> lazyEmployees = session.Query<Employee>()
    .Lazily();
Lazy<IEnumerable<Product>> lazyProducts = session.Query<Product>()
    .Search(x => x.Name, "Ch*")
    .Lazily();

// Explicitly call 'ExecuteAllPendingLazyOperations'
// ALL pending lazy requests held up by the session will be executed in a SINGLE server call
session.Advanced.Eagerly.ExecuteAllPendingLazyOperations();

// ALL values are now available
// No additional server calls are made when accessing the values
User user1 = lazyUser1.Value;
User user2 = lazyUser2.Value;
IEnumerable<Employee> employees = lazyEmployees.Value;
IEnumerable<Product> products = lazyProducts.Value;
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="python">

<Admonition type="note" title="Note">

* **Lazy request**:

    * You can define a lazy request within a session (e.g. a lazy-query or a lazy-load request)  
      and defer its execution until actually needed.

    * The lazy request definition is stored in the session and a `Lazy` instance is returned.  
      The request will be sent to the server and executed only when you access the value of this instance.

* **Multiple lazy requests**:

    * Multiple lazy requests can be defined within the same session.

    * When triggering the deferred execution (whether implicitly or explicitly),  
      ALL pending lazy requests held up by the session will be sent to the server in a single call.  
      This can help reduce the number of remote calls made to the server over the network.

* In this page:
    * [Requests that can be executed lazily](../../../client-api/session/how-to/perform-operations-lazily#operations-that-can-be-executed-lazily)
        * [Load entities](../../../client-api/session/how-to/perform-operations-lazily#load-entities)
        * [Load entities with include](../../../client-api/session/how-to/perform-operations-lazily#load-entities-with-include)
        * [Load entities starting with](../../../client-api/session/how-to/perform-operations-lazily#load-entities-starting-with)
        * [Conditional load](../../../client-api/session/how-to/perform-operations-lazily#conditional-load)
        * [Run query](../../../client-api/session/how-to/perform-operations-lazily#run-query)
        * [Get revisions](../../../client-api/session/how-to/perform-operations-lazily#get-revisions)
        * [Get compare-exchange value](../../../client-api/session/how-to/perform-operations-lazily#get-compare-exchange-value)
    * [Multiple lazy requests](../../../client-api/session/how-to/perform-operations-lazily#multiple-lazy-requests)
        * [Execute all requests - implicitly](../../../client-api/session/how-to/perform-operations-lazily#execute-all-requests---implicitly)
        * [Execute all requests - explicitly](../../../client-api/session/how-to/perform-operations-lazily#execute-all-requests---explicitly)

</Admonition>
## Operations that can be executed lazily

### Load entities

[load](../../../client-api/session/loading-entities#load) loads a document entity from 
the database into the session.  
Loading entities can be executed **lazily**.   

<TabItem value="something-something" label="lazy_Load">
<CodeBlock language="python">
{`lazy_employee = (
    session
    # Add a call to lazily
    .advanced.lazily.
    # Document will not be loaded from the database here, no server call in made
    load("employees/1-A", Employee)
)

employee = lazy_employee.value  # 'load' operation is executed here
# The employee entity is now loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
### Load entities with include

[load with include](../../../client-api/session/loading-entities#load-with-includes) loads 
both the document and the specified related document.  
Loading entities with include can be executed **lazily**.

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_load_with_include" label="Lazy_load_with_include">
<CodeBlock language="python">
{`lazy_product = (
    session
    # Add a call to lazily
    .advanced.lazily
    # Request to include the related Supplier document
    # Documents will Not be loaded from the database here, no server call is made
    .include("SupplierId").load("products/1-A")
)

# 'Load with include' operation will be executed here
# Both documents will be retrieved from the database
product = lazy_product.value
# The product entity is now loaded & tracked by the session

# Access the related document, no additional server call is made
supplier = session.load(product.SupplierId)
# The supplier entity is now also loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
<TabItem value="The_document" label="The_document">
<CodeBlock language="python">
{`class Product:
    def __init__(self, Id: str = None, Name: str = None, SupplierId: str = None):
        self.Id = Id
        self.Name = Name
        self.SupplierId = SupplierId  # The related document ID
`}
</CodeBlock>
</TabItem>
</Tabs>
### Load entities starting with

[load_starting_with](../../../client-api/session/loading-entities#loadstartingwith) loads 
entities whose ID starts with the specified prefix.  
Loading entities with a common prefix can be executed **lazily**.

<TabItem value="something-something" label="lazy_LoadStartingWith">
<CodeBlock language="python">
{`lazy_employees = (
    session
    # Add a call to lazily
    .advanced.lazily
    # Request to load entities whose ID starts with 'employees/'
    # Documents will Not be loaded from the database here, no server call is made
    .load_starting_with("employees/")
)

employees = lazy_employees.value  # 'load' operation is executed here
# The employee entities is now also loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
### Conditional load

[conditional_load](../../../client-api/session/loading-entities#conditionalload) logic is: 

* If the entity is already loaded to the session:  
  no server call is made, the tracked entity is returned.    
* If the entity is Not already loaded to the session:  
  the document will be loaded from the server only if the change-vector provided to the 
  method is older than the one in the server (i.e. if the document in the server is newer).
* Loading entities conditionally can be executed **lazily**.  

<TabItem value="something-something" label="lazy_ConditionalLoad">
<CodeBlock language="python">
{`# Create document and get is change-vector:
change_vector: Optional[str] = None
with store.open_session() as session1:
    employee = Employee()
    session1.store(employee, "employees/1-A")
    session1.save_changes()

    # Get the tracked entity change-vector
    change_vector = session1.advanced.get_change_vector_for(employee)

# Conditionally lazy-load the document
with store.open_session() as session2:
    lazy_employee = (
        session2
        # Add a call to lazily
        .advanced.lazily
        # Document will Not be loaded from the database here, no server call is made
        .conditional_load("employees/1-A", change_vector)
    )

    loaded_item = lazy_employee.value  # 'conditional_load' operation is executed here
    employee = loaded_item.entity

    #  If conditional_load has actually fetched the document from the server (logic described above)
    #  then the employee entity is now loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
### Run query

A query can be executed **lazily**.  
Learn more about running queries lazily in [lazy queries](../../../client-api/session/querying/how-to-perform-queries-lazily).

<TabItem value="something-something" label="lazy_Query">
<CodeBlock language="python">
{`# Define a lazy query:
lazy_employees = (
    session.query(object_type=Employee).where_equals("FirstName", "John")
    # Add a call to lazily, the query will not be executed here
    .lazily()
)

employees = lazy_employees.value  # query is executed here
# Note: Since query results are not projected,
# then the resulting employee entities will be tracked by the session.
`}
</CodeBlock>
</TabItem>
### Get revisions

All methods for [getting revisions](../../../document-extensions/revisions/client-api/session/loading) and their metadata can be executed **lazily**.

<TabItem value="something-something" label="lazy_Revisions">
<CodeBlock language="python">
{`lazy_revisions = (
    session.
    # Add a call to lazily
    advanced.revisions.lazily
    # Revisions will Not be fetched here, no sever call is made
    .get_for("employees/1-A", Employee)
)

# Usage is the same for the other get revisions methods:
# .get()
# .get_metadata_for()

revisions = lazy_revisions.value  # Getting revisions is executed here
`}
</CodeBlock>
</TabItem>
### Get compare-exchange value

[get_compare_exchange_value](../../../client-api/session/cluster-transaction/compare-exchange#get-compare-exchange) 
can be executed **lazily**.

<TabItem value="something-something" label="lazy_CompareExchange">
<CodeBlock language="python">
{`with store.open_session(
    session_options=SessionOptions(transaction_mode=TransactionMode.CLUSTER_WIDE)
) as session:
    # Create compare-exchange value:
    session.advanced.cluster_transaction.create_compare_exchange_value("someKey", "someValue")
    session.save_changes()

    # Get the compare-exchange value lazily:
    lazy_cmp_xchg = (
        session
        # Adda a call to lazily
        .advanced.cluster_transaction.lazily
        # Compare-exchange values will Not be fetched here, no server call is made
        .get_compare_exchange_value("someKey")
    )

    # Usage is the same for the other method:
    # .get_compare_exchange_values()

    cmp_xchg_value = lazy_cmp_xchg.value  # Getting compare-exchange value is executed here
`}
</CodeBlock>
</TabItem>



## Multiple lazy requests 

### Execute all requests - implicitly

Accessing the value of ANY of the lazy instances will trigger
the execution of ALL pending lazy requests held up by the session, 
in a SINGLE server call.  

<TabItem value="something-something" label="lazy_ExecuteAll_Implicit">
<CodeBlock language="python">
{`# Define multiple lazy requests
lazy_user_1 = session.advanced.lazily.load("users/1-A")
lazy_user_2 = session.advanced.lazily.load("users/2-A")

lazy_employees = session.query(object_type=Employee).lazily()
lazy_products = session.query(object_type=Product).search("Name", "Ch*").lazily()

# Accessing the value of ANY of the lazy instances will trigger
# the execution of ALL pending lazy requests held up by the session
# This is done in a SINGLE server call
user1 = lazy_user_1.value

# ALL the other values are now also available
# No additional server calls are made when accessing these values
user2 = lazy_user_2.value
employees = lazy_employees.value
products = lazy_products.value
`}
</CodeBlock>
</TabItem>
### Execute all requests - explicitly

Explicitly calling `execute_all_pending_lazy_operations` will execute 
ALL pending lazy requests held up by the session, in a SINGLE server call.  

<TabItem value="something-something" label="lazy_ExecuteAll_Explicit">
<CodeBlock language="python">
{`# Define multiple lazy requests
lazy_user_1 = session.advanced.lazily.load("users/1-A")
lazy_user_2 = session.advanced.lazily.load("users/2-A")

lazy_employees = session.query(object_type=Employee).lazily()
lazy_products = session.query(object_type=Product).search("Name", "Ch*").lazily()

# Explicitly call 'execute_all_pending_lazy_operations'
# ALL pending lazy requests held up by the session will be executed in a SINGLE server call
session.advanced.eagerly.execute_all_pending_lazy_operations()

# ALL values are now available
# No additional server calls are made when accessing the values
user1 = lazy_user_1.value
user2 = lazy_user_2.value
employees = lazy_employees.value
products = lazy_products.value
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="php">

<Admonition type="note" title="Note">

* **Lazy request**:

    * You can define a lazy request within a session (e.g. a lazy-query or a lazy-load request)  
      and defer its execution until actually needed.

    * The lazy request definition is stored in the session and a `Lazy` instance is returned.  
      The request will be sent to the server and executed only when you access the value of this instance.

* **Multiple lazy requests**:

    * Multiple lazy requests can be defined within the same session.

    * When triggering the deferred execution (whether implicitly or explicitly),  
      ALL pending lazy requests held up by the session will be sent to the server in a single call.  
      This can help reduce the number of remote calls made to the server over the network.

* In this page:
    * [Requests that can be executed lazily](../../../client-api/session/how-to/perform-operations-lazily#operations-that-can-be-executed-lazily)
        * [Load entities](../../../client-api/session/how-to/perform-operations-lazily#load-entities)
        * [Load entities with include](../../../client-api/session/how-to/perform-operations-lazily#load-entities-with-include)
        * [Load entities starting with](../../../client-api/session/how-to/perform-operations-lazily#load-entities-starting-with)
        * [Conditional load](../../../client-api/session/how-to/perform-operations-lazily#conditional-load)
        * [Run query](../../../client-api/session/how-to/perform-operations-lazily#run-query)
        * [Get revisions](../../../client-api/session/how-to/perform-operations-lazily#get-revisions)
        * [Get compare-exchange value](../../../client-api/session/how-to/perform-operations-lazily#get-compare-exchange-value)
    * [Multiple lazy requests](../../../client-api/session/how-to/perform-operations-lazily#multiple-lazy-requests)
        * [Execute all requests - implicitly](../../../client-api/session/how-to/perform-operations-lazily#execute-all-requests---implicitly)
        * [Execute all requests - explicitly](../../../client-api/session/how-to/perform-operations-lazily#execute-all-requests---explicitly)

</Admonition>
## Operations that can be executed lazily

### Load entities

[load](../../../client-api/session/loading-entities#load) loads a document entity from 
the database into the session.  
Loading entities can be executed `lazily`.   

<TabItem value="something-something" label="lazy_Load">
<CodeBlock language="php">
{`/** @var Lazy<Employee> $lazyEmployee */
$lazyEmployee = $session
    // Add a call to Lazily
    ->advanced()->lazily()
    // Document will Not be loaded from the database here, no server call is made
    ->load(Employee::class, "employees/1-A");

$employee = $lazyEmployee->getValue(); // 'Load' operation is executed here
// The employee entity is now loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
### Load entities with include

[load with include](../../../client-api/session/loading-entities#load-with-includes) loads 
both the document and the specified related document.  
Loading entities with include can be executed `lazily`.

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_load_with_include" label="Lazy_load_with_include">
<CodeBlock language="php">
{`/** @var Lazy<Product> $lazyProduct */
$lazyProduct = $session
    // Add a call to Lazily
    ->advanced()->lazily()
    // Request to include the related Supplier document
    // Documents will Not be loaded from the database here, no server call is made
    ->include("SupplierId")
    ->load(Product::class, "products/1-A");

// 'Load with include' operation will be executed here
// Both documents will be retrieved from the database
$product = $lazyProduct->getValue();
// The product entity is now loaded & tracked by the session

// Access the related document, no additional server call is made
$supplier = $session->load(Supplier::class, $product->getSuppierId());
// The supplier entity is now also loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
<TabItem value="The_document" label="The_document">
<CodeBlock language="php">
{`class Product
{
    public ?string $id = null;
    public ?string $name = null;
    public ?string $supplierId = null;

    public function getId(): ?string
    {
        return $this->id;
    }

    public function setId(?string $id): void
    {
        $this->id = $id;
    }

    public function getName(): ?string
    {
        return $this->name;
    }

    public function setName(?string $name): void
    {
        $this->name = $name;
    }

    public function getSupplierId(): ?string
    {
        return $this->supplierId;
    }

    public function setSupplierId(?string $supplierId): void
    {
        $this->supplierId = $supplierId;
    } // The related document ID
}
`}
</CodeBlock>
</TabItem>
</Tabs>
### Load entities starting with

[load_starting_with](../../../client-api/session/loading-entities#loadstartingwith) loads 
entities whose ID starts with the specified prefix.  
Loading entities with a common prefix can be executed `lazily`.

<TabItem value="something-something" label="lazy_LoadStartingWith">
<CodeBlock language="php">
{`/** @var Lazy<array<Employee>> $lazyEmployees */
$lazyEmployees = $session
    // Add a call to Lazily
    ->advanced()->lazily()
    // Request to load entities whose ID starts with 'employees/'
    // Documents will Not be loaded from the database here, no server call is made
    ->loadStartingWith(Employee::class, "employees/");

$employees = $lazyEmployees->getValue(); // 'Load' operation is executed here
// The employee entities are now loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
### Conditional load

[conditional_load](../../../client-api/session/loading-entities#conditionalload) logic is: 

* If the entity is already loaded to the session:  
  no server call is made, the tracked entity is returned.    
* If the entity is Not already loaded to the session:  
  the document will be loaded from the server only if the change-vector provided to the 
  method is older than the one in the server (i.e. if the document in the server is newer).
* Loading entities conditionally can be executed `lazily`.  

<TabItem value="something-something" label="lazy_ConditionalLoad">
<CodeBlock language="php">
{`// Create document and get its change-vector:
$changeVector = null;
$session1 = $store->openSession();
try \{
    $employee = new Employee();
    $session1->store($employee, "employees/1-A");
    $session1->saveChanges();

    // Get the tracked entity change-vector
    $changeVector = $session1->advanced()->getChangeVectorFor($employee);
\} finally \{
    $session1->close();
\}

// Conditionally lazy-load the document:
$session2 = $store->openSession();
try \{
    $lazyEmployee = $session2
        // Add a call to Lazily
        ->advanced()->lazily()
        // Document will Not be loaded from the database here, no server call is made

        ->conditionalLoad(Employee::class, "employees/1-A", $changeVector);

    var
    $loadedItem = $lazyEmployee->getValue(); // 'ConditionalLoad' operation is executed here
    $employee = $loadedItem->getEntity();

    // If ConditionalLoad has actually fetched the document from the server (logic described above)
    // then the employee entity is now loaded & tracked by the session
\} finally \{
    $session2->close();
\}
`}
</CodeBlock>
</TabItem>
### Run query

A query can be executed `lazily`.  
Learn more about running queries lazily in [lazy queries](../../../client-api/session/querying/how-to-perform-queries-lazily).

<TabItem value="something-something" label="lazy_Query">
<CodeBlock language="php">
{`// Define a
// lazy query:
$lazyEmployees = $session
    ->query(Employee::class)
    ->whereEquals("FirstName", "John")
    // Add a call to Lazily, the query will Not be executed here
    ->lazily();

$employees = $lazyEmployees->getValue(); // Query is executed here

// Note: Since query results are not projected,
// then the resulting employee entities will be tracked by the session.
`}
</CodeBlock>
</TabItem>
### Get revisions

All methods for [getting revisions](../../../document-extensions/revisions/client-api/session/loading) and their metadata can be executed `lazily`.

<TabItem value="something-something" label="lazy_Revisions">
<CodeBlock language="php">
{`/** @var Lazy<array<Employee>> $lazyRevisions */
$lazyRevisions = $session
    // Add a call to Lazily
    ->advanced()->revisions()->lazily()
    // Revisions will Not be fetched here, no server call is made
    ->getFor(Employee::class, "employees/1-A");

// Usage is the same for the other get revisions methods:
// .Get()
// .GetMetadataFor()

/** @var array<Employee> $revisions */
$revisions = $lazyRevisions->getValue(); // Getting revisions is executed here
`}
</CodeBlock>
</TabItem>
### Get compare-exchange value

[get_compare_exchange_value](../../../client-api/session/cluster-transaction/compare-exchange#get-compare-exchange) 
can be executed `lazily`.

<TabItem value="something-something" label="lazy_CompareExchange">
<CodeBlock language="php">
{`$sessionOptions = new SessionOptions();
$sessionOptions->setTransactionMode(TransactionMode::clusterWide());
$session = $store->openSession($sessionOptions);
try \{
    // Create compare-exchange value:
    $session->advanced()->clusterTransaction()
        ->createCompareExchangeValue(key: "someKey", value: "someValue");
    $session->SaveChanges();

    // Get the compare-exchange value lazily:
    /** @var Lazy<CompareExchangeValue<string>> $lazyCmpXchg */
    $lazyCmpXchg = $session
        // Add a call to Lazily
        ->advanced()->clusterTransaction()->lazily()
        // Compare-exchange values will Not be fetched here, no server call is made
        ->getCompareExchangeValue(null, "someKey");

    // Usage is the same for the other method:
    // .GetCompareExchangeValues()

    /** @var CompareExchangeValue<string> $cmpXchgValue */
    $cmpXchgValue = $lazyCmpXchg->getValue(); // Getting compare-exchange value is executed here
\} finally \{
    $session->close();
\}
`}
</CodeBlock>
</TabItem>



## Multiple lazy requests 

### Execute all requests - implicitly

Accessing the value of ANY of the lazy instances will trigger
the execution of ALL pending lazy requests held up by the session, 
in a SINGLE server call.  

<TabItem value="something-something" label="lazy_ExecuteAll_Implicit">
<CodeBlock language="php">
{`// Define multiple lazy requests
$lazyUser1 = $session->advanced()->lazily()->load(User::class, "users/1-A");
$lazyUser2 = $session->advanced()->lazily()->load(User::class, "users/2-A");

$lazyEmployees = $session->query(Employee::class)
    ->lazily();
$lazyProducts = $session->query(Product::class)
    ->search("Name", "Ch*")
    ->lazily();

// Accessing the value of ANY of the lazy instances will trigger
// the execution of ALL pending lazy requests held up by the session
// This is done in a SINGLE server call
$user1 = $lazyUser1->getValue();

// ALL the other values are now also available
// No additional server calls are made when accessing these values
$user2 = $lazyUser2->getValue();
$employees = $lazyEmployees->getValue();
$products = $lazyProducts->getValue();
`}
</CodeBlock>
</TabItem>
### Execute all requests - explicitly

Explicitly calling `executeAllPendingLazyOperations` will execute 
ALL pending lazy requests held up by the session, in a SINGLE server call.  

<TabItem value="something-something" label="lazy_ExecuteAll_Explicit">
<CodeBlock language="php">
{`// Define multiple lazy requests
$lazyUser1 = $session->advanced()->lazily->load(User::class, "users/1-A");
$lazyUser2 = $session->advanced()->lazily->load(User::class, "users/2-A");

$lazyEmployees = $session->query(Employee::class)
    ->lazily();
$lazyProducts = $session->query(Product::class)
    ->search("Name", "Ch*")
    ->lazily();

// Explicitly call 'ExecuteAllPendingLazyOperations'
// ALL pending lazy requests held up by the session will be executed in a SINGLE server call
$session->advanced()->eagerly()->executeAllPendingLazyOperations();

// ALL values are now available
// No additional server calls are made when accessing the values
$user1 = $lazyUser1->getValue();
$user2 = $lazyUser2->getValue();
$employees = $lazyEmployees->getValue();
$products = $lazyProducts->getValue();
`}
</CodeBlock>
</TabItem>




</LanguageContent>
<LanguageContent language="nodejs">

<Admonition type="note" title="Note">

* __Lazy request__:

    * You can define a lazy request within a session (e.g. a lazy-query or a lazy-load request)  
      and defer its execution until actually needed.

    * The lazy request definition is stored in the session and a `Lazy` instance is returned.  
      The request will be sent to the server and executed only when you access the value of this instance.

* __Multiple lazy requests__:

    * Multiple lazy requests can be defined within the same session.

    * When triggering the deferred execution (whether implicitly or explicitly),  
      ALL pending lazy requests held up by the session will be sent to the server in a single call.  
      This can help reduce the number of remote calls made to the server over the network.

* In this page:
    * [Requests that can be executed lazily:](../../../client-api/session/how-to/perform-operations-lazily#requests-that-can-be-executed-lazily)
        * [Load entities](../../../client-api/session/how-to/perform-operations-lazily#loadentities)
        * [Load entities with include](../../../client-api/session/how-to/perform-operations-lazily#loadwithinclude)
        * [Load entities starting with](../../../client-api/session/how-to/perform-operations-lazily#loadstartingwith)
        * [Conditional load](../../../client-api/session/how-to/perform-operations-lazily#conditionalload)
        * [Run query](../../../client-api/session/how-to/perform-operations-lazily#runquery)
        * [Get revisions](../../../client-api/session/how-to/perform-operations-lazily#getrevisions)
        * [Get compare-exchange value](../../../client-api/session/how-to/perform-operations-lazily#getcompareexchange)
    * [Multiple lazy requests](../../../client-api/session/how-to/perform-operations-lazily#multiple-lazy-requests)
        * [Execute all requests - implicitly](../../../client-api/session/how-to/perform-operations-lazily#implicit)
        * [Execute all requests - explicitly](../../../client-api/session/how-to/perform-operations-lazily#explicit)

</Admonition>
## Operations that can be executed lazily

<Admonition type="note" title="Note">
<a id="loadEntities"/> __Load entities__

* ['load'](../../../client-api/session/loading-entities#load) loads a document entity from the database into the session.  
  Loading entities can be executed __lazily__.   

<TabItem value="something-something" label="lazy_load">
<CodeBlock language="nodejs">
{`const lazyEmployee = session
     // Add a call to lazily 
    .advanced.lazily
     // Document will Not be loaded from the database here, no server call is made
    .load("employees/1-A");

const employee = await lazyEmployee.getValue(); // 'load' operation is executed here
// The employee entity is now loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
</Admonition>

<Admonition type="note" title="Note">
<a id="loadWithInclude"/> __Load entities with include__

* ['load' with include](../../../client-api/session/loading-entities#load-with-includes) loads both the document and the specified related document.    
  Loading entities with include can be executed __lazily__.

<Tabs groupId='languageSyntax'>
<TabItem value="Lazy_load_with_include" label="Lazy_load_with_include">
<CodeBlock language="nodejs">
{`const lazyProduct = session
     // Add a call to lazily 
    .advanced.lazily
     // Request to include the related Supplier document
     // Documents will Not be loaded from the database here, no server call is made
    .include("supplierId")
    .load("products/1-A");

// 'load with include' operation will be executed here
// Both documents will be retrieved from the database
const product = await lazyProduct.getValue();
// The product entity is now loaded & tracked by the session

// Access the related document, no additional server call is made
const supplier = await session.load(product.supplierId)
// The supplier entity is now also loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
<TabItem value="The_document" label="The_document">
<CodeBlock language="nodejs">
{`// Sample product document
class Product {
    constructor(name, supplierId) {
        this.id = null;
        this.name = name;
        this.supplierId = supplierId; // The related document ID
    }
}
`}
</CodeBlock>
</TabItem>
</Tabs>
</Admonition>

<Admonition type="note" title="Note">
<a id="loadStartingWith"/> __Load entities starting with__

* ['loadStartingWith'](../../../client-api/session/loading-entities#loadstartingwith) loads entities whose ID starts with the specified prefix.  
  Loading entities with a common prefix can be executed __lazily__.

<TabItem value="something-something" label="lazy_loadStartingWith">
<CodeBlock language="nodejs">
{`const lazyEmployees = session
     // Add a call to lazily 
    .advanced.lazily
     // Request to load entities whose ID starts with 'employees/'
     // Documents will Not be loaded from the database here, no server call is made
    .loadStartingWith("employees/");

const employees = await lazyEmployees.getValue(); // 'load' operation is executed here
// The employee entities are now loaded & tracked by the session
`}
</CodeBlock>
</TabItem>
</Admonition>

<Admonition type="note" title="Note">
<a id="conditionalLoad"/> __Conditional load__

* ['conditionalLoad'](../../../client-api/session/loading-entities#conditionalload) logic is: 
  * If the entity is already loaded to the session:  
    no server call is made, the tracked entity is returned.    
  * If the entity is Not already loaded to the session:  
    the document will be loaded from the server only if the change-vector provided to the method is older than the one in the server
    (i.e. if the document in the server is newer).
  * Loading entities conditionally can be executed __lazily__.  

<TabItem value="something-something" label="lazy_conditionalLoad">
<CodeBlock language="nodejs">
{`// Create document and get its change-vector:
\{
    const session1 = documentStore.openSession();

    const employee = new Employee();
    await session1.store(employee, "employees/1-A");
    await session.saveChanges();
    
    // Get the tracked entity change-vector
    const changeVector = session.advanced.getChangeVectorFor(employee);
\}

// Conditionally lazy-load the document:
\{
    const session2 = documentStore.openSession();

    const lazyEmployee = session2
         // Add a call to lazily 
        .advanced.lazily
         // Document will Not be loaded from the database here, no server call is made
        .conditionalLoad("employees/1-A", changeVector, Employee);

    const loadedItem = await lazyEmployee.getValue(); // 'conditionalLoad' operation is executed here
    const employee = loadeditem.entity;
    
    // If conditionalLoad has actually fetched the document from the server (logic described above)
    // then the employee entity is now loaded & tracked by the session
\}
`}
</CodeBlock>
</TabItem>
</Admonition>

<Admonition type="note" title="Note">
<a id="runQuery"/> __Run query__

* A Query can be executed __lazily__.  
  Learn more about running queries lazily in [lazy queries](../../../client-api/session/querying/how-to-perform-queries-lazily).

<TabItem value="something-something" label="lazy_query">
<CodeBlock language="nodejs">
{`// Define a lazy query:
const lazyEmployees = session
    .query(\{ collection: "employees" \})
    .whereEquals("FirstName", "John")
     // Add a call to lazily, the query will Not be executed here 
    .lazily();

const employees = await lazyEmployees.getValue(); // Query is executed here

// Note: Since query results are not projected,
// then the resulting employee entities will be tracked by the session.
`}
</CodeBlock>
</TabItem>
</Admonition>

<Admonition type="note" title="Note">
<a id="getRevisions"/> __Get revisions__

* All methods for [getting revisions](../../../document-extensions/revisions/client-api/session/loading) and their metadata can be executed __lazily__.

<TabItem value="something-something" label="lazy_revisions">
<CodeBlock language="nodejs">
{`var lazyRevisions = session
     // Add a call to lazily 
    .advanced.revisions.lazily
     // Revisions will Not be fetched here, no server call is made
    .getFor("employees/1-A");

     // Usage is the same for the other get revisions methods:
     // .get()
     // .getMetadataFor()

const revisions = lazyRevisions.getValue(); // Getting revisions is executed here
`}
</CodeBlock>
</TabItem>
</Admonition>

<Admonition type="note" title="Note">
<a id="getCompareExchange"/> __Get compare-exchange value__

* [Getting compare-exchange](../../../client-api/session/cluster-transaction/compare-exchange#get-compare-exchange) values can be executed __lazily__.

<TabItem value="something-something" label="lazy_compareExchange">
<CodeBlock language="nodejs">
{`const session = documentStore.openSession(\{ transactionMode: "ClusterWide" \});

// Create compare-exchange value:
session.advanced.clusterTransaction.createCompareExchangeValue("someKey", "someValue");
await session.saveChanges();

// Get the compare-exchange value lazily:
const lazyCmpXchg = session
    // Add a call to lazily 
    .advanced.clusterTransaction.lazily
    // Compare-exchange values will Not be fetched here, no server call is made
    .getCompareExchangeValue("someKey");

// Usage is the same for the other method:
// .getCompareExchangeValues()

const cmpXchgValue =
    await lazyCmpXchg.getValue(); // Getting compare-exchange value is executed here            
`}
</CodeBlock>
</TabItem>
</Admonition>



## Multiple lazy requests 

<Admonition type="note" title="Note">

<a id="implicit"/> __Execute all requests - implicitly__

Accessing the value of ANY of the lazy instances will trigger
the execution of ALL pending lazy requests held up by the session, 
in a SINGLE server call.  

<TabItem value="something-something" label="lazy_ExecuteAll_Implicit">
<CodeBlock language="nodejs">
{`// Define multiple lazy requests
const lazyUser1 = session.advanced.lazily.load("users/1-A");
const lazyUser2 = session.advanced.lazily.load("users/2-A");

const lazyEmployees = session.query(\{ collection: "employees" \})
    .lazily();
const lazyProducts = session.query(\{ collection: "products" \})
    .search("Name", "Ch*")
    .lazily();

// Accessing the value of ANY of the lazy instances will trigger
// the execution of ALL pending lazy requests held up by the session
// This is done in a SINGLE server call
const user1 = await lazyUser1.getValue();

// ALL the other values are now also available
// No additional server calls are made when accessing these values
const user2 = await lazyUser2.getValue();
const employees = await lazyEmployees.getValue();
const products = await lazyProducts.getValue();
`}
</CodeBlock>
</TabItem>

</Admonition>

<Admonition type="note" title="Note">
<a id="explicit"/> __Execute all requests - explicitly__

Explicitly calling `executeAllPendingLazyOperations` will execute 
ALL pending lazy requests held up by the session, in a SINGLE server call.  

<TabItem value="something-something" label="lazy_ExecuteAll_Explicit">
<CodeBlock language="nodejs">
{`// Define multiple lazy requests
const lazyUser1 = session.advanced.lazily.load("users/1-A");
const lazyUser2 = session.advanced.lazily.load("users/2-A");

const lazyEmployees = session.query(\{ collection: "employees" \})
    .lazily();
const lazyProducts = session.query(\{ collection: "products" \})
    .search("Name", "Ch*")
    .lazily();

// Explicitly call 'executeAllPendingLazyOperations'
// ALL pending lazy requests held up by the session will be executed in a SINGLE server call
await session.advanced.eagerly.executeAllPendingLazyOperations();

// ALL values are now available
// No additional server calls are made when accessing the values
const user1 = await lazyUser1.getValue();
const user2 = await lazyUser2.getValue();
const employees = await lazyEmployees.getValue();
const products = await lazyProducts.getValue();
`}
</CodeBlock>
</TabItem>

</Admonition>




</LanguageContent>

<!---
### Session
- [How to Perform Queries Lazily](../../../client-api/session/querying/how-to-perform-queries-lazily)
- [Cluster Transaction - Overview](../../../client-api/session/cluster-transaction/overview)


-->